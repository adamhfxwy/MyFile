import{r as e,o as t,g as o,h as n,k as l,i as s,l as i,p as a,t as r,x as c,w as d,n as u,e as m,s as _,y as x,q as v,F as h,m as f,a as p,b as w,u as g,z as y,v as b}from"./runtime-dom.esm-bundler-fc4be3d7.js";import{g as k,a as E,s as L,d as M,b as C,c as S,e as V,f as U,h as q,j as T,r as $,k as j,u as I,l as B,n as O,o as A,p as R,i as N}from"./util-accfc5f4.js";import{o as D,a as P,s as z,g as F}from"./tool-8fc7561f.js";import{x as W}from"./index-cebb3e26.js";import{_ as J,J as H,s as G,i as K}from"./chrome-runtime-promise-0385ed0f.js";import{i as X,g as Y,a as Q,b as Z,c as ee,I as te,d as oe,G as ne}from"./stat-ffdf1247.js";const le=["onClick"],se=J({__name:"content-mac",setup(r){const c="xl_chrome_ext_"+W,d=e(!1),u=e(!1),m=e(""),_=e(""),x=e([]),v=e(!1),h=e([]),f=e(!1),p=e(!1),w=()=>{m.value&&chrome.runtime.sendMessage({name:D.xl_download,linkUrl:_.value,refererUrl:document.location.href,cookie:document.cookie})};t(()=>{document.addEventListener("scroll",S),document.body.addEventListener("mousemove",V),window.self!==window.top&&document.body.addEventListener("mouseout",C),document.addEventListener("scroll",S),q()});const g=()=>{const e=document.getElementById(c);e&&(e.style.display="none")},y=()=>{const e=document.getElementById(c);e&&(e.remove(),document.body.removeEventListener("mousemove",V,!0),window.self!==window.top&&document.body.removeEventListener("mouseout",C),document.body.removeEventListener("scroll",S),m.value=null,_.value=void 0,x.value=[])},b=e=>{const t=document.getElementById(c);if(!t)return;t.style.display="block",u.value=!0;const o=e.getBoundingClientRect(),n=`position:fixed;left: ${o.x+4}px; top: ${o.y+4}px; height: 30px; z-index: 10000000000 !important`;t.style=n,f.value||(f.value=!0,chrome.runtime.sendMessage({name:D.xl_video_show,referurl:document.location.href,videoSrc:e.src}))},C=()=>{m.value&&(m.value=null,_.value=void 0,g())},S=()=>{m.value&&b(m.value)},V=e=>{const t=document.elementFromPoint(e.x,e.y);if(!t)return;if("video"===t.tagName.toLocaleLowerCase()){const e=t.src||k(t);if(!e||0===e.toLocaleLowerCase().indexOf("blob:"))return;if(t===m.value)return;return m.value=t,_.value=e,void b(t)}if(m.value){if(!E(e,m.value))return m.value=null,_.value=void 0,void g()}else{let t=null;for(const o of x.value)if("none"!==window.getComputedStyle(o).display)if(E(e,o))if(t){(Number(window.getComputedStyle(o).zIndex)||0)>(Number(window.getComputedStyle(t).zIndex)||0)&&(t=o)}else t=o;else if(t){const e=t.src||k(t);e&&0!==e.toLowerCase().indexOf("blob:")&&(m.value=t,_.value=e,b(t))}if(t){const e=t.src||k(t);e&&0!==e.toLowerCase().indexOf("blob:")&&(m.value=t,_.value=e,b(t))}}},U=async()=>{chrome.runtime.sendMessage({name:D.xl_call_function,method:P.getWebsiteDomains},async e=>{h.value=new Set(await e.websiteDomains);const t=M.exec(document.location.host)[2];p.value=h.value.has(t),v.value&&!p.value&&(d.value=!0)})},q=async()=>{await(async()=>{const e=await chrome.runtime.sendMessage({name:D.CheckEnabled});e&&(v.value=e.isInstallThunder)})(),await U();const e=document.getElementsByTagName("video");x.value=e,!x.value.length>0||L(x.value)};return(e,t)=>(o(),n("div",{class:l([e.$style["content-wrapper"],e.$style["mac-content-wrapper"]])},[u.value?(o(),n("div",{key:0,class:l(e.$style["video-wrapper"])},[s("div",{class:l([e.$style["options-wrapper"]])},[s("div",{class:l(e.$style["xl-chrome-ext-bar__logo"])},null,2),s("div",{class:l([e.$style["xl-chrome-ext-tips"],e.$style.download]),onClick:i(w,["stop"])},[s("a",{id:"xl_chrome_ext_bar_download",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),s("div",{class:l([e.$style["xl-chrome-ext-title"]])},"下载视频",2)],10,le),s("a",{id:"xl_chrome_ext_close",class:l([e.$style["xl-chrome-ext-bar__option"]]),title:"本次关闭",href:"javascript:;",onClick:y},[s("div",{class:l(["xl-close img",[e.$style["xl-close"],e.$style.img]])},null,2)],2)],2)],2)):a("",!0)],2))}},[["__cssModules",{$style:{"options-wrapper":"_options-wrapper_1aqct_20","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_1aqct_14","xl-chrome-ext-bar__logo":"_xl-chrome-ext-bar__logo_1aqct_1","xl-chrome-ext-bar-toast__success":"_xl-chrome-ext-bar-toast__success_1aqct_1","xl-chrome-ext-bar-toast__error":"_xl-chrome-ext-bar-toast__error_1aqct_1","xl-chrome-ext-bar-toast__text":"_xl-chrome-ext-bar-toast__text_1aqct_1","xl-chrome-ext-tips":"_xl-chrome-ext-tips_1aqct_1","xl-chrome-ext-title":"_xl-chrome-ext-title_1aqct_1","xl-chrome-ext-title--footer":"_xl-chrome-ext-title--footer_1aqct_1","xl-chrome-ext-bar__option":"_xl-chrome-ext-bar__option_1aqct_1",img:"_img_1aqct_1","xl-download":"_xl-download_1aqct_1","xl-screen":"_xl-screen_1aqct_1","xl-close":"_xl-close_1aqct_1","content-wrapper":"_content-wrapper_1aqct_3","video-wrapper":"_video-wrapper_1aqct_8","mac-content-wrapper":"_mac-content-wrapper_1aqct_11"}}]]);function ie(e){!function(e){chrome.runtime.sendMessage(e)}({name:"xl_prompt_click",...e})}const ae=["id"],re={class:"xl-chrome-ext-dialog__title"},ce=c('<ul class="xl-chrome-ext-dialog__content"><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-download"></div><div class="xl-chrome-ext-dialog__content-text">一键读取网页中的可下载链接</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-video"></div><div class="xl-chrome-ext-dialog__content-text">网页视频下载、存云盘、投屏播放</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-picture"></div><div class="xl-chrome-ext-dialog__content-text">批量下载图片</div></li></ul>',1),de={class:"xl-chrome-ext-dialog__footer"},ue={__name:"ActionErrorDialog",props:{text:{type:String,required:!0}},emits:["submit","cancel"],setup(l){const a=e(C("action"));return t(async()=>{}),(e,t)=>(o(),n("div",{class:"xl-chrome-ext-dialog",id:a.value},[s("h2",re,"无法"+r(l.text)+"，请安装迅雷客户端后重试",1),s("a",{action:"close",href:"javascript:;",class:"xl-chrome-ext-dialog__close",title:"关闭",onClick:t[0]||(t[0]=i(t=>e.$emit("cancel","close"),["stop"]))}),ce,s("div",de,[s("button",{onClick:t[1]||(t[1]=i(t=>e.$emit("submit","install"),["stop"])),action:"install",class:"xl-chrome-ext-dialog__button xl-download"}," 迅雷高速下载 "),s("button",{onClick:t[2]||(t[2]=t=>e.$emit("cancel","once-close")),action:"once-close",class:"xl-chrome-ext-dialog__button xl-close"}," 取消 ")])],8,ae))}},me={animate__bounceOutUp:"_animate__bounceOutUp_ti0wz_29",bounceInUp:"_bounceInUp_ti0wz_1","xl-chrome-ext-footer__ball":"_xl-chrome-ext-footer__ball_ti0wz_33","xl-chrome-ext-footer__name":"_xl-chrome-ext-footer__name_ti0wz_50"},_e={id:"xl-chrome-ext-footer",class:"xl-chrome-ext-footer"},xe=["onClick","onMouseenter","onMouseleave","onAnimationend"],ve=s("div",{class:"xl-chrome-ext-footer__logo"},null,-1),he={class:"xl-chrome-ext-footer__quantity"},fe=["onMouseenter","onMouseleave","onAnimationend"],pe={key:0,class:"xl-chrome-ext-footer__jsq"},we={class:"xl-chrome-ext-footer__content"},ge={class:"xl-chrome-ext-footer__text"},ye={class:"xl-chrome-ext-footer__action"},be=["onClick","onMouseenter","onMouseleave"],ke=s("h3",null,"用迅雷享高速下载",-1),Ee=s("div",{class:"xl-chrome-ext-footer__explain"},"当前页面含资源如下：",-1),Le={class:"xl-chrome-ext-footer__list"},Me=["data","onClick"],Ce=s("div",{class:"xl-chrome-ext-footer__action-name"},"下载",-1),Se=["onClick","onMouseenter","onMouseleave"],Ve={class:"xl-chrome-ext-footer__action-name"},Ue={class:"xl-chrome-ext-footer__button-text"},qe=s("h3",null,"存迅雷云盘，享高清播放、高速下载",-1),Te=s("div",{class:"xl-chrome-ext-footer__explain"},"当前页面含资源如下：",-1),$e={class:"xl-chrome-ext-footer__list"},je=["onClick"],Ie={class:"xl-chrome-ext-footer__button-text"},Be={key:0,class:"xl-chrome-ext-footer__agreement"},Oe=s("span",null,"启用插件访问在线视频时，插件将在播放窗口展示对播放链接的快捷功能",-1),Ae=["onClick"],Re={class:"xl-chrome-ext-footer__close-wrapper"},Ne={class:"xl-chrome-ext-tips"},De=["onClick"],Pe=s("div",{class:"xl-chrome-ext-title xl-chrome-ext-title--footer"},"本次关闭",-1),ze=J({__name:"Footer",props:{resourceList:{type:Object,required:!0},exception:{type:Boolean,required:!0},isShowJsqEntry:{type:Boolean,required:!0},jsqText:{type:Object,required:!0}},emits:["removeFooter","showActionError","showVersionError","handleDownload","handleCloseBar"],setup(c,{emit:p}){const w=p,g=c,y=e(null),b=e(!1),k=e(null),E=e(null),L=e(!1),M=e(!1),C=e(!1),S=e(0),V=e(0),U=e(null),q=e(null),T=e(!1),$=e(!0),j=e(g.resourceList.playList.length===g.resourceList.length),I=e(0===g.resourceList.saveList.length);function B(){b.value=!0,y.value=setTimeout(()=>{b.value=!1},5e3)}function O(){T.value=!0,g.resourceList.downloadList.length>1&&u(()=>{if(U.value){const{height:e}=window.getComputedStyle(U.value);S.value=`-${parseFloat(e)+16}px`}}),g.resourceList.saveList.length>1&&u(()=>{if(q.value){const{height:e}=window.getComputedStyle(q.value);V.value=`-${parseFloat(e)+16}px`}})}function A(e){return e.isInIframe&&".m3u8"===e.suffix&&(e.fileName=F(e.suffix,e.url)),e.fileName}function R(){E.value=setTimeout(()=>{M.value=!1},300)}function N(){E.value&&clearTimeout(E.value),M.value=!0}function D(){J(g.resourceList.saveList[0])}function P(){k.value=setTimeout(()=>{C.value=!1},300)}function W(){k.value&&clearTimeout(k.value),C.value=!0}async function J(e){if(g.exception)return w("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:!1,data:t});const t=e;if(t.isVideoURL){L.value=!0;const{isAccept:e}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(L.value=!1,!e)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:!1,data:t})}var o;(o=t).suffix&&chrome.runtime.sendMessage({name:"xl_cloudadd",from:"bottom_bar",data:{opt:"web:cloudadd",params:{url:o.url,name:o.fileName,ext:o.suffix,isVideo:o.isVideoURL,cookie:document.cookie,webTitle:document.title}},isM3U8Video:".m3u8"===o.suffix},e=>{e&&("version"===e.errType&&w("showVersionError",e.text),chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:e.result,data:o}))})}function G(){if(g.exception){w("showActionError","下载","download");const e=g.resourceList.downloadList[0];chrome.runtime.sendMessage({name:"xl_download_stat",link:e.url,stat:e.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",status:"fail"})}else{K(g.resourceList.downloadList[0])}}function K(e){chrome.runtime.sendMessage({name:"xl_download",link:e.url,cookie:document.cookie,referurl:document.location.href,stat:e.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",isM3U8Video:".m3u8"===e.suffix},e=>{e&&"version"===e.errType&&w("showVersionError",e.text)})}d(b,e=>{!0===e&&O()});const X=e(!0);function Y(){chrome.runtime.sendMessage({name:"xl_footer_other_click",clickId:"close"}),w("removeFooter")}function Q(){chrome.storage.local.set({isAgreementVisible:!1}),$.value=!1}function Z(){const e=X.value?"fix_bar":"release_bar";X.value=!X.value,b.value=!X.value,chrome.runtime.sendMessage({name:"xl_footer_other_click",clickId:e})}function ee(){y.value&&clearTimeout(y.value),b.value||(b.value=!0)}function te(){X.value&&(b.value=!1)}function oe(){X.value&&(E.value=setTimeout(()=>{b.value=!1},800))}function ne(){y.value&&clearTimeout(y.value),E.value&&clearTimeout(E.value),X.value&&(b.value=!0)}function le(){const e=document.querySelector("#xl-chrome-ext-footer");if(!e.nextSibling)return;e.parentElement.appendChild(e)}return chrome.storage.local.get("isAgreementVisible",e=>{e&&!1===e.isAgreementVisible?$.value=!1:$.value=!0}),t(()=>{chrome.runtime.sendMessage({name:"xl_footer_show",url:document.location.href,downloadShow:0!==g.resourceList.downloadList.length?1:0,playShow:!I.value&&j.value?1:0,saveShow:I.value||j.value?0:1,resourceList:JSON.stringify(g.resourceList)}),z(le,3e5,!0)}),(e,t)=>(o(),n("div",_e,[s("div",{class:l(["",[e.$style.animate__bounceOutUp,e.$style["xl-chrome-ext-footer__ball"]]]),onClick:i(Z,["stop"]),onMouseenter:i(ee,["stop"]),onMouseleave:i(te,["stop"]),onAnimationend:i(B,["stop"])},[ve,s("div",he,r(c.resourceList.length),1)],42,xe),s("div",{onMouseenter:i(ne,["stop"]),onMouseleave:i(oe,["stop"]),onAnimationend:i(O,["stop"]),class:l({"xl-chrome-ext-footer__bar":!0,"xl-chrome-ext-footer__bar--show":b.value})},[c.isShowJsqEntry?(o(),n("div",pe,[m(H,{source:"footer",text:c.jsqText},null,8,["text"])])):a("",!0),s("div",we,[s("p",ge," 检测到页面存在 "+r(c.resourceList.length<=99?c.resourceList.length:99)+" 个资源 ",1),s("div",ye,[_(s("div",{class:"xl-chrome-ext-footer__url download",onClick:i(G,["stop"]),onMouseenter:i(N,["stop"]),onMouseleave:i(R,["stop"])},[c.resourceList.downloadList.length>1?(o(),n("div",{key:0,ref_key:"downloadPopoverRef",ref:U,style:v({top:S.value}),class:l({"xl-chrome-ext-footer__popover":!0,"xl-chrome-ext-footer__popover--show":M.value,"xl-chrome-ext-footer__popover--hidden":!M.value})},[ke,Ee,s("ul",Le,[(o(!0),n(h,null,f(c.resourceList.downloadList,(t,a)=>(o(),n("li",{class:"xl-chrome-ext-footer__item",key:a},[s("div",{class:l({"xl-chrome-ext-footer__type":!0,"xl-video":t.isVideoURL,"xl-link":!t.isVideoURL})},null,2),s("div",{class:l(e.$style["xl-chrome-ext-footer__name"])},r(A(t)),3),s("button",{type:"download",data:JSON.stringify(t),onClick:i(e=>{return o=t,void(g.exception?(w("showActionError","下载","download"),chrome.runtime.sendMessage({name:"xl_download_stat",link:o.url,stat:o.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",status:"fail"})):K(o));var o},["stop"])}," 下载 ",8,Me)]))),128))])],6)):a("",!0),Ce],40,be),[[x,c.resourceList.downloadList.length>0]]),c.resourceList.saveList.length>0?(o(),n("div",{key:0,class:"xl-chrome-ext-footer__url cloudAdd",onClick:i(D,["stop"]),onMouseenter:i(W,["stop"]),onMouseleave:i(P,["stop"])},[s("div",Ve,[s("div",{class:l({"xl-chrome-ext-footer__button-icon":!0,loading:L.value,save:!j.value,play:!!j.value})},null,2),s("span",Ue,r(L.value?"添加中":j.value?"流畅播":"存云盘"),1)]),c.resourceList.saveList.length>1?(o(),n("div",{key:0,ref_key:"cloudAddPopoverRef",ref:q,style:v({top:V.value}),class:l({"xl-chrome-ext-footer__popover":!0,"xl-chrome-ext-footer__popover--show":C.value,"xl-chrome-ext-footer__popover--hidden":!C.value})},[qe,Te,s("ul",$e,[(o(!0),n(h,null,f(c.resourceList.saveList,(t,a)=>(o(),n("li",{class:"xl-chrome-ext-footer__item",key:a},[s("div",{class:l({"xl-chrome-ext-footer__type":!0,"xl-video":t.isVideoURL,"xl-link":!t.isVideoURL})},null,2),s("div",{class:l(e.$style["xl-chrome-ext-footer__name"])},r(A(t)),3),s("button",{onClick:i(e=>function(e,t){J(t)}(0,t),["stop"])},[s("div",{class:l({"xl-chrome-ext-footer__button-icon":!0,small:!0,loading:L.value,save:!t.isVideoURL,play:!!t.isVideoURL})},null,2),s("span",Ie,r(t.isVideoURL?"流畅播":"存云盘"),1)],8,je)]))),128))])],6)):a("",!0)],40,Se)):a("",!0)]),$.value?(o(),n("div",Be,[Oe,s("span",{class:"xl-chrome-ext-footer__know",onClick:i(Q,["stop"])},"我知道了",8,Ae)])):a("",!0),s("div",Re,[s("div",Ne,[s("div",{class:"xl-chrome-ext-footer__close",onClick:i(Y,["stop"])},null,8,De),Pe])])])],42,fe)]))}},[["__cssModules",{$style:me}]]),Fe=["id"],We=s("h2",{class:"xl-chrome-ext-dialog__title"},"浏览器无法直接打开磁力链等特殊格式链接",-1),Je=c('<ul class="xl-chrome-ext-dialog__content"><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-download"></div><div class="xl-chrome-ext-dialog__content-text">高速下载：基础加速、超级通道、会员加速三重加速</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-compatible"></div><div class="xl-chrome-ext-dialog__content-text">强大兼容：支持磁力、种子、在线视频</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-pan"></div><div class="xl-chrome-ext-dialog__content-text">超大云盘：最高12TB备份</div></li></ul>',1),He={class:"xl-chrome-ext-dialog__footer"},Ge={__name:"ResourceDialog",emits:["submit","cancel"],setup(l){const a=e(C("resource"));return t(async()=>{}),(e,t)=>(o(),n("div",{class:"xl-chrome-ext-dialog",id:a.value},[We,s("a",{action:"close",href:"javascript:;",class:"xl-chrome-ext-dialog__close",title:"关闭",onClick:t[0]||(t[0]=i(t=>e.$emit("cancel","close"),["stop"]))}),Je,s("div",He,[s("button",{action:"install",class:"xl-chrome-ext-dialog__button xl-download",onClick:t[1]||(t[1]=i(t=>e.$emit("submit","install"),["stop"]))}," 迅雷高速下载 "),s("button",{action:"close",class:"xl-chrome-ext-dialog__button xl-close",onClick:t[2]||(t[2]=i(t=>e.$emit("cancel","close"),["stop"]))}," 取消 ")])],8,Fe))}},Ke={class:"dialog-wrapper xly-dialog-prompt"},Xe=[s("i",{class:"xl-icon-close"},null,-1)],Ye={class:"xly-dialog-prompt__text"},Qe=s("p",{class:"xly-dialog-prompt__text"},"（升级提示：主菜单-检查更新）",-1),Ze={class:"xly-dialog-prompt__footer"},et={class:"xly-dialog-prompt__button"},tt={__name:"VersionError",props:{text:{type:String,required:!0}},emits:["submit","cancel"],setup:(e,{emit:l})=>(t(async()=>{}),(t,l)=>(o(),n("div",Ke,[s("h2",null,r(e.text)+"调用失败",1),s("a",{action:"close",href:"javascript:;",onClick:l[0]||(l[0]=i(e=>t.$emit("cancel","close"),["stop"])),class:"xly-dialog-close",title:"关闭"},Xe),s("p",Ye,"客户端版本过低，无法启用"+r(e.text)+"。",1),Qe,s("div",Ze,[s("div",et,[s("button",{action:"close",class:"td-button--other",style:{width:"65px","border-radius":"4px"},onClick:l[1]||(l[1]=e=>t.$emit("cancel","close"))}," 取消 "),s("button",{action:"startThunder",class:"td-button",onClick:l[2]||(l[2]=i(e=>t.$emit("submit","startThunder"),["stop"]))},"前往升级")])])])))},ot=["onClick"],nt=["onClick"],lt=["onClick"],st=["onClick"],it=J({__name:"VideoTag",props:{latestVideoSrc:{type:String,required:!0},latestVideoElement:{type:String,required:!0},exception:{type:Boolean,required:!0},isShowVideoTag:{type:Boolean,required:!0},isShowDownloadBar:{type:Boolean,required:!0},isShowCloudAddBar:{type:Boolean,required:!0}},emits:["showActionError","showVersionError","handleDownload","handleCloseBar"],setup(c,{emit:d}){const u=d,m=c,v=e(!1),f=e(""),w=e("success"),g=e(null),y=p({isM3U8Video:!1,M3U8VideoUrl:""});function b(){if(m.exception)return u("showActionError","下载","download"),void chrome.runtime.sendMessage({name:"xl_download_stat",link:y.M3U8VideoUrl||m.latestVideoSrc,stat:"chrome_download_video",from:"video_hover",status:"fail"});!function(){do{if(!m.latestVideoElement)break;const e=m.latestVideoElement;if(!m.latestVideoSrc)break;let t="",o="";if(document.title){const n=document.title.replace(/[*?/:|<>"]/g,"");n&&(o=S(V(m.latestVideoSrc)),o||(o=L(e)),t=`${n}${o}`)}chrome.runtime.sendMessage({name:"xl_download",link:y.M3U8VideoUrl||m.latestVideoSrc,cookie:document.cookie,referurl:document.location.href,fileName:t,stat:"chrome_download_video",from:"video_hover",isInIframe:U(),isM3U8Video:!!y.M3U8VideoUrl})}while(0)}()}async function k(){const e=q(y.M3U8VideoUrl||m.latestVideoSrc),t={from:"video_hover",data:{opt:"web:cloudadd",params:{url:e.url,name:e.fileName,ext:e.suffix,isVideo:e.isVideoURL}}};if(U()?t.name="xl_cloudadd_in_iframe":(t.name="xl_cloudadd",t.cookie=document.cookie,t.webTitle=document.title),m.exception)return u("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});const{isAccept:o}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(!o)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播。",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});chrome.runtime.sendMessage(t,e=>{e&&"version"===e.errType&&u("showVersionError",e.text)})}function E(){if(m.exception)return void u("showActionError","投屏","projection");const e={url:m.latestVideoSrc,name:document.title,playForm:document.referrer,dlnaPlay:!0,stat:"browser_plugin_tv_sp_click"};chrome.runtime.sendMessage({name:"xl_screen",type:"click",data:{opt:"web:play",params:e}},e=>{e&&"version"===e.errType&&u("showVersionError","投屏")})}function L(e){let t=void 0;for(let o=0;o<e.children.length;o++){const n=e.children[o];if("source"===n.tagName.toLowerCase()&&n.type){const e=n.type.split("/");e.length>0&&(t=e[e.length-1]);break}}return t?"."+t:""}function M(){navigator.clipboard?chrome.runtime.sendMessage({name:"xl_copy",text:y.M3U8VideoUrl||m.latestVideoSrc},e=>{e.status&&C({isShow:!0,msg:"复制成功",type:"success"})}):C({isShow:!0,msg:"复制失败",type:"error"})}function C(e){const{isShow:t,msg:o,type:n}=e;v.value=t,f.value=o,w.value=n,g.value&&clearTimeout(g.value),g.value=setTimeout(()=>{v.value=!1},1500)}return t(async()=>{chrome.runtime.sendMessage({name:"xl_screen",type:"init",data:{params:{playForm:document.referrer}}},e=>{y.isM3U8Video=e.isM3U8Video,y.M3U8VideoUrl=e.M3U8VideoUrl})}),(e,t)=>(o(),n(h,null,[v.value?(o(),n("div",{key:0,class:l([e.$style["xl-chrome-ext-bar-toast"]])},[s("div",{class:l(["success"===w.value?e.$style["xl-chrome-ext-bar-toast__success"]:"","error"===w.value?e.$style["xl-chrome-ext-bar-toast__error"]:""])},null,2),s("div",{class:l([e.$style["xl-chrome-ext-bar-toast__text"]])},r(f.value),3)],2)):a("",!0),_(s("div",{class:l([e.$style["options-wrapper"]])},[s("a",{onClick:t[0]||(t[0]=i(t=>e.$emit("handleCloseBar"),["stop"])),id:"xl_chrome_ext_bar_close",href:"javascript:;"}),s("div",{class:l(e.$style["xl-chrome-ext-bar__logo"])},null,2),c.isShowCloudAddBar?(o(),n("div",{key:0,class:l([e.$style["xl-chrome-ext-tips"],e.$style["cloud-add"]]),onClick:i(k,["stop"])},[s("a",{id:"xl_chrome_ext_bar_cloudAdd",class:l(e.$style["xl-chrome-ext-bar__option"]),href:"javascript:;"},null,2),s("div",{class:l(e.$style["xl-chrome-ext-title"])},"流畅播",2)],10,ot)):a("",!0),c.isShowDownloadBar?(o(),n("div",{key:1,class:l([e.$style["xl-chrome-ext-tips"],e.$style.download]),onClick:i(b,["stop"])},[s("a",{id:"xl_chrome_ext_bar_download",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),s("div",{class:l([e.$style["xl-chrome-ext-title"]])},"下载视频",2)],10,nt)):a("",!0),s("div",{onClick:i(E,["stop"]),class:l([e.$style["xl-chrome-ext-tips"]])},[s("a",{id:"xl_chrome_ext_bar_screen",href:"javascript:;",class:l([e.$style["xl-chrome-ext-bar__option"]])},null,2),s("div",{class:l([e.$style["xl-chrome-ext-title"]])},"投屏",2)],10,lt),s("div",{onClick:i(M,["stop"]),class:l([e.$style["xl-chrome-ext-tips"]])},[s("a",{id:"xl_chrome_ext_bar_copy",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),s("div",{class:l([e.$style["xl-chrome-ext-title"]])},"复制链接",2)],10,st)],2),[[x,c.isShowVideoTag]])],64))}},[["__cssModules",{$style:{"options-wrapper":"_options-wrapper_1h5qu_1","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_1h5qu_13","xl-chrome-ext-bar__logo":"_xl-chrome-ext-bar__logo_1h5qu_28","xl-chrome-ext-bar-toast__success":"_xl-chrome-ext-bar-toast__success_1h5qu_36","xl-chrome-ext-bar-toast__error":"_xl-chrome-ext-bar-toast__error_1h5qu_44","xl-chrome-ext-bar-toast__text":"_xl-chrome-ext-bar-toast__text_1h5qu_52","xl-chrome-ext-tips":"_xl-chrome-ext-tips_1h5qu_60","xl-chrome-ext-title":"_xl-chrome-ext-title_1h5qu_67","xl-chrome-ext-title--footer":"_xl-chrome-ext-title--footer_1h5qu_72","xl-chrome-ext-bar__option":"_xl-chrome-ext-bar__option_1h5qu_76",img:"_img_1h5qu_92","xl-download":"_xl-download_1h5qu_99","xl-screen":"_xl-screen_1h5qu_103","xl-close":"_xl-close_1h5qu_107"}}]]);function at(){this.states={},this._current=void 0}at.prototype.start=function(e){if(void 0!==this._current)throw"State machine already started";if(null==e)throw"Please give a valid state name";setTimeout(at._changeState,0,this,e)},at.prototype.fireEvent=function(e,t){if(void 0===this._current)throw"State machine not started";if(null===this._current)throw"State machine terminated";setTimeout(at._handleEvent,0,this,e,t)},at._changeState=function(e,t){if(null!==t&&!e.states.hasOwnProperty(t))throw e._current=null,'No such state "'+t+'"';let o=e._current;if(void 0!==o&&o.hasOwnProperty("__exit__")&&o.__exit__.apply(e),null===t)return void(e._current=null);if(o=e._current=e.states[t],!o.hasOwnProperty("__enter__"))return;const n=o.__enter__.apply(e);void 0!==n&&setTimeout(at._changeState,0,e,n)},at._handleEvent=function(e,t,o){let n=e._current[t];"function"==typeof n&&(n=n.apply(e,o)),void 0!==n&&setTimeout(at._changeState,0,e,n)};let rt={};const ct={glass:"ncennffkjdiamlpmcbajkmaiiiddgioo-glass",help:"ncennffkjdiamlpmcbajkmaiiiddgioo-help",overlay:"ncennffkjdiamlpmcbajkmaiiiddgioo-overlay"},dt={closing:"ncennffkjdiamlpmcbajkmaiiiddgioo-closing",exiting:"ncennffkjdiamlpmcbajkmaiiiddgioo-exiting",inverted:"ncennffkjdiamlpmcbajkmaiiiddgioo-inverted",invisible:"ncennffkjdiamlpmcbajkmaiiiddgioo-invisible",loading:"ncennffkjdiamlpmcbajkmaiiiddgioo-loading",relative:"ncennffkjdiamlpmcbajkmaiiiddgioo-relative",selected:"ncennffkjdiamlpmcbajkmaiiiddgioo-selected",selectionRectangle:"ncennffkjdiamlpmcbajkmaiiiddgioo-selection-rectangle"};function ut(){this._invertedSelection=!1,this._curpos={x:0,y:0},this._selectableElements=[],this._visibleElements=[];const e=this,t=document.createElement("div");t.id=ct.overlay;const o=document.createElement("div");o.id=ct.glass;const n=document.createElement("div");n.id=ct.help,n.innerHTML=chrome.i18n.getMessage("usage"),n.onmouseover=function(){n.classList.add(dt.invisible)},n.onmouseout=function(){n.classList.remove(dt.invisible)};const l=function(e){e.preventDefault(),e.stopPropagation()},s=function(t){e._curpos.x=t.clientX,e._curpos.y=t.clientY};let i=null;const a={contextmenu:function(e){l(e)},mousemove:function(t){s(t),e.sm.fireEvent("mousemove")},mousedown:function(t){if(null===i&&(0==t.button||2==t.button)){switch(i=0==t.button?t.ctrlKey?1:0:2,i){case 0:s(t),e.sm.fireEvent("mousedown");break;case 1:case 2:s(t),e.sm.fireEvent("alt_mousedown")}l(t)}},mouseup:function(t){if(null!==i&&(t.button==i||0==t.button||1==i)){switch(t.button){case 0:s(t),e.sm.fireEvent(1==i?"alt_mouseup":"mouseup");break;case 2:s(t),e.sm.fireEvent("alt_mouseup")}i=null,l(t)}},keydown:function(t){if(t.isTrusted){switch(t.keyCode){case 13:e.sm.fireEvent("req_download");break;case 27:e.sm.fireEvent("req_exit");break;default:return}l(t)}},resize:function(){let t=null;const o=function(){t=null,e.updateVisibleElements()};return function(){null!==t&&clearTimeout(t),t=setTimeout(o,100)}}(),scroll:function(){let t=null;const o=function(){t=null,e.updateVisibleElements()};return function(){null!==t&&clearTimeout(t),t=setTimeout(o,100)}}()};document.addEventListener("contextmenu",a.contextmenu),document.addEventListener("scroll",a.scroll),window.addEventListener("resize",a.resize),document.addEventListener("keydown",a.keydown,!0),document.body.addEventListener("mousedown",a.mousedown,!0),document.body.addEventListener("mouseup",a.mouseup,!0),t.appendChild(n),t.appendChild(o);const r=new at;r.states.load={__enter__:function(){document.documentElement.classList.add(dt.loading),document.body.appendChild(t),t.addEventListener("webkitTransitionEnd",(function o(){t.removeEventListener("webkitTransitionEnd",o),e.sm.fireEvent("load_done")})),setTimeout((function(){e.populate(),e.updateVisibleElements(),document.documentElement.classList.remove(dt.loading)}),0)},load_done:"idle"},r.states.exit={__enter__:function(){e._cursel&&m(),document.removeEventListener("mousemove",a.mousemove),document.removeEventListener("scroll",a.scroll),window.removeEventListener("resize",a.resize),document.removeEventListener("contextmenu",a.contextmenu),document.removeEventListener("keydown",a.keydown,!0),document.body.removeEventListener("mousedown",a.mousedown,!0),document.body.removeEventListener("mouseup",a.mouseup,!0),e._selectableElements.forEach((function(e){e._private.delegate.classList.remove(dt.selected),e._private.delegate.classList.remove(dt.relative),delete e._private}));const o=()=>{t.removeEventListener("webkitTransitionEnd",o),document.body.removeChild(t),document.documentElement.classList.remove(dt.exiting),e.sm.fireEvent("exit_done")};t.addEventListener("webkitTransitionEnd",o),document.documentElement.classList.add(dt.exiting)},__exit__:function(){rt.instance=null},exit_done:null},r.states.idle={mousedown:"selection",alt_mousedown:"deselection",req_exit:"exit",req_download:"action-download"};let c=null,d=null;const u=function(){const t=document.createElement("div");t.classList.add(dt.selectionRectangle),t.style.left=e._curpos.x+"px",t.style.top=e._curpos.y+"px",e._invertedSelection&&t.classList.add(dt.inverted),e._cursel=document.body.appendChild(t),e._startpos={x:e._curpos.x,y:e._curpos.y},e._selrect={x:e._curpos.x,y:e._curpos.y,w:0,h:0},e._lastDrawn={},c=setInterval(e.drawSelection.bind(e),30),d=setInterval(e.calcSelectedElements.bind(e),30),document.addEventListener("mousemove",a.mousemove)},m=function(){document.removeEventListener("mousemove",a.mousemove),clearInterval(c),clearInterval(d),c=null,d=null,e.calcSelectedElements();for(const t in e._selectableElements){const o=e._selectableElements[t]._private;o.selected=o.selected2}return e._cursel.addEventListener("webkitTransitionEnd",function(){document.body.removeChild(this)}.bind(e._cursel)),e._cursel.classList.add(dt.closing),delete e._cursel,delete e._startpos,delete e._selrect,delete e._lastDrawn,"idle"},_=function(){if(!e._startpos)return;const t=e._startpos,o=e._curpos,n=e._selrect;n.x=Math.min(t.x,o.x),n.y=Math.min(t.y,o.y),n.w=Math.abs(t.x-o.x),n.h=Math.abs(t.y-o.y)};r.states.selection={__enter__:function(){e._invertedSelection=!1,u()},mousemove:_,mouseup:m,req_exit:"exit"},r.states.deselection={__enter__:function(){e._invertedSelection=!0,u()},mousemove:_,alt_mouseup:m,req_exit:"exit"},r.states["action-download"]={__enter__:function(){const t=function(e){const t={};return e.forEach((function(e){if(e._private.selected){const o=function(e){let t=e.href;do{const o=e.getAttribute("thunderhref");if(o){t=o;break}if(null===e.getAttribute("thundertype"))break;const n=e.attributes.length;if(n<=0)break;for(let l=0;l<n;l++){const o=e.attributes[l].value;if(o&&0===o.toLowerCase().indexOf("thunder://")){t=o;break}}}while(0);return t}(e);t[o]=null}})),Object.keys(t)}(e._selectableElements);chrome.runtime.sendMessage({name:"xl_download_multi",referurl:document.location.href,cookie:document.cookie,urls:t}),e.sm.fireEvent("done")},done:"exit"},this.sm=r}function mt(e,t){for(const o in e)e[o].classList.add(dt.selected);for(const o in t)t[o].classList.remove(dt.selected)}function _t(e,t){return!(e.bottom<t.y||t.y+t.h<e.top||e.right<t.x||t.x+t.w<e.left)}ut.prototype.populate=function(){const e=document.links,t=/^javascript:/;for(let o=0;o<e.length;o++){const n=e[o];if(null==n.href||t.test(n.href))continue;let l=n;const s=n.getElementsByTagName("img");s.length&&(l=s[0]),n._private={selected:!1,selected2:!1,delegate:l,positionfix:!1},this._selectableElements.push(n)}},ut.prototype.updateVisibleElements=function(){const e={x:0,y:0,w:window.innerWidth,h:window.innerHeight},t=this._visibleElements,o=this._selectableElements;t.splice(0);for(const n in o){const l=o[n],s=l._private,i=s.delegate;_t(i.getBoundingClientRect(),e)&&(t.push(l),s.positionfix||(s.positionfix=!0,"static"==window.getComputedStyle(i).position&&i.classList.add(dt.relative)))}},ut.prototype.drawSelection=function(){const e=this._selrect,t=this._lastDrawn,o=this._cursel.style;e.x==t.x&&e.y==t.y&&e.w==t.w&&e.h==t.h||(o.left=(t.x=e.x)+"px",o.top=(t.y=e.y)+"px",o.width=(t.w=e.w)+"px",o.height=(t.h=e.h)+"px")},ut.prototype.calcSelectedElements=function(){const e=this._visibleElements,t=this._selrect,o=[],n=[];for(const l in e){const s=e[l]._private,i=s.delegate,a=s.delegate.getClientRects();let r=!1;for(let e=0;e<a.length;e++){if(_t(a[e],t)){r=!0;break}}const c=r?!this._invertedSelection:s.selected;c!=s.selected2&&((c?o:n).push(i),s.selected2=c)}(o||n)&&setTimeout(mt,0,o,n)},rt={instance:null,enter:function(){null===rt.instance&&(rt.instance=new ut,rt.instance.sm.start("load"),chrome.runtime.sendMessage({name:"xl_download_multi_start",referurl:document.location.href}))},quit:function(){rt.instance&&rt.instance.sm.fireEvent("req_exit")},download:function(){rt.instance&&rt.instance.sm.fireEvent("req_download")}};const xt=rt,vt=J({__name:"content-win",setup(s){const i="xl_chrome_ext_"+W,r=e(!1),c=e(""),u=e({}),_=e(!1),x=e(!1),v=e(!1),h=e(!1),f=e(!1),b=e(""),k=e(!1),E=e(!1),M=e(!1),C=e(!1),S=e(!1),V=e(""),N=e(""),D=e(""),P=e(!1),z=e(""),F=e(!1),J=e({}),H=e(!1),le=e(null),se=p({isM3U8Video:!1,M3U8VideoUrl:""}),ae=p({downloadList:[],playList:{M3U8List:[],normalVideoList:[],length:0},saveList:[],length:0});let re,ce,de,me,_e,xe,ve=!1,he=!1,fe=!1,pe=!1,we=!1,ge=!0,ye=!0,be=!1,ke=null,Ee=[],Le=new Set,Me=null,Ce=null;function Se(e){k.value=!1,ie({action:e,source:N.value,stat:"xl_action_error"})}function Ve(e){Se(e)}function Ue(e){S.value=!1,ie({action:e})}function qe(e){Ue(e)}function Te(e){P.value=!1,ie({action:e,stat:"xl_reminder_install"})}function $e(e){Te(e)}function je(){P.value=!0,chrome.runtime.sendMessage({name:"xl_prompt_show"})}function Ie(e){S.value=!0,D.value=e}function Be(){E.value=!1,Qe(),x.value=!0,chrome.runtime.sendMessage({name:"xl_screen",type:"close",stat:"browser_plugin_close_click"})}function Oe(e,t){return 0!=e.length&&(0!=pe&&(0!=function(e){if(0==e.length)return!1;const t=e,o=t.indexOf(":");if(-1==o)return!1;const n=t.substr(0,o+1).toUpperCase();if(""==n)return!1;let l=!0;return-1!=O.indexOf(n)?0==ve&&(l=!1):-1!=A.indexOf(n)?0==he&&(l=!1):-1!=R.indexOf(n)?0==fe&&(l=!1):l=!1,l}(e)&&(0!=function(e){if(0==e.length)return!0;const t=[],o=me.split("||");for(const s in o){const e=o[s].slice(2).trimRight("|");t.push(e)}let n=!0;const l=e;for(const s in t)if(t[s].length>0&&-1!=l.indexOf(t[s])){n=!1;break}return n}(t)&&(!oe(t,_e)&&0!=function(e){if(0==e.length)return!1;const t=e.indexOf(":");if(-1==t)return!1;const o=e.toLowerCase();if("xlapp://"==o.substr(0,t+3).trimLeft(" "))return!0;if(-1!=o.indexOf("ed2k://")||-1!=o.indexOf("magnet:?"))return!0;let n=!1,l=ne(o);return l.length>0&&(l+=";",-1!=xe.indexOf(l)&&(n=!0)),n}(e)))))}function Ae(e){return t=e,document.cookie,o=document.location.href,!te(t)&&Oe(t,o);var t,o}function Re(e){chrome.runtime.sendMessage({name:"CheckVideoInWhiteList",url:e},(async function(e){var t,o;F.value=e.exception,be=e.videoInWhiteList,re=e.bPlugin,ge=e.bMonitorVideo,ce=e.bWebsite,Me=e.fluentPlayConfig,C.value=!!(null==(t=null==e?void 0:e.fluentPlayConfig)?void 0:t.switch),Ce=e.downloadSniffConfig,M.value=!!(null==(o=null==e?void 0:e.downloadSniffConfig)?void 0:o.switch),be&&ge&&ce&&(nt(),chrome.runtime.sendMessage({name:"xl_screen",type:"init",data:{params:{playForm:document.referrer}}},e=>{se.isM3U8Video=e.isM3U8Video,se.M3U8VideoUrl=e.M3U8VideoUrl}),(Me.switch||Ce.switch)&&lt(),!re&&v.value&&await T()&&chrome.runtime.sendMessage({name:"xl_show_notifications"}))}))}function Ne(e){var t;if(e.ctrlKey)return;if(!e.isTrusted)return;const o=(null==(t=null==e?void 0:e.target)?void 0:t.href)||"";if(re&&ce&&de){let t=ee(o);if(null!=t)return;if(t=Ae(o),t)return chrome.runtime.sendMessage({name:"xl_download",link:o,cookie:document.cookie,referurl:document.location.href}),e.stopPropagation(),void e.preventDefault()}else F.value&&((n=(n=o).toLowerCase()).startsWith("thunder://")||n.startsWith("ed2k://")||n.startsWith("magnet:?")||n.includes(".torrent"))&&chrome.runtime.sendMessage({name:"xl_prompt_enable"},(function(e){e&&e.enable&&je()}));var n}function De(){if(v.value)for(const e of document.links)e.addEventListener("click",Ne,!1),null!==e.outerHTML.match($)&&(e.addEventListener("mouseenter",e=>{}),e.addEventListener("mouseleave",e=>{e.toElement.className}));else for(const e of document.links)e.addEventListener("click",Ne,!1)}function Pe(){document.getElementById(i);E.value=!1}async function Fe(e){do{if(x.value)break;const{M3U8VideoUrl:t}=se,o=document.getElementById(i),n=q(t||z.value);o.style.display="block";const l=o.querySelector(".xl-chrome-ext-tips.cloud-add"),s=o.querySelector(".xl-chrome-ext-tips.download"),a=j(Me,n.suffix,n.protocol),r=j(Ce,n.suffix,n.protocol);l&&!a&&(C.value=!1),s&&!r&&(M.value=!1);const c=e.getBoundingClientRect();let d="position: fixed !important; z-index: 10000000000 !important;";d+=`left: ${c.x+4}px; top: ${c.y+4}px;`,f.value&&(b.value=`top:${c.y+16}px`),o.style=d,we||(we=!0,chrome.runtime.sendMessage({name:"VideoShow",referurl:document.location.href,hasDownload:r,videoSrc:e.src},(function(){}))),E.value=!0,I(o)}while(0)}function We(e){e.isTrusted&&(e.ctrlKey&&chrome.runtime.sendMessage({name:"EnabledCapture",capture:!1},(function(){})),window.top!==window.self&&chrome.runtime.sendMessage({name:"xl_chrome_iframe_keydown",keyCode:e.keyCode}))}function Je(e){if(e.isTrusted&&(e.ctrlKey&&chrome.runtime.sendMessage({name:"EnabledCapture",capture:!0},(function(){})),ye))switch(e.keyCode){case 68:e.shiftKey&&(X()||re&&(window.top===window.self?xt.enter():chrome.runtime.sendMessage({name:"xl_chrome_iframe_multi_hotkey"})))}}function He(e){var t,o;try{const n=document.elementFromPoint(e.x,e.y);do{if(!n)break;if(null==(t=null==n?void 0:n.tagName)||t.toUpperCase(),"VIDEO"===(null==(o=null==n?void 0:n.tagName)?void 0:o.toUpperCase())){const{isM3U8Video:e}=se,t=n.src||Y(n,e);if(!t)break;if(0===(null==t?void 0:t.toLowerCase().indexOf("blob:"))&&!e)break;if(n===J.value)break;J.value=n,z.value=t||"",Fe(n);break}if(J.value){if(!Q(e,J.value)){J.value="",z.value="",Pe();break}}else{const t=document.getElementsByTagName("video");if(Ee=t,0===Ee.length)break;let o=null;for(let n=0;n<Ee.length;n++){const t=Ee[n];if("none"!==window.getComputedStyle(t).display)if(Q(e,t))if(o){const e=Number(window.getComputedStyle(t).zIndex)||0;e>(Number(window.getComputedStyle(o).zIndex)||0)&&(o=t)}else o=t;else if(o)break}if(o){const e=o.src||Y(o),{isM3U8Video:t}=se;(e&&0!==e.toLowerCase().indexOf("blob:")||t)&&(J.value=o,z.value=e,Fe(o));break}}}while(0)}catch(n){}}function Ke(){J.value&&(J.value="",z.value="",Pe())}function Xe(e){He(e)}function Ye(){J.value&&Fe(J.value)}function Qe(){document.body.removeEventListener("mousemove",He,!0),window.self!==window.top&&document.body.removeEventListener("mouseout",Ke),document.body.removeEventListener("wheel",Xe),document.removeEventListener("scroll",Ye),J.value="",z.value="",Ee=[],ke&&(ke.disconnect(),ke=null)}function Ze(){return window.top===window.self}function et(e){if("data"===e.data.type&&Ze())try{const t=JSON.parse(e.data.payload);Object.assign(ae,{...t}),r.value=!0}catch(t){}}function ot(e,t){chrome.runtime.sendMessage({name:"xl_show_action_error_dialog",source:t}),k.value=!0,V.value=e,N.value=t}function nt(){ge&&be&&!x.value&&(Qe(),async function(){do{if(ke)break;let t=null;try{t=window.top.document.getElementsByTagName("title")[0]}catch(e){}t&&(ke=new MutationObserver((function(){const e=document.getElementsByTagName("video");Ee=e})),ke.observe(t,{childList:!0})),Ee=await B(),L(Ee)}while(0)}(),document.body.addEventListener("mousemove",He,!0),window.self!==window.top&&document.body.addEventListener("mouseout",Ke),document.body.addEventListener("wheel",Xe),document.addEventListener("scroll",Ye))}d(v,()=>{De()}),d(_,e=>{e&&chrome.runtime.sendMessage({name:"xl_stat",eventId:974,extParam:{tabUrl:window.location.href}})});const lt=async()=>{Le=Z();0!==(await async function(){return new Promise(e=>{for(const t of Le){const o=q(t),{suffix:n,isVideoURL:l,protocol:s}=o,i=j(Me,n,s),a=j(Ce,n,s);let r=!1;if(("unknown"!==n||s)&&(a&&(ae.downloadList.push(o),r=!0),i&&(l&&(ae.playList[".m3u8"===n?"M3U8List":"normalVideoList"].push(o),ae.playList.length+=1),ae.saveList.push(o),r=!0),r&&(ae.length+=1),99===ae.length))return void e(ae)}setTimeout(()=>{const{M3U8VideoUrl:t}=se;if(t){if(ae.downloadList.some(e=>e.url===t))return void e(ae);const o=q(t);if(!j(Me,o.suffix,o.protocol)||!j(Ce,o.suffix,o.protocol))return;ae.downloadList.unshift(o),ae.playList.M3U8List.unshift(o),ae.saveList.unshift(o),ae.playList.length+=1,ae.length+=1}e(ae)},1500)})}()).length&&(Ze()?r.value=!0:window.parent.postMessage({type:"data",payload:JSON.stringify(ae)},"*"))};function st(){r.value=!1}const at=async()=>{var e;H.value=!0,e=document.location.href,chrome.runtime.sendMessage({name:"CheckActivated",url:e}),De(),Re(document.location.href),document.addEventListener("keydown",We),document.addEventListener("keyup",Je,!0),window.addEventListener("message",et),async function(){var e;try{const t=await G({name:"GetConfig"});if(!t)return;ve=t.bMonitorEmule,he=t.bMonitorMagnet,fe=t.bMonitorTradition,pe=t.bMonitorIE,me=t.monitorDomains,_e=t.filterDomains,xe=t.monitorFileExts,h.value=K(window.location.href,t.jsqConfig),u.value=(null==(e=null==t?void 0:t.jsqConfig)?void 0:e.text)||{},_.value=t.isStatGlobal}catch(t){}}()};return chrome.runtime.onMessage.addListener((function(e,t,o){if("UpdatePluginEnabled"==e.name)F.value=e.exception,re=e.enable,re||xt.quit();else if("UpdateMoniterVideoTags"==e.name)ge=e.enable;else if("UpdateMultiSelectShortcutEnable"==e.name)ye=e.enable;else if("UpdateWebsiteEnabled"==e.name)ce=e.enable;else if("UpdatePageEnabled"==e.name)de=e.enable;else if("OnActivated"==e.name)H.value&&async function(e,t,o){try{const n=await chrome.runtime.sendMessage({name:"CheckEnabled",url:e,tabId:t,topFrame:o});if(re=n.bPlugin,ge=n.bMonitorVideo,ce=n.bWebsite,de=n.bPage,ye=n.bShortcutEnable,v.value=n.isShowRecallInfo,!ge||!ce)return void Qe();nt()}catch(n){}}(document.location.href,e.tabId,window.top===window.self);else if("UpdateMonitorDomains"==e.name)me=e.monitorDomains;else{if("GetCookie"==e.name)return o({cookie:document.cookie}),!0;if("ThunderSupportReminder"===e.name)window.self===window.top&&je(e.text);else if("EnterMultiSelect"===e.name){if(U())return;xt.enter()}else if("xl_chrome_iframe_keydown"===e.name){if(window.top===window.self)switch(e.keyCode){case 13:xt.download();break;case 27:xt.quit()}}else if("xl_chrome_iframe_multi_hotkey"===e.name)window.top===window.self&&xt.enter();else if("GetAllImages"===e.name){if(window.top===window.self){const e=[];for(const t of document.images)t.src&&e.push({src:t.src,width:t.width,height:t.height,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight});return o(e),!0}}else"xl_recall_entry_click"===e.name||"appendFooterUI"===e.name&&(r.value=!0)}})),t(async()=>{at()}),w(()=>{window.removeEventListener("message",et),document.removeEventListener("keydown",We),document.removeEventListener("keyup",Je,!0),document.body.removeEventListener("mousemove",He,!0),Ze()||document.body.removeEventListener("mouseout",Ke),document.body.removeEventListener("wheel",Xe),document.removeEventListener("scroll",Ye)}),(e,t)=>(o(),n("div",{class:l(e.$style.content_wrapper),ref_key:"panelRef",ref:le},[m(g(it),{exception:F.value,latestVideoSrc:z.value,isShowVideoTag:E.value,isShowDownloadBar:M.value,isShowCloudAddBar:C.value,latestVideoElement:J.value,onShowActionError:ot,onShowVersionError:Ie,onHandleCloseBar:Be},null,8,["exception","latestVideoSrc","isShowVideoTag","isShowDownloadBar","isShowCloudAddBar","latestVideoElement"]),P.value?(o(),y(g(Ge),{key:0,onSubmit:$e,onCancel:Te})):a("",!0),k.value?(o(),y(g(ue),{key:1,text:V.value,onSubmit:Ve,onCancel:Se},null,8,["text"])):a("",!0),S.value?(o(),y(g(tt),{key:2,text:D.value,onSubmit:qe,onCancel:Ue},null,8,["text"])):a("",!0),r.value?(o(),y(g(ze),{key:3,tabUrl:c.value,isShowJsqEntry:h.value,jsqText:u.value,onRemoveFooter:st,resourceList:ae,exception:F.value},null,8,["tabUrl","isShowJsqEntry","jsqText","resourceList","exception"])):a("",!0)],2))}},[["__cssModules",{$style:{"content-wrapper":"_content-wrapper_20md8_1","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_20md8_1","options-wrapper":"_options-wrapper_20md8_7"}}]]),ht="xl_chrome_ext_"+W;let ft=!1;function pt(){if(document.getElementById(ht))return;document.body.parentNode;const e=document.createElement("div");e.className="xl-chrome-ext-bar_"+W,e.style.display="block",e.id=ht,document.body.appendChild(e)}try{pt(),wt(),ft=!0}catch(gt){ft=!1}function wt(){N?b(se).mount("#"+ht):b(vt).mount("#"+ht)}window.addEventListener("load",()=>{setTimeout(()=>{ft||(pt(),wt(),ft=!0)},0)});
