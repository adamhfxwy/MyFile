!function(g){g.un,g.uns;var N=g.static,r=g.class,t=g.getset,O=g.__newvec,V=laya.maths.Arith,U=laya.maths.Bezier,k=laya.resource.Bitmap,H=laya.utils.Browser,G=laya.utils.Byte,z=laya.utils.Color,p=(laya.filters.ColorFilter,g.Config),W=laya.resource.Context,Y=(laya.events.Event,laya.filters.Filter),e=laya.display.Graphics,X=laya.resource.HTMLCanvas,K=(laya.utils.HTMLChar,laya.resource.HTMLImage),Q=laya.resource.HTMLSubImage,v=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),Z=laya.maths.Point,q=laya.maths.Rectangle,c=laya.renders.Render,j=(laya.renders.RenderContext,laya.renders.RenderSprite),$=laya.resource.Resource,J=laya.resource.ResourceManager,s=laya.utils.RunDriver,tt=laya.display.Sprite,et=laya.display.Stage,it=laya.utils.Stat,rt=laya.utils.StringKey,st=(laya.display.css.Style,laya.system.System),at=laya.display.Text,nt=laya.resource.Texture,ht=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),lt=laya.utils.VectorGraphManager,i=(laya.utils.WordText,g.interface("laya.webgl.shapes.IShape"),g.interface("laya.webgl.submit.ISubmit"),g.interface("laya.webgl.text.ICharSegment"),g.interface("laya.webgl.canvas.save.ISaveData"),g.interface("laya.webgl.resource.IMergeAtlasBitmap"),g.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction"),r(ot,"laya.filters.webgl.FilterActionGL"),i=ot.prototype,g.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){},i.setValueMix=function(t){},i.apply3d=function(t,e,i,r,s){return null},i.apply=function(t){return null},t(0,i,"typeMix",function(){return 0}),ot);function ot(){}r(_t,"laya.webgl.shader.ShaderValue");var a=_t;function _t(){}r(ft,"laya.webgl.atlas.AtlasGrid"),(dt=ft.prototype).getAltasID=function(){return this._atlasID},dt.setAltasID=function(t){0<=t&&(this._atlasID=t)},dt.addTex=function(t,e,i){var r=this._get(e,i);return 0!=r.ret&&(this._fill(r.x,r.y,e,i,t),this._texCount++),r},dt._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},dt._init=function(t,e){if(this._width=t,this._height=e,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=O(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new ut;return this._clear(),!0},dt._get=function(t,e){var i=new mt;if(!(t>=this._failSize.width&&e>=this._failSize.height))for(var r=-1,s=this._width,a=this._height,n=this._cells,h=0;h<a;h++)if(!(this._rowInfo[h].spaceCount<t))for(var l=0;l<s;){var o=3*(h*s+l);if(0!=n[o]||n[1+o]<t||n[2+o]<e);else{for(var r=l,_=h,u=0;u<t;u++)if(n[3*u+o+2]<e){r=-1;break}if(!(r<0))return i.ret=!0,i.x=r,i.y=_,i}l+=n[1+o]}return i},dt._fill=function(t,e,i,r,s){var a=this._width,n=this._height;this._check(t+i<=a&&e+r<=n);for(var h=e;h<r+e;++h){this._check(this._rowInfo[h].spaceCount>=i),this._rowInfo[h].spaceCount-=i;for(var l=0;l<i;l++){var o=3*(t+h*a+l);this._check(0==this._cells[o]),this._cells[o]=s,this._cells[1+o]=i,this._cells[2+o]=r}}if(0<t)for(h=0;h<r;++h){for(var _=0,l=t-1;0<=l&&0==this._cells[3*((e+h)*a+l)];--l,++_);for(l=_;0<l;--l)this._cells[3*((e+h)*a+t-l)+1]=l,this._check(0<l)}if(0<e)for(l=t;l<t+i;++l){for(_=0,h=e-1;0<=h&&0==this._cells[3*(l+h*a)];--h,_++);for(h=_;0<h;--h)this._cells[3*(l+(e-h)*a)+2]=h,this._check(0<h)}},dt._check=function(t){0==t&&console.log("xtexMerger 错误啦")},dt._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var r=3*(e*this._width+i);this._cells[r]=0,this._cells[1+r]=this._width-i,this._cells[2+r]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},ft.__init$=function(){function t(){this.spaceCount=0}function e(){this.width=0,this.height=0}r(t,""),ut=t,r(e,""),ct=e};var ut,ct,dt=ft;function ft(t,e,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new ct,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=i}r(b,"laya.webgl.atlas.AtlasResourceManager"),(h=b.prototype).setAtlasParam=function(t,e,i,r){if(1==this._setAtlasParam)return b._sid_=0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=r,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},h.pushData=function(t){var e,i,r=t.bitmap,s=-1,a=null,n=0,h=0;for(n=0,e=this._atlaserArray.length;n<e&&(h=(this._curAtlasIndex+n)%e,-1==(s=(a=this._atlaserArray[h]).findBitmapIsExist(r)));n++);if(-1!=s)return f=(i=a.InAtlasWebGLImagesOffsetValue[s])[0],m=i[1],a.addToAtlas(t,f,m),!0;this._setAtlasParam=!1;for(var l=Math.ceil((t.bitmap.width+2)/this._gridSize),o=Math.ceil((t.bitmap.height+2)/this._gridSize),_=!1,u=0;u<2;u++){for(var c=this._maxAtlaserCount,n=0;n<c;n++){h=(this._curAtlasIndex+n)%c,this._atlaserArray.length-1>=h||this._atlaserArray.push(new Ie(this._gridNumX,this._gridNumY,this._width,this._height,b._sid_++));var d=this._atlaserArray[h],f=0,m=0,p=d.addTex(1,l,o);if(p.ret){f=p.x*this._gridSize+1,m=p.y*this._gridSize+1,r.lock=!0,d.addToAtlasTexture(r,f,m),d.addToAtlas(t,f,m),_=!0,this._curAtlasIndex=h;break}}if(_)break;this._atlaserArray.push(new Ie(this._gridNumX,this._gridNumY,this._width,this._height,b._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return _||console.log(">>>AtlasManager pushData error"),_},h.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},h.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},h.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},h.getAtlaserCount=function(){return this._atlaserArray.length},h.getAtlaserByIndex=function(t){return this._atlaserArray[t]},t(1,b,"instance",function(){return b._Instance=b._Instance?b._Instance:new b(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)}),t(1,b,"enabled",function(){return p.atlasEnable}),t(1,b,"atlasLimitWidth",function(){return b._atlasLimitWidth},function(t){b._atlasLimitWidth=t}),t(1,b,"atlasLimitHeight",function(){return b._atlasLimitHeight},function(t){b._atlasLimitHeight=t}),b._enable=function(){p.atlasEnable=!0},b._disable=function(){p.atlasEnable=!1},b.__init__=function(){b.atlasTextureWidth=2048,b.atlasTextureHeight=2048,b.maxTextureCount=6,b.atlasLimitWidth=512,b.atlasLimitHeight=512},b._atlasLimitWidth=0,b._atlasLimitHeight=0,b.gridSize=16,b.atlasTextureWidth=0,b.atlasTextureHeight=0,b.maxTextureCount=0,b._atlasRestore=0,b.BOARDER_TYPE_NO=0,b.BOARDER_TYPE_RIGHT=1,b.BOARDER_TYPE_LEFT=2,b.BOARDER_TYPE_BOTTOM=4,b.BOARDER_TYPE_TOP=8,b.BOARDER_TYPE_ALL=15,b._sid_=0,b._Instance=null;var x=b;function b(t,e,i,r){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=r,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}r(pt,"laya.webgl.atlas.MergeFillInfo");var mt=pt;function pt(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}r(n,"laya.webgl.canvas.BlendMode"),n._init_=function(t){n.fns=[n.BlendNormal,n.BlendAdd,n.BlendMultiply,n.BlendScreen,n.BlendOverlay,n.BlendLight,n.BlendMask,n.BlendDestinationOut],n.targetFns=[n.BlendNormalTarget,n.BlendAddTarget,n.BlendMultiplyTarget,n.BlendScreenTarget,n.BlendOverlayTarget,n.BlendLightTarget,n.BlendMask,n.BlendDestinationOut]},n.BlendNormal=function(t){t.blendFunc(1,771)},n.BlendAdd=function(t){t.blendFunc(1,772)},n.BlendMultiply=function(t){t.blendFunc(774,771)},n.BlendScreen=function(t){t.blendFunc(1,1)},n.BlendOverlay=function(t){t.blendFunc(1,769)},n.BlendLight=function(t){t.blendFunc(1,1)},n.BlendNormalTarget=function(t){t.blendFunc(1,771)},n.BlendAddTarget=function(t){t.blendFunc(1,772)},n.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},n.BlendScreenTarget=function(t){t.blendFunc(1,1)},n.BlendOverlayTarget=function(t){t.blendFunc(1,769)},n.BlendLightTarget=function(t){t.blendFunc(1,1)},n.BlendMask=function(t){t.blendFunc(0,770)},n.BlendDestinationOut=function(t){t.blendFunc(0,0)},n.activeBlendFunction=null,n.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],n.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},n.NORMAL="normal",n.ADD="add",n.MULTIPLY="multiply",n.SCREEN="screen",n.LIGHT="light",n.OVERLAY="overlay",n.DESTINATIONOUT="destination-out",n.fns=[],n.targetFns=[];var y=n;function n(){}r(xt,"laya.webgl.canvas.DrawStyle"),(h=xt.prototype).setValue=function(t){t&&("string"==typeof t?this._color=z.create(t):t instanceof laya.utils.Color&&(this._color=t))},h.reset=function(){this._color=z.create("black")},h.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color&&this._color.numColor===t.numColor},h.toColorStr=function(){return this._color.strColor},xt.create=function(t){var e;if(t&&("string"==typeof t?e=z.create(t):t instanceof laya.utils.Color&&(e=t),e))return e._drawStyle||(e._drawStyle=new xt(t));return laya.webgl.canvas.DrawStyle.DEFAULT},N(xt,["DEFAULT",function(){return this.DEFAULT=new xt("#000000")}]);var gt=xt;function xt(t){this._color=z.create("black"),this.setValue(t)}r(vt,"laya.webgl.canvas.Path"),(h=vt.prototype).addPoint=function(t,e){this.tempArray.push(t,e)},h.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},h.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},h.polygon=function(t,e,i,r,s,a){return this.geomatrys.push(this._curGeomatry=t=new Ne(t,e,i,r,s,a)),r||(t.fill=!1),null==a&&(t.borderWidth=0),t},h.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},h.drawLine=function(t,e,i,r,s){var a;return this.closePath?this.geomatrys.push(this._curGeomatry=a=new Fe(t,e,i,r,s)):this.geomatrys.push(this._curGeomatry=a=new Pe(t,e,i,r,s)),a.fill=!1,a},h.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/ce.BYTES_PIDX},h.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},h.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null};var bt=vt;function vt(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];E.mainContext;this.ib=Ii.create(35048),this.vb=Li.create(5)}r(Tt,"laya.webgl.canvas.save.SaveBase"),h=Tt.prototype,g.imps(h,{"laya.webgl.canvas.save.ISaveData":!0}),h.isSaveMark=function(){return!1},h.restore=function(t){this._dataObj[this._valueName]=this._value,(Tt._cache[Tt._cache._length++]=this)._newSubmit&&(t._curSubmit=d.RENDERBASE,t._renderKey=0)},Tt._createArray=function(){var t=[];return t._length=0,t},Tt._init=function(){var t=Tt._namemap={1:"ALPHA",2:"fillStyle",8:"font",256:"lineWidth",512:"strokeStyle",8192:"_mergeID"};return t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t},Tt.save=function(t,e,i,r){var s;(t._saveMark._saveuse&e)!==e&&(t._saveMark._saveuse|=e,(s=0<(s=Tt._cache)._length?s[--s._length]:new Tt)._value=i[s._valueName=Tt._namemap[e]],s._dataObj=i,s._newSubmit=r,(e=t._save)[e._length++]=s)},Tt._cache=laya.webgl.canvas.save.SaveBase._createArray(),Tt._namemap=Tt._init();var yt=Tt;function Tt(){}r(Et,"laya.webgl.canvas.save.SaveClipRect"),h=Et.prototype,g.imps(h,{"laya.webgl.canvas.save.ISaveData":!0}),h.isSaveMark=function(){return!1},h.restore=function(t){t._clipRect=this._clipSaveRect,(Et._cache[Et._cache._length++]=this)._submitScissor.submitLength=t._submits._length-this._submitScissor.submitIndex,t._curSubmit=d.RENDERBASE,t._renderKey=0},Et.save=function(t,e){var i;131072!=(131072&t._saveMark._saveuse)&&(t._saveMark._saveuse|=131072,(i=0<(i=Et._cache)._length?i[--i._length]:new Et)._clipSaveRect=t._clipRect,t._clipRect=i._clipRect.copyFrom(t._clipRect),i._submitScissor=e,(e=t._save)[e._length++]=i)},N(Et,["_cache",function(){return this._cache=yt._createArray()}]);var At=Et;function Et(){this._clipRect=new q}r(wt,"laya.webgl.canvas.save.SaveClipRectStencil"),h=wt.prototype,g.imps(h,{"laya.webgl.canvas.save.ISaveData":!0}),h.isSaveMark=function(){return!1},h.restore=function(t){re.restore(t,this._rect,this._saveMatrix,this._contextX,this._contextY),t._clipRect=this._clipSaveRect,t._curMat=this._saveMatrix,t._x=this._contextX,t._y=this._contextY,wt._cache[wt._cache._length++]=this,t._curSubmit=d.RENDERBASE},wt.save=function(t,e,i,r,s,a,n,h,l,o){var _;262144!=(262144&t._saveMark._saveuse)&&(t._saveMark._saveuse|=262144,(_=0<(_=wt._cache)._length?_[--_._length]:new wt)._clipSaveRect=t._clipRect,_._clipRect.setTo(n,h,l,o),t._clipRect=_._clipRect,_._rect.x=i,_._rect.y=r,_._rect.width=s,_._rect.height=a,_._contextX=t._x,_._contextY=t._y,_._saveMatrix=t._curMat,t._curMat.copyTo(_._matrix),t._curMat=_._matrix,_._submitStencil=e,(n=t._save)[n._length++]=_)},N(wt,["_cache",function(){return this._cache=yt._createArray()}]);var St=wt;function wt(){this._contextX=0,this._contextY=0,this._clipRect=new q,this._rect=new q,this._matrix=new v}r(It,"laya.webgl.canvas.save.SaveMark"),h=It.prototype,g.imps(h,{"laya.webgl.canvas.save.ISaveData":!0}),h.isSaveMark=function(){return!0},h.restore=function(t){t._saveMark=this._preSaveMark,It._no[It._no._length++]=this},It.Create=function(t){var e=It._no,e=0<e._length?e[--e._length]:new It;return e._saveuse=0,e._preSaveMark=t._saveMark,t._saveMark=e},N(It,["_no",function(){return this._no=yt._createArray()}]);var Rt=It;function It(){this._saveuse=0}r(Ct,"laya.webgl.canvas.save.SaveTransform"),h=Ct.prototype,g.imps(h,{"laya.webgl.canvas.save.ISaveData":!0}),h.isSaveMark=function(){return!1},h.restore=function(t){t._curMat=this._savematrix,Ct._no[Ct._no._length++]=this},Ct.save=function(t){var e=t._saveMark;2048!=(2048&e._saveuse)&&(e._saveuse|=2048,(e=0<(e=Ct._no)._length?e[--e._length]:new Ct)._savematrix=t._curMat,t._curMat=t._curMat.copyTo(e._matrix),(t=t._save)[t._length++]=e)},N(Ct,["_no",function(){return this._no=yt._createArray()}]);var Mt=Ct;function Ct(){this._matrix=new v}r(Pt,"laya.webgl.canvas.save.SaveTranslate"),h=Pt.prototype,g.imps(h,{"laya.webgl.canvas.save.ISaveData":!0}),h.isSaveMark=function(){return!1},h.restore=function(t){t._curMat;t._x=this._x,t._y=this._y,Pt._no[Pt._no._length++]=this},Pt.save=function(t){var e=Pt._no,e=0<e._length?e[--e._length]:new Pt,t=(e._x=t._x,e._y=t._y,t._save);t[t._length++]=e},N(Pt,["_no",function(){return this._no=yt._createArray()}]);var Lt=Pt;function Pt(){}r(Ft,"laya.webgl.resource.RenderTargetMAX"),(h=Ft.prototype).setSP=function(t){this._sp=t},h.size=function(t,e){var i=this;this._width===t&&this._height===e?this.target.size(t,e):(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=Ke.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){g.timer.callLater(i._sp,i._sp.repaint)}))},h._flushToTarget=function(t,e){var i,r,s,a,n,h,l;e._destroy||(i=u.worldScissorTest,r=u.worldClipRect,u.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,u.worldScissorTest=!1,E.mainContext.disable(3089),s=u.worldAlpha,a=u.worldMatrix4,n=u.worldMatrix,h=u.worldFilters,l=u.worldShaderDefines,u.worldMatrix=v.EMPTY,u.restoreTempArray(),u.worldMatrix4=u.TEMPMAT4_ARRAY,u.worldAlpha=1,u.worldFilters=null,u.worldShaderDefines=null,We.activeShader=null,e.start(),p.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),We.activeShader=null,u.worldAlpha=s,u.worldMatrix4=a,u.worldMatrix=n,u.worldFilters=h,u.worldShaderDefines=l,(u.worldScissorTest=i)&&(t=u.height-r.y-r.height,E.mainContext.scissor(r.x,t,r.width,r.height),E.mainContext.enable(3089)),u.worldClipRect=r)},h.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},h.drawTo=function(t,e,i,r,s){t.drawTexture(this.target.getTexture(),e,i,r,s,0,0)},h.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)};var Dt=Ft;function Ft(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new q}r(Nt,"laya.webgl.shader.d2.Shader2D"),Nt.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},Nt.__init__=function(){D.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),D.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),D.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),D.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),D.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),D.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),D.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),D.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),D.preCompile2D(0,1,"attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",'precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',null),D.preCompile2D(0,2,"attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",'precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',null),D.preCompile2D(0,4,"attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}","precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",null),D.preCompile2D(0,256,"attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",'#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',null),D.preCompile2D(0,512,"attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}","precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",null)};var Bt=Nt;function Nt(){this.ALPHA=1,this.shaderType=0,this.defines=new Ce}r(Vt,"laya.webgl.shader.ShaderDefines"),(h=Vt.prototype).add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},h.addInt=function(t){return this._value|=t,this._value},h.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},h.isDefine=function(t){return(this._value&t)===t},h.getValue=function(){return this._value},h.setValue=function(t){this._value=t},h.toNameDic=function(){var t=this._int2nameMap[this._value];return t||Vt._toText(this._value,this._int2name,this._int2nameMap)},Vt._reg=function(t,e,i,r){r[i[t]=e]=t},Vt._toText=function(t,e,i){var r=i[t];if(r)return r;for(var s,a,n={},h=0;h<32&&!(t<(s=1<<h));h++)t&s&&(a=e[s])&&(n[a]="");return i[t]=n},Vt._toInt=function(t,e){for(var i=t.split("."),r=0,s=0,a=i.length;s<a;s++){var n=e[i[s]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[s]);r|=n}return r};var Ot=Vt;function Vt(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}r(kt,"laya.webgl.shader.d2.skinAnishader.SkinMesh"),(h=kt.prototype).init=function(t,e,i){var r;e?this._vs=e:(this._vs=[],e=t.width,r=t.height,this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(e,0,1,0,1,1,1,1),this._vs.push(e,r,1,1,1,1,1,1),this._vs.push(0,r,0,1,1,1,1,1)),i?this._ps=i:(kt._defaultPS||(kt._defaultPS=[]).push(0,1,3,3,1,2),this._ps=kt._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=t},h.init2=function(t,e,i,r,s){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=r,this._uvs=s,this.mEleNum=this._ps.length,this.mTexture=t,(c.isConchNode||c.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},h._initMyData=function(){var t=0,e=0,i=4*this._verticles.length,r=(this._vs=kt._tempVS,!1);if((c.isConchNode||c.isConchApp||this._vs.length<i)&&(this._vs.length=i,r=!0),kt._tVSLen=i,r)for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],this._vs[t+4]=1,this._vs[t+5]=1,this._vs[t+6]=1,this._vs[t+7]=1,t+=8,e+=2;else for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],t+=8,e+=2},h.getData2=function(t,e,i){var r;this.mVBBuffer=t,this.mIBBuffer=e,this._initMyData(),t.appendEx2(this._vs,Float32Array,kt._tVSLen,4),this._indexStart=e._byteLength,(r=kt._tempIB).length<this._ps.length&&(r.length=this._ps.length);for(var s=0,a=this._ps.length;s<a;s++)r[s]=this._ps[s]+i;e.appendEx2(r,Uint16Array,this._ps.length,2)},h.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var r=0,s=this._ps.length;r<s;r++)this.mIBData[r]=this._ps[r]+i;this.mIBData.start=i}e.append(this.mIBData)},h.render=function(t,e,i){var r,s,a;c.isWebGL&&this.mTexture?(t._renderKey=0,t._shader2D.glTexture=null,Ht.getInstance().addSkinMesh(this),r=d.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,C.create(512,0)),this.transform||(this.transform=v.EMPTY),this.transform.translate(e,i),v.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i),a=(s=r.shaderValue).u_mmat2||u.getMatrArray(),u.mat2MatArray(this._tempMatrix,a),s.textureHost=this.mTexture,s.offsetX=0,s.offsetY=0,s.u_mmat2=a,s.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=r):c.isConchApp&&this.mTexture&&(this.transform||(this.transform=v.EMPTY),t.setSkinMesh)&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform)},kt._tempVS=[],kt._tempIB=[],kt._defaultPS=null,kt._tVSLen=0;var Ut=kt;function kt(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new v}r(Gt,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer"),(h=Gt.prototype).addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},h.reset=function(){this.vb.clear(),this.ib.clear()},Gt.getInstance=function(){return Gt.instance=Gt.instance||new Gt},Gt.instance=null;var Ht=Gt;function Gt(){this.ib=null,this.vb=null;E.mainContext;this.ib=Ii.create(35048),this.vb=Li.create(8)}r(zt,"laya.webgl.shapes.BasePoly"),h=zt.prototype,g.imps(h,{"laya.webgl.shapes.IShape":!0}),h.getData=function(t,e,i){},h.rebuild=function(t){},h.setMatrix=function(t){},h.needUpdate=function(t){return!0},h.sector=function(t,e,i){var r=this.x,s=this.y,a=this.edges,n=(this.r1-this.r0)/a,h=this.width,l=this.height,o=this.color,_=(o>>16&255)/255,u=(o>>8&255)/255,c=(255&o)/255;t.push(r,s,_,u,c);for(var d=0;d<a+1;d++)t.push(r+Math.sin(n*d+this.r0)*h,s+Math.cos(n*d+this.r0)*l),t.push(_,u,c);for(d=0;d<a;d++)e.push(i,i+d+1,i+d+2)},h.createLine2=function(t,e,i,r,s,a){var n,h,l,o,_,u,c,d=t.concat(),f=s,t=this.borderColor,m=(t>>16&255)/255,p=(t>>8&255)/255,g=(255&t)/255,x=d.length/2,b=r,v=i/2,y=d[0],T=d[1],A=d[2],E=d[3],S=-(T-E),w=y-A,R=Math.sqrt(S*S+w*w);f.push(y-(S=S/R*v)+this.x,T-(w=w/R*v)+this.y,m,p,g,y+S+this.x,T+w+this.y,m,p,g);for(var I=1;I<x-1;I++)y=d[2*(I-1)],T=d[2*(I-1)+1],A=d[2*I],E=d[2*I+1],o=d[2*(I+1)],h=d[2*(I+1)+1],w=y-A,c=A-o,l=(-(S=(S=-(T-E))/(R=Math.sqrt(S*S+w*w))*v)+y)*(-(w=w/R*v)+E)-(-S+A)*(-w+T),u=(-(_=(_=-(E-h))/(R=Math.sqrt(_*_+c*c))*v)+o)*(-(c=c/R*v)+E)-(-_+A)*(-c+h),c=(n=-w+T-(-w+E))*(_=-_+A-(-_+o))-(o=-c+h-(-c+E))*(h=-S+A-(-S+y)),Math.abs(c)<.1?(c+=10.1,f.push(A-S+this.x,E-w+this.y,m,p,g,A+S+this.x,E+w+this.y,m,p,g)):(h=(h*u-_*l)/c,_=(o*l-n*u)/c,f.push(h+this.x,_+this.y,m,p,g,A-(h-A)+this.x,E-(_-E)+this.y,m,p,g));y=d[d.length-4],T=d[d.length-3],A=d[d.length-2],S=-(T-(E=d[d.length-1])),w=y-A,R=Math.sqrt(S*S+w*w),f.push(A-(S=S/R*v)+this.x,E-(w=w/R*v)+this.y,m,p,g,A+S+this.x,E+w+this.y,m,p,g);for(var M=a,I=1;I<M;I++)e.push(b+2*(I-1),b+2*(I-1)+1,b+2*I+1,b+2*I+1,b+2*I,b+2*(I-1));return f},h.createLine=function(t,e,i,r){var s,a,n,h,l,o,_,u=t.concat(),c=t,t=this.borderColor,d=(t>>16&255)/255,f=(t>>8&255)/255,m=(255&t)/255,p=(u.splice(0,5),u.length/5),g=r,x=i/2,b=u[0],v=u[1],y=u[5],T=u[6],A=-(v-T),E=b-y,S=Math.sqrt(A*A+E*E);c.push(b-(A=A/S*x),v-(E=E/S*x),d,f,m,b+A,v+E,d,f,m);for(var w=1;w<p-1;w++)b=u[5*(w-1)],v=u[5*(w-1)+1],y=u[5*w],T=u[5*w+1],h=u[5*(w+1)],a=u[5*(w+1)+1],E=b-y,_=y-h,n=(-(A=(A=-(v-T))/(S=Math.sqrt(A*A+E*E))*x)+b)*(-(E=E/S*x)+T)-(-A+y)*(-E+v),o=(-(l=(l=-(T-a))/(S=Math.sqrt(l*l+_*_))*x)+h)*(-(_=_/S*x)+T)-(-l+y)*(-_+a),_=(s=-E+v-(-E+T))*(l=-l+y-(-l+h))-(h=-_+a-(-_+T))*(a=-A+y-(-A+b)),Math.abs(_)<.1?(_+=10.1,c.push(y-A,T-E,d,f,m,y+A,T+E,d,f,m)):(a=(a*o-l*n)/_,l=(h*n-s*o)/_,c.push(a,l,d,f,m,y-(a-y),T-(l-T),d,f,m));b=u[u.length-10],v=u[u.length-9],y=u[u.length-5],A=-(v-(T=u[u.length-4])),E=b-y,S=Math.sqrt(A*A+E*E),c.push(y-(A=A/S*x),T-(E=E/S*x),d,f,m,y+A,T+E,d,f,m);for(var R=this.edges+1,w=1;w<R;w++)e.push(g+2*(w-1),g+2*(w-1)+1,g+2*w+1,g+2*w+1,g+2*w,g+2*(w-1));return c},h.createLoopLine=function(t,e,i,r,s,a){var n,h,l,o,_,u,c,d=t.concat(),f=s||t,s=this.borderColor,m=(s>>16&255)/255,p=(s>>8&255)/255,g=(255&s)/255,t=(d.splice(0,5),[d[0],d[1]]),s=[d[d.length-5],d[d.length-4]],x=s[0]+.5*(t[0]-s[0]),t=s[1]+.5*(t[1]-s[1]),b=(d.unshift(x,t,0,0,0),d.push(x,t,0,0,0),d.length/5),v=r,y=i/2,T=d[0],A=d[1],E=d[5],S=d[6],w=-(A-S),R=T-E,I=Math.sqrt(w*w+R*R);f.push(T-(w=w/I*y),A-(R=R/I*y),m,p,g,T+w,A+R,m,p,g);for(var M=1;M<b-1;M++)T=d[5*(M-1)],A=d[5*(M-1)+1],E=d[5*M],S=d[5*M+1],o=d[5*(M+1)],h=d[5*(M+1)+1],R=T-E,c=E-o,l=(-(w=(w=-(A-S))/(I=Math.sqrt(w*w+R*R))*y)+T)*(-(R=R/I*y)+S)-(-w+E)*(-R+A),u=(-(_=(_=-(S-h))/(I=Math.sqrt(_*_+c*c))*y)+o)*(-(c=c/I*y)+S)-(-_+E)*(-c+h),c=(n=-R+A-(-R+S))*(_=-_+E-(-_+o))-(o=-c+h-(-c+S))*(h=-w+E-(-w+T)),Math.abs(c)<.1?(c+=10.1,f.push(E-w,S-R,m,p,g,E+w,S+R,m,p,g)):(h=(h*u-_*l)/c,_=(o*l-n*u)/c,f.push(h,_,m,p,g,E-(h-E),S-(_-S),m,p,g));a&&(e=a);for(var C=this.edges+1,M=1;M<C;M++)e.push(v+2*(M-1),v+2*(M-1)+1,v+2*M+1,v+2*M+1,v+2*M,v+2*(M-1));return e.push(v+2*(M-1),v+2*(M-1)+1,v+1,v+1,v,v+2*(M-1)),f};var h=zt;function zt(t,e,i,r,s,a,n,h,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=r,this.edges=s,this.color=a,this.borderWidth=n,this.borderColor=h}r(m,"laya.webgl.shapes.Earcut"),m.earcut=function(t,e,i){i=i||2;var r,s,a,n,h,l=e&&e.length,o=l?e[0]*i:t.length,_=m.linkedList(t,0,o,i,!0),u=[];if(_){if(l&&(_=m.eliminateHoles(t,e,_,i)),t.length>80*i){for(var c=r=t[0],d=s=t[1],f=i;f<o;f+=i)(a=t[f])<c&&(c=a),(n=t[f+1])<d&&(d=n),r<a&&(r=a),s<n&&(s=n);h=0!==(h=Math.max(r-c,s-d))?1/h:0}m.earcutLinked(_,u,i,c,d,h)}return u},m.linkedList=function(t,e,i,r,s){var a,n;if(s===0<m.signedArea(t,e,i,r))for(a=e;a<i;a+=r)n=m.insertNode(a,t[a],t[a+1],n);else for(a=i-r;e<=a;a-=r)n=m.insertNode(a,t[a],t[a+1],n);return n&&m.equals(n,n.next)&&(m.removeNode(n),n=n.next),n},m.filterPoints=function(t,e){if(!t)return t;e=e||t;var i,r=t;do{if(i=!1,r.steiner||!m.equals(r,r.next)&&0!==m.area(r.prev,r,r.next))r=r.next;else{if(m.removeNode(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e},m.earcutLinked=function(t,e,i,r,s,a,n){if(t){!n&&a&&m.indexCurve(t,r,s,a);for(var h,l,o=t;t.prev!==t.next;)if(h=t.prev,l=t.next,a?m.isEarHashed(t,r,s,a):m.isEar(t))e.push(h.i/i),e.push(t.i/i),e.push(l.i/i),m.removeNode(t),t=l.next,o=l.next;else if((t=l)===o){n?1===n?(t=m.cureLocalIntersections(t,e,i),m.earcutLinked(t,e,i,r,s,a,2)):2===n&&m.splitEarcut(t,e,i,r,s,a):m.earcutLinked(m.filterPoints(t,null),e,i,r,s,a,1);break}}},m.isEar=function(t){var e=t.prev,i=t,r=t.next;if(0<=m.area(e,i,r))return!1;for(var s=t.next.next;s!==t.prev;){if(m.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&0<=m.area(s.prev,s,s.next))return!1;s=s.next}return!0},m.isEarHashed=function(t,e,i,r){var s=t.prev,a=t,n=t.next;if(0<=m.area(s,a,n))return!1;for(var h=(s.x<a.x?s.x<n.x?s:n:a.x<n.x?a:n).x,l=(s.y<a.y?s.y<n.y?s:n:a.y<n.y?a:n).y,o=(s.x>a.x?s.x>n.x?s:n:a.x>n.x?a:n).x,_=(s.y>a.y?s.y>n.y?s:n:a.y>n.y?a:n).y,u=m.zOrder(h,l,e,i,r),c=m.zOrder(o,_,e,i,r),d=t.nextZ;d&&d.z<=c;){if(d!==t.prev&&d!==t.next&&m.pointInTriangle(s.x,s.y,a.x,a.y,n.x,n.y,d.x,d.y)&&0<=m.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&m.pointInTriangle(s.x,s.y,a.x,a.y,n.x,n.y,d.x,d.y)&&0<=m.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0},m.cureLocalIntersections=function(t,e,i){var r=t;do{var s=r.prev,a=r.next.next}while(!m.equals(s,a)&&m.intersects(s,r,r.next,a)&&m.locallyInside(s,a)&&m.locallyInside(a,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(a.i/i),m.removeNode(r),m.removeNode(r.next),r=t=a),(r=r.next)!==t);return r},m.splitEarcut=function(t,e,i,r,s,a){var n=t;do{for(var h,l=n.next.next;l!==n.prev;){if(n.i!==l.i&&m.isValidDiagonal(n,l))return h=m.splitPolygon(n,l),n=m.filterPoints(n,n.next),h=m.filterPoints(h,h.next),m.earcutLinked(n,e,i,r,s,a),void m.earcutLinked(h,e,i,r,s,a);l=l.next}}while((n=n.next)!==t)},m.eliminateHoles=function(t,e,i,r){for(var s,a,n=[],h=0,l=e.length;h<l;h++)a=e[h]*r,s=h<l-1?e[h+1]*r:t.length,(a=m.linkedList(t,a,s,r,!1))===a.next&&(a.steiner=!0),n.push(m.getLeftmost(a));for(n.sort(m.compareX),h=0;h<n.length;h++)m.eliminateHole(n[h],i),i=m.filterPoints(i,i.next);return i},m.compareX=function(t,e){return t.x-e.x},m.eliminateHole=function(t,e){(e=m.findHoleBridge(t,e))&&(e=m.splitPolygon(e,t),m.filterPoints(e,e.next))},m.findHoleBridge=function(t,e){var i,r=e,s=t.x,a=t.y,n=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var h=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=s&&n<h){if((n=h)===s){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}}while((r=r.next)!==e);if(!i)return null;if(s===n)return i.prev;for(var l,o=i,_=i.x,u=i.y,c=1/0,r=i.next;r!==o;)s>=r.x&&r.x>=_&&s!==r.x&&m.pointInTriangle(a<u?s:n,a,_,u,a<u?n:s,a,r.x,r.y)&&((l=Math.abs(a-r.y)/(s-r.x))<c||l===c&&r.x>i.x)&&m.locallyInside(r,t)&&(i=r,c=l),r=r.next;return i},m.indexCurve=function(t,e,i,r){for(var s=t;null===s.z&&(s.z=m.zOrder(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,(s=s.next)!==t;);s.prevZ.nextZ=null,s.prevZ=null,m.sortLinked(s)},m.sortLinked=function(t){var e,i,r,s,a,n,h,l,o=1;do{for(i=t,a=t=null,n=0;i;){for(n++,r=i,e=h=0;e<o&&(h++,r=r.nextZ);e++);for(l=o;0<h||0<l&&r;)0!==h&&(0===l||!r||i.z<=r.z)?(i=(s=i).nextZ,h--):(r=(s=r).nextZ,l--),a?a.nextZ=s:t=s,s.prevZ=a,a=s;i=r}}while(a.nextZ=null,o*=2,1<n);return t},m.zOrder=function(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1},m.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},m.pointInTriangle=function(t,e,i,r,s,a,n,h){return 0<=(s-n)*(e-h)-(t-n)*(a-h)&&0<=(t-n)*(r-h)-(i-n)*(e-h)&&0<=(i-n)*(a-h)-(s-n)*(r-h)},m.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!m.intersectsPolygon(t,e)&&m.locallyInside(t,e)&&m.locallyInside(e,t)&&m.middleInside(t,e)},m.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},m.equals=function(t,e){return t.x===e.x&&t.y===e.y},m.intersects=function(t,e,i,r){return!!(m.equals(t,e)&&m.equals(i,r)||m.equals(t,r)&&m.equals(i,e))||0<m.area(t,e,i)!=0<m.area(t,e,r)&&0<m.area(i,r,t)!=0<m.area(i,r,e)},m.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&m.intersects(i,i.next,t,e))return!0}while((i=i.next)!==t);return!1},m.locallyInside=function(t,e){return m.area(t.prev,t,t.next)<0?0<=m.area(t,e,t.next)&&0<=m.area(t,t.prev,e):m.area(t,e,t.prev)<0||m.area(t,t.next,e)<0},m.middleInside=function(t,e){for(var i=t,r=!1,s=(t.x+e.x)/2,a=(t.y+e.y)/2;i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==t;);return r},m.splitPolygon=function(t,e){var i=new Yt(t.i,t.x,t.y),r=new Yt(e.i,e.x,e.y),s=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=s).prev=i,(r.next=i).prev=r,(a.next=r).prev=a,r},m.insertNode=function(t,e,i,r){t=new Yt(t,e,i);return r?(t.next=r.next,(t.prev=r).next.prev=t,r.next=t):(t.prev=t).next=t,t},m.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},m.signedArea=function(t,e,i,r){for(var s=0,a=e,n=i-r;a<i;a+=r)s+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return s};var Wt=m;function m(){}r(Xt,"laya.webgl.shapes.EarcutNode");var Yt=Xt;function Xt(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}r(Kt,"laya.webgl.shapes.GeometryData"),(_=Kt.prototype).clone=function(){return new Kt(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},_.getIndexData=function(){return null},_.getVertexData=function(){return null},_.destroy=function(){this.shape=null};function Kt(t,e,i,r,s,a,n){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=r,this.fillAlpha=s,this.shape=n,this.fill=a}r(Qt,"laya.webgl.shapes.Vertex"),_=Qt.prototype,g.imps(_,{"laya.webgl.shapes.IShape":!0}),_.getData=function(t,e,i){},_.needUpdate=function(t){return!1},_.rebuild=function(t){},_.setMatrix=function(t){};function Qt(t){t instanceof Float32Array?this.points=t:t instanceof Array&&(t.length,this.points=new Float32Array(t))}r(l,"laya.webgl.submit.Submit"),_=l.prototype,g.imps(_,{"laya.webgl.submit.ISubmit":!0}),_.releaseRender=function(){var t=l._cache;(t[t._length++]=this).shaderValue.release(),this._vb=null},_.getRenderType=function(){return this._renderType},_.renderSubmit=function(){if(0!==this._numEle){var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);t=E.mainContext;this.shaderValue.upload(),y.activeBlendFunction!==this._blendFn&&(t.enable(3042),this._blendFn(t),y.activeBlendFunction=this._blendFn),it.drawCall++,it.trianglesFaces+=this._numEle/3,t.drawElements(4,this._numEle,5123,this._startIdx)}return 1},l.__init__=function(){var t=l.RENDERBASE=new l(-1);t.shaderValue=new C(0,0),t.shaderValue.ALPHA=-1234},l.createSubmit=function(t,e,i,r,s){var a=l._cache._length?l._cache[--l._cache._length]:new l,e=(null==i&&((i=a._selfVb||(a._selfVb=Li.create(-1))).clear(),r=0),a._ib=e,a._vb=i,a._startIdx=r*ce.BYTES_PIDX,a._numEle=0,t._nBlendType),i=(a._blendFn=(t._targets?y.targetFns:y.fns)[e],a.shaderValue=s,a.shaderValue.setValue(t._shader2D),t._shader2D.filters);return i&&a.shaderValue.setFilters(i),a},l.createShape=function(t,e,i,r,s,a){var n=l._cache._length?l._cache[--l._cache._length]:new l,e=(n._ib=e,n._vb=i,n._numEle=r,n._startIdx=s,n.shaderValue=a,n.shaderValue.setValue(t._shader2D),t._nBlendType);return n._blendFn=(t._targets?y.targetFns:y.fns)[e],n},l.TYPE_2D=1e4,l.TYPE_CANVAS=10003,l.TYPE_CMDSETRT=10004,l.TYPE_CUSTOM=10005,l.TYPE_BLURRT=10006,l.TYPE_CMDDESTORYPRERT=10007,l.TYPE_DISABLESTENCIL=10008,l.TYPE_OTHERIBVB=10009,l.TYPE_PRIMITIVE=10010,l.TYPE_RT=10011,l.TYPE_BLUR_RT=10012,l.TYPE_TARGET=10013,l.TYPE_CHANGE_VALUE=10014,l.TYPE_SHAPE=10015,l.TYPE_TEXTURE=10016,l.TYPE_FILLTEXTURE=10017,l.RENDERBASE=null,l._cache=((l._cache=[])._length=0,l._cache);var d=l;function l(t){this._renderType=t=void 0===t?1e4:t}r(qt,"laya.webgl.submit.SubmitCMD"),_=qt.prototype,g.imps(_,{"laya.webgl.submit.ISubmit":!0}),_.renderSubmit=function(){return this.fun.apply(null,this.args),1},_.getRenderType=function(){return 0},_.releaseRender=function(){var t=qt._cache;t[t._length++]=this},qt.create=function(t,e){var i=qt._cache._length?qt._cache[--qt._cache._length]:new qt;return i.fun=e,i.args=t,i},qt._cache=((qt._cache=[])._length=0,qt._cache);var Zt=qt;function qt(){this.fun=null,this.args=null}r($t,"laya.webgl.submit.SubmitCMDScope"),(_=$t.prototype).getValue=function(t){return this.variables[t]},_.addValue=function(t,e){return this.variables[t]=e},_.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},_.clear=function(){for(var t in this.variables)delete this.variables[t]},_.recycle=function(){this.clear(),$t.POOL.push(this)},$t.create=function(){return $t.POOL.pop()||new $t},$t.POOL=[];var jt=$t;function $t(){this.variables={}}r(te,"laya.webgl.submit.SubmitOtherIBVB"),_=te.prototype,g.imps(_,{"laya.webgl.submit.ISubmit":!0}),_.releaseRender=function(){var t=te._cache;t[t._length++]=this},_.getRenderType=function(){return 10009},_.renderSubmit=function(){var t=this._shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this._shaderValue.texture=e}this._vb.bind_upload(this._ib);var t=u.worldMatrix4,e=v.TEMP,i=(v.mulPre(this._mat,t[0],t[1],t[4],t[5],t[12],t[13],e),u.worldMatrix4=te.tempMatrix4),i=(i[0]=e.a,i[1]=e.b,i[4]=e.c,i[5]=e.d,i[12]=e.tx,i[13]=e.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0,E.mainContext);return y.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),y.activeBlendFunction=this._blendFn),it.drawCall++,it.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this.startIndex),u.worldMatrix4=t,We.activeShader=null,1},te.create=function(t,e,i,r,s,a,n,h,l){void 0===l&&(l=0);var o=te._cache._length?te._cache[--te._cache._length]:new te,i=(o._ib=i,o._vb=e,o._numEle=r,o._shader=s,o._shaderValue=a,t._nBlendType);switch(o._blendFn=(t._targets?y.targetFns:y.fns)[i],l){case 0:o.offset=0,o.startIndex=h/(ce.BYTES_PE*e.vertexStride)*1.5,o.startIndex*=ce.BYTES_PIDX;break;case 1:o.startIndex=n,o.offset=h}return o},te._cache=((te._cache=[])._length=0,te._cache),te.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var Jt=te;function te(){this.offset=0,this.startIndex=0,this._mat=v.create()}r(ie,"laya.webgl.submit.SubmitScissor"),_=ie.prototype,g.imps(_,{"laya.webgl.submit.ISubmit":!0}),_._scissor=function(t,e,i,r){var s=u.worldMatrix4,a=s[0],n=s[5],h=s[12],s=s[13];return r*=n,!((i*=a)<1||r<1||(a=(t=t*a+h)+i,h=(e=e*n+s)+r,t<0&&(i=a-(t=0)),e<0&&(r=h-(e=0)),n=u.worldClipRect,t=Math.max(t,n.x),e=Math.max(e,n.y),i=Math.min(a,n.right)-t,r=Math.min(h,n.bottom)-e,i<1)||r<1||(s=u.worldScissorTest,this.screenRect.copyFrom(n),n.x=t,n.y=e,n.width=i,n.height=r,u.worldScissorTest=!0,e=u.height-e-r,E.mainContext.scissor(t,e,i,r),E.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),s?(e=u.height-this.screenRect.y-this.screenRect.height,E.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),E.mainContext.enable(3089)):(E.mainContext.disable(3089),u.worldScissorTest=!1),n.copyFrom(this.screenRect),0))},_._scissorWithTagart=function(t,e,i,r){var s,a,n;return!(i<1||r<1||(n=t+i,s=e+r,t<0&&(i=n-(t=0)),e<0&&(r=s-(e=0)),a=u.worldClipRect,t=Math.max(t,a.x),e=Math.max(e,a.y),i=Math.min(n,a.right)-t,r=Math.min(s,a.bottom)-e,i<1)||r<1||(n=u.worldScissorTest,this.screenRect.copyFrom(a),u.worldScissorTest=!0,a.x=t,a.y=e,a.width=i,a.height=r,e=u.height-e-r,E.mainContext.scissor(t,e,i,r),E.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),n?(e=u.height-this.screenRect.y-this.screenRect.height,E.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),E.mainContext.enable(3089)):(E.mainContext.disable(3089),u.worldScissorTest=!1),a.copyFrom(this.screenRect),0))},_.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},_.getRenderType=function(){return 0},_.releaseRender=function(){var t=ie._cache;(t[t._length++]=this).context=null},ie.create=function(t){var e=ie._cache._length?ie._cache[--ie._cache._length]:new ie;return e.context=t,e},ie._cache=((ie._cache=[])._length=0,ie._cache);var ee=ie;function ie(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new q,this.screenRect=new q}r(o,"laya.webgl.submit.SubmitStencil"),_=o.prototype,g.imps(_,{"laya.webgl.submit.ISubmit":!0}),_.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},_.getRenderType=function(){return 0},_.releaseRender=function(){var t=o._cache;t[t._length++]=this},_.do1=function(){var t=E.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},_.do2=function(){var t=E.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},_.do3=function(){var t=E.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},_.do4=function(){var t=E.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},_.do5=function(){var t=E.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},_.do6=function(){var t=E.mainContext;y.targetFns[y.TOINT[this.blendMode]](t)},_.do7=function(){var t=E.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},_.do8=function(){var t=E.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},o.restore=function(t,e,i,r,s){var a,n;(t._renderKey=0)<o._mask&&o._mask--,0==o._mask?(a=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(a),t._curSubmit=d.RENDERBASE):(a=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(a),(n=t._vb)._byteLength,T.fillRectImgVb(n,null,e.x,e.y,e.width,e.height,nt.DEF_UV,i,r,s,0,0)?(t._shader2D.glTexture=null,(e=t._curSubmit=d.createSubmit(t,t._ib,n,(n._byteLength-64)/32*3,C.create(2,0))).shaderValue.ALPHA=1,t._submits[t._submits._length++]=e,t._curSubmit._numEle+=6,t._curSubmit=d.RENDERBASE):alert("clipRect calc stencil rect error"),a=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(a))},o.restore2=function(t,e){var i;(t._renderKey=0)<o._mask&&o._mask--,0==o._mask?(i=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(i),t._curSubmit=d.RENDERBASE):(i=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(i),t._submits[t._submits._length++]=e,i=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(i))},o.create=function(t){var e=o._cache._length?o._cache[--o._cache._length]:new o;return 5==(e.step=t)&&++o._mask,e.level=o._mask,e},o._cache=((o._cache=[])._length=0,o._cache),o._mask=0;var re=o;function o(){this.step=0,this.blendMode=null,this.level=0}r(ae,"laya.webgl.submit.SubmitTarget"),_=ae.prototype,g.imps(_,{"laya.webgl.submit.ISubmit":!0}),_.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),it.drawCall++,it.trianglesFaces+=this._numEle/3,E.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},_.blend=function(){var t;y.activeBlendFunction!==y.fns[this.blendType]&&((t=E.mainContext).enable(3042),y.fns[this.blendType](t),y.activeBlendFunction=y.fns[this.blendType])},_.getRenderType=function(){return 0},_.releaseRender=function(){var t=ae._cache;t[t._length++]=this},ae.create=function(t,e,i,r,s,a){var n=ae._cache._length?ae._cache[--ae._cache._length]:new ae;return n._ib=e,n._vb=i,n.proName=a,n._startIdx=r*ce.BYTES_PIDX,n._numEle=0,n.blendType=t._nBlendType,n.shaderValue=s,n.shaderValue.setValue(t._shader2D),n},ae._cache=((ae._cache=[])._length=0,ae._cache);var se=ae;function ae(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}r(he,"laya.webgl.text.CharSegment"),_=he.prototype,g.imps(_,{"laya.webgl.text.ICharSegment":!0}),_.textToSpit=function(t){this._sourceStr=t},_.getChar=function(t){return this._sourceStr.charAt(t)},_.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},_.length=function(){return this._sourceStr.length};var ne=he;function he(){this._sourceStr=null}r(I,"laya.webgl.text.DrawText"),I.__init__=function(){I._charsTemp=new Array,I._drawValue=new le,I._charSeg=new ne},I.customCharSeg=function(t){I._charSeg=t},I.getChar=function(t,e,i){t=ui.createOneChar(t,i);return-1!=e&&(I._charsCache[e]=t),t},I._drawSlow=function(t,e,i,r,s,a,n,h,l,o,_,u,c,d,f){var m,p,g=I._drawValue.value(a,h,l,o,c,d,f),x=0,b=0,v=I._charsTemp,y=0,T=NaN;if(r)for(v.length=r.length,x=0,b=r.length;x<b;x++)T=(p=r[x]).charNum+g.txtID,v[x]=m=I._charsCache[T]||I.getChar(p.char,T,g),m.active();else{a=i instanceof laya.utils.WordText?i.toString():i;if(at.CharacterCache){I._charSeg.textToSpit(a);for(h=I._charSeg.length(),x=0,b=v.length=h;x<b;x++)T=I._charSeg.getCharCode(x)+g.txtID,v[x]=m=I._charsCache[T]||I.getChar(I._charSeg.getChar(x),T,g),m.active(),y+=m.cw}else v.length=0,(m=I.getChar(a,-1,g)).active(),y+=m.cw,v[0]=m}var A=0;null!==n&&"left"!==n&&(A=-("center"==n?y/2:y));var E,S,w=NaN,R=0;if(r)for(x=0,b=v.length;x<b;x++)(m=v[x]).isSpace||(p=r[x],w=m.borderSize,E=m.texture,e._drawText(E,_+A+p.x*c-w,u+p.y*d-w,E.width,E.height,s,0,0,0,0));else{for(x=0,b=v.length;x<b;x++)(m=v[x]).isSpace||(w=m.borderSize,E=m.texture,e._drawText(E,_+A-w,u-w,E.width,E.height,s,0,0,0,0),t&&((S=(S=t[R++])||(t[R-1]=[]))[0]=E,S[1]=A-w,S[2]=-w)),A+=m.cw;t&&(t.length=R)}},I._drawFast=function(t,e,i,r,s){for(var a,n,h=0,l=t.length;h<l;h++)(a=(n=t[h])[0]).active(),e._drawText(a,r+n[1],s+n[2],a.width,a.height,i,0,0,0,0)},I.drawText=function(t,e,i,r,s,a,n,h,l,o,_,u){var c,d,f,m;void 0===u&&(u=0),e&&0===e.length||i&&0===i.length||(c=r.a,d=r.d,!(!(1!==(c=0===r.b&&0===r.c?c:d=1)||1!==d)||!g.stage.transform)&&(f=g.stage.transform).a===c&&f.d===d?(f=(r=r.copyTo(Ae._tmpMatrix)).tx,m=r.ty,r.scale(1/c,1/d),r._checkTransform(),o=o*c+(f-r.tx),_=_*d+(m-r.ty)):c=d=1,i?I._drawSlow(null,t,e,i,r,s,a,n,h,l,o,_,c,d,u):null===e.toUpperCase?(f=c+1e5*d,(m=e).changed||m.id!==f?(m.id=f,m.changed=!1,I._drawSlow(m.save,t,e,i,r,s,a,n,h,l,o,_,c,d,u)):I._drawFast(m.save,t,r,o,_)):(f=e+s.toString()+n+h+l+c+d+a,m=I._textsCache[f],at.CharacterCache?m?I._drawFast(m,t,r,o,_):(I._textsCache.__length||(I._textsCache.__length=0),I._textsCache.__length>p.WebGLTextCacheCount&&((I._textsCache={}).__length=0,I._curPoolIndex=0),I._textCachesPool[I._curPoolIndex]?(m=I._textsCache[f]=I._textCachesPool[I._curPoolIndex]).length=0:I._textCachesPool[I._curPoolIndex]=m=I._textsCache[f]=[],I._textsCache.__length++,I._curPoolIndex++,I._drawSlow(m,t,e,i,r,s,a,n,h,l,o,_,c,d,u)):I._drawSlow(m,t,e,i,r,s,a,n,h,l,o,_,c,d,u)))},I._charsTemp=null,I._textCachesPool=[],I._curPoolIndex=0,I._charsCache={},I._textsCache={},I._drawValue=null,I.d=[],I._charSeg=null,I.__init$=function(){function h(){}r(h,""),h.prototype.value=function(t,e,i,r,s,a,n){this.font=t,this.fillColor=e,this.borderColor=i,this.lineWidth=r,this.scaleX=s,this.scaleY=a,this.underLine=n;t=t.toString()+s+a+r+e+i+n;return this.txtID=h._keymap[t],this.txtID||(this.txtID=1e-7*++h._keymapCount,h._keymap[t]=this.txtID),this},h.clear=function(){h._keymap={},h._keymapCount=1},h._keymap={},h._keymapCount=1,le=h};var le,oe=I;function I(){}r(ue,"laya.webgl.text.FontInContext"),(_=ue.prototype).setFont=function(t){var e=ue._cache2[t];if(e)this._words=e[0],this._size=e[1];else{this._words=t.split(" ");for(var i=0,r=this._words.length;i<r;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),ue._cache2[t]=[this._words,this._size]}this._text=null,this._italic=-2},_.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},_.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},_.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},_.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},_.toString=function(){return this._text||(this._text=this._words.join(" "))},t(0,_,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),ue.create=function(t){var e=ue._cache[t];return e=e||(ue._cache[t]=new ue(t))},ue.EMPTY=new ue,ue._cache={},ue._cache2=null;var _e=ue;function ue(t){this._index=0,this._size=14,this._italic=-2,ue._cache2=ue._cache2||[],this.setFont(t||"14px Arial")}r(de,"laya.webgl.utils.CONST3D2D"),de.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],de.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],de.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],de._TMPARRAY=[],de._OFFSETX=0,de._OFFSETY=0,N(de,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]);var ce=de;function de(){}r(fe,"laya.webgl.utils.GlUtils"),fe.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},fe.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),r=0,s=0;s<e;s++)i[r++]=4*s,i[r++]=4*s+2,i[r++]=4*s+1,i[r++]=4*s,i[r++]=4*s+3,i[r++]=4*s+2;return t.setNeedUpload(),!0},fe.expandIBQuadrangle=function(t,e){t.bufferLength>=6*e*2||fe.fillIBQuadrangle(t,e)},fe.mathCeilPowerOfTwo=function(t){return t--,t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16,++t},fe.fillQuadrangleImgVb=function(t,e,i,r,s,a,n,h){var l,o,_=16+(t._byteLength>>2),u=(t.byteLength=_<<2,t.getFloat32Array()),s=(u[2+(_-=16)]=s[0],u[3+_]=s[1],u[6+_]=s[2],u[7+_]=s[3],u[10+_]=s[4],u[11+_]=s[5],u[14+_]=s[6],u[15+_]=s[7],a.a),c=a.b,d=a.c,f=a.d;return 1!==s||0!==c||0!==d||1!==f?(a.bTransform=!0,l=a.tx+n,o=a.ty+h,u[_]=(r[0]+e)*s+(r[1]+i)*d+l,u[1+_]=(r[0]+e)*c+(r[1]+i)*f+o,u[4+_]=(r[2]+e)*s+(r[3]+i)*d+l,u[5+_]=(r[2]+e)*c+(r[3]+i)*f+o,u[8+_]=(r[4]+e)*s+(r[5]+i)*d+l,u[9+_]=(r[4]+e)*c+(r[5]+i)*f+o,u[12+_]=(r[6]+e)*s+(r[7]+i)*d+l,u[13+_]=(r[6]+e)*c+(r[7]+i)*f+o):(a.bTransform=!1,e+=a.tx+n,i+=a.ty+h,u[_]=e+r[0],u[1+_]=i+r[1],u[4+_]=e+r[2],u[5+_]=i+r[3],u[8+_]=e+r[4],u[9+_]=i+r[5],u[12+_]=e+r[6],u[13+_]=i+r[7]),t._upload=!0},fe.fillTranglesVB=function(t,e,i,r,s,a,n){for(var h,l,o=(t._byteLength>>2)+r.length,_=(t.byteLength=o<<2,t.getFloat32Array()),u=(o-=r.length,r.length),c=s.a,d=s.b,f=s.c,m=s.d,p=0;p<u;p+=4)_[o+p+2]=r[p+2],_[o+p+3]=r[p+3],1!==c||0!==d||0!==f||1!==m?(s.bTransform=!0,h=s.tx+a,l=s.ty+n,_[o+p]=(r[p]+e)*c+(r[p+1]+i)*f+h,_[o+p+1]=(r[p]+e)*d+(r[p+1]+i)*m+l):(s.bTransform=!1,e+=s.tx+a,i+=s.ty+n,_[o+p]=e+r[p],_[o+p+1]=i+r[p+1]);return t._upload=!0},fe.copyPreImgVb=function(t,e,i){for(var r=t._byteLength>>2,s=(t.byteLength=r+16<<2,t.getFloat32Array()),a=0,n=r-16;a<4;a++)s[r]=s[n]+e,s[++r]=s[++n]+i,s[++r]=s[++n],s[++r]=s[++n],++r,++n;t._upload=!0},fe.fillRectImgVb=function(t,e,i,r,s,a,n,h,l,N,o,O,_){void 0===_&&(_=!1);var u,c,d,f,V,U,k,H,m,p,g,x,b=1,v=h.a,y=h.b,T=h.c,A=h.d,G=e&&e.width<99999999;if(1!==v||0!==y||0!==T||1!==A?(h.bTransform=!0,0===y&&0===T&&(b=23,u=v*i+(w=h.tx+l),d=v*(z=s+i)+w,c=A*r+(R=h.ty+N),f=A*(W=a+r)+R)):(h.bTransform=!(b=23),d=(u=i+h.tx+l)+s,f=(c=r+h.ty+N)+a),G&&(V=e.x,U=e.y,k=e.width+V,H=e.height+U),1!==b){if(Math.min(u,d)>=k)return!1;if(Math.min(c,f)>=H)return!1;if(Math.max(d,u)<=V)return!1;if(Math.max(f,c)<=U)return!1}var E=t._byteLength>>2,S=(t.byteLength=16+E<<2,t.getFloat32Array());switch(S[2+E]=n[0],S[3+E]=n[1],S[6+E]=n[2],S[7+E]=n[3],S[10+E]=n[4],S[11+E]=n[5],S[14+E]=n[6],S[15+E]=n[7],b){case 1:var z,W,w=h.tx+l,R=h.ty+N,I=v*i,M=T*r,C=A*r,L=y*i,P=v*(z=s+i),D=T*(W=a+r),F=A*W,B=y*z;_?(m=I+M+w,g=Math.round(m)-m,p=C+L+R,x=Math.round(p)-p,S[E]=m+g,S[1+E]=p+x,S[4+E]=P+M+w+g,S[5+E]=C+B+R+x,S[8+E]=P+D+w+g,S[9+E]=F+B+R+x,S[12+E]=I+D+w+g,S[13+E]=F+L+R+x):(S[E]=I+M+w,S[1+E]=C+L+R,S[4+E]=P+M+w,S[5+E]=C+B+R,S[8+E]=P+D+w,S[9+E]=F+B+R,S[12+E]=I+D+w,S[13+E]=F+L+R);break;case 23:_?(m=u+o,g=Math.round(m)-m,p=c,x=Math.round(p)-p,S[E]=m+g,S[1+E]=p+x,S[4+E]=d+o+g,S[5+E]=c+x,S[8+E]=d+g,S[9+E]=f+x,S[12+E]=u+g,S[13+E]=f+x):(S[E]=u+o,S[1+E]=c,S[4+E]=d+o,S[5+E]=c,S[8+E]=d,S[9+E]=f,S[12+E]=u,S[13+E]=f)}return t._upload=!0},fe.fillLineVb=function(t,e,i,r,s,a,n,h){var n=.5*n,l=fe._fillLineArray,o=-(r-a),_=i-s,u=Math.sqrt(o*o+_*_),u=(_=_/u*n,l[0]=i-(o=o/u*n),l[1]=r-_,l[4]=i+o,l[5]=r+_,l[8]=s+o,l[9]=a+_,l[12]=s-o,l[13]=a-_,h&&h.transformPointArray(l,l),16+(t._byteLength>>2));return t.byteLength=u<<2,t.insertData(l,u-16),!0},fe._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var T=fe;function fe(){}r(me,"laya.webgl.utils.MatirxArray"),me.ArrayMul=function(t,e,i){if(t)if(e)for(var r,s,a,n,h=0;h<4;h++)r=t[h],s=t[h+4],a=t[h+8],n=t[h+12],i[h]=r*e[0]+s*e[1]+a*e[2]+n*e[3],i[h+4]=r*e[4]+s*e[5]+a*e[6]+n*e[7],i[h+8]=r*e[8]+s*e[9]+a*e[10]+n*e[11],i[h+12]=r*e[12]+s*e[13]+a*e[14]+n*e[15];else me.copyArray(t,i);else me.copyArray(e,i)},me.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]};function me(){}r(pe,"laya.webgl.utils.Mesh2D"),(_=pe.prototype).cloneWithNewVB=function(){var t=new pe(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},_.cloneWithNewVBIB=function(){var t=new pe(this._stride,0,0);return t._attribInfo=this._attribInfo,t},_.getVBW=function(){return this._vb.setNeedUpload(),this._vb},_.getVBR=function(){return this._vb},_.getIBR=function(){return this._ib},_.getIBW=function(){return this._ib.setNeedUpload(),this._ib},_.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,r=0,s=0;s<t;s++)e[i++]=r,e[i++]=r+2,e[i++]=r+1,e[i++]=r,e[i++]=r+3,e[i++]=r+2,r+=4;this._ib.setNeedUpload()},_.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},_.getEleNum=function(){return this._ib.getBuffer().byteLength/2},_.releaseMesh=function(){},_.destroy=function(){},_.clearVB=function(){this._vb.clear()},pe._gvaoid=0;var _=pe;function pe(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Li(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new Ii,i&&this._ib._resizeBuffer(i,!1)}r(f,"laya.webgl.utils.RenderState2D"),f.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},f.mat2MatArray=function(t,e){var i=e;return i[0]=t.a,i[1]=t.b,i[2]=f.EMPTYMAT4_ARRAY[2],i[3]=f.EMPTYMAT4_ARRAY[3],i[4]=t.c,i[5]=t.d,i[6]=f.EMPTYMAT4_ARRAY[6],i[7]=f.EMPTYMAT4_ARRAY[7],i[8]=f.EMPTYMAT4_ARRAY[8],i[9]=f.EMPTYMAT4_ARRAY[9],i[10]=f.EMPTYMAT4_ARRAY[10],i[11]=f.EMPTYMAT4_ARRAY[11],i[12]=t.tx,i[13]=t.ty,i[14]=f.EMPTYMAT4_ARRAY[14],i[15]=f.EMPTYMAT4_ARRAY[15],e},f.restoreTempArray=function(){f.TEMPMAT4_ARRAY[0]=1,f.TEMPMAT4_ARRAY[1]=0,f.TEMPMAT4_ARRAY[4]=0,f.TEMPMAT4_ARRAY[5]=1,f.TEMPMAT4_ARRAY[12]=0,f.TEMPMAT4_ARRAY[13]=0},f.clear=function(){f.worldScissorTest=!1,f.worldShaderDefines=null,f.worldFilters=null,f.worldAlpha=1,f.worldClipRect.x=f.worldClipRect.y=0,f.worldClipRect.width=f.width,f.worldClipRect.height=f.height,f.curRenderTarget=null},f._MAXSIZE=99999999,f.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f.worldMatrix4=f.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f.worldAlpha=1,f.worldScissorTest=!1,f.worldFilters=null,f.worldShaderDefines=null,f.curRenderTarget=null,f.width=0,f.height=0,N(f,["worldMatrix",function(){return this.worldMatrix=new v},"worldClipRect",function(){return this.worldClipRect=new q(0,0,99999999,99999999)}]);var u=f;function f(){}r(A,"laya.webgl.utils.ShaderCompile"),(B=A.prototype)._compileToTree=function(t,e,i,r,s){for(var a,n,h,l,o,_,u,c=0,d=0,c=i;c<e.length;c++)if(!((h=e[c]).length<1)&&0!==(o=h.indexOf("//"))){if(0<=o&&(h=h.substr(0,o)),a=_||new ge(r),_=null,a.text=h,a.noCompile=!0,0<=(o=h.indexOf("#"))){for(l="#",d=o+1,u=h.length;d<u;d++){var f=h.charAt(d);if(" "===f||"\t"===f||"?"===f)break;l+=f}switch(a.name=l){case"#ifdef":case"#ifndef":if(a.src=h,a.noCompile=null!=h.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+h.substr(o+a.name.length)+"}"):(m=h.replace(/^\s*/,"").split(/\s+/),a.setCondition(m[1],"#ifdef"===l?1:2),a.text="//"+a.text),a.setParent(t),t=a,s)for(m=h.substr(d).split(A._splitToWordExps3),d=0;d<m.length;d++)(h=m[d]).length&&(s[h]=!0);continue;case"#if":if(a.src=h,a.noCompile=!0,a.setParent(t),t=a,s)for(m=h.substr(d).split(A._splitToWordExps3),d=0;d<m.length;d++)(h=m[d]).length&&"defined"!=h&&(s[h]=!0);continue;case"#else":a.src=h,n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.condition=n.condition,a.conditionType=1==n.conditionType?2:1,a.text="//"+a.text+" "+n.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],a.noCompile=n.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":var m=A.splitToWords(h,null),p=A.includes[m[1]];if(!p)throw"ShaderCompile error no this include file:"+m[1];if((o=m[0].indexOf("?"))<0){a.setParent(t),h=p.getWith("with"==m[2]?m[3]:null),this._compileToTree(a,h.split("\n"),0,r,s),a.text="";continue}a.setCondition(m[0].substr(o+1),1),a.text=p.getWith("with"==m[2]?m[3]:null);break;case"#import":p=(m=A.splitToWords(h,null))[1],r.push({node:a,file:A.includes[p],ofs:a.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){0<r.length&&A.splitToWords(h,n),_=a,n.text+="\n"+h;continue}0<r.length&&A.splitToWords(h,a)}a.setParent(t)}},B.createShader=function(t,e,i){var r={},s="";if(t)for(var a in t)s+="#define "+a+"\n",r[a]=!0;var t=this._VS.toscript(r,[]),n=this._PS.toscript(r,[]);return(i||D.create)(s+t.join("\n"),s+n.join("\n"),e,this._nameMap)},A._parseOne=function(t,e,i,r,s,a){var n={type:A.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};return a&&("attribute"==s?t:e).push(n),":"==i[r+3]&&(n.type=i[r+4],r+=2),r+=2},A.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(A.includes[t])throw new Error("add shader include file err, has add:"+t);A.includes[t]=new xe(e)},A.preGetParams=function(t,e){for(var i=[t,e],t={},r=[],s=[],a={},n=[],h=(t.attributes=r,t.uniforms=s,t.defines=a,0),l=0;l<2;l++){i[l]=i[l].replace(A._removeAnnotation,"");for(var o=i[l].match(A._reg),h=0,_=o.length;h<_;h++){var u=o[h];if("attribute"!=u&&"uniform"!=u){if("#define"==u)n[u=o[++h]]=1;else if("#ifdef"==u){var c;a[c=o[++h]]=a[c]||[];for(h++;h<_;h++)if("attribute"!=(u=o[h])&&"uniform"!=u){if("#else"==u)for(h++;h<_;h++)if("attribute"!=(u=o[h])&&"uniform"!=u){if("#endif"==u)break}else h=A._parseOne(r,s,o,h,u,!n[c])}else h=A._parseOne(r,s,o,h,u,n[c])}}else h=A._parseOne(r,s,o,h,u,!0)}}return t},A.splitToWords=function(t,e){for(var i,r,s=[],a=-1,n=0,h=t.length;n<h;n++)if(i=t.charAt(n),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=a&&1<n-a&&(r=t.substr(a,n-a),s.push(r)),'"'==i||"'"==i){var l=t.indexOf(i,n+1);if(l<0)throw"Sharder err:"+t;s.push(t.substr(n+1,l-n-1)),n=l}else"("==i&&e&&0<s.length&&"vec4;main;".indexOf(r=s[s.length-1]+";")<0&&(e.useFuns+=r);a=-1}else a<0&&(a=n);return a<h&&1<h-a&&(r=t.substr(a,h-a),s.push(r)),s},A.IFDEF_NO=0,A.IFDEF_YES=1,A.IFDEF_ELSE=2,A.IFDEF_PARENT=3,A._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),A._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),A._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),A.includes={},N(A,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),A.__init$=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}var t;function e(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0;!((e=t.indexOf("#begin",e))<0);){for(i=e+5;;){if((i=t.indexOf("#end",i))<0)break;if("i"!==t.charAt(i+4))break;i+=5}if(i<0)throw"add include err,no #end:"+t;var r=t.indexOf("\n",e),s=A.splitToWords(t.substr(e,r-e),null);"code"==s[1]?this.codes[s[2]]=t.substr(r+1,i-r-1):"function"==s[1]&&(r=t.indexOf("function",e),r+="function".length,this.funs[s[3]]=t.substr(r+1,i-r-1),this.funnames+=s[3]+";"),e=i+1}}r(i,""),(t=i.prototype).setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(r,s,a){if(!(this.childs.length<1)||this.text){s.length;if(this.condition){var t=!!this.condition.call(r);if(!(t=2===this.conditionType?!t:t))return s}if(this.text&&s.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(r,s,a)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,n=this.includefiles.length;i<n;i++)this.includefiles[i].curUseID!=a&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=a,s[0]=e+s[0])}return s},i.__id=1,ge=i,r(e,""),(t=e.prototype).getWith=function(t){var e=t?this.codes[t]:this.script;if(e)return e;throw"get with error:"+t},t.getFunsScript=function(t){var e,i="";for(e in this.funs)0<=t.indexOf(e+";")&&(i+=this.funs[e]);return i},xe=e};var ge,xe,be=A;function A(t,e,i,r,s){var a=this;function n(t){var e=[],i=new ge(e);return a._compileToTree(i,t.split("\n"),0,e,s),i}var h=H.now();this._VS=n(e),this._PS=n(i),this._nameMap=r,2<H.now()-h&&console.log("ShaderCompile use time:"+(H.now()-h)+"  size:"+e.length+"/"+i.length)}r(S,"laya.webgl.WebGL"),S._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},S._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},S._uint16ArraySlice=function(t){var e,i=arguments,r=0,s=0;if(0===i.length)for(r=this.length,e=new Uint16Array(r),s=0;s<r;s++)e[s]=this[s];else if(2===i.length){var a=i[0],n=i[1];if(a<n)for(r=n-a,e=new Uint16Array(r),s=a;s<n;s++)e[s-a]=this[s];else e=new Uint16Array(0)}return e},S.expandContext=function(){var t=W.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,xi.__int__(null),e.setIBVB=function(t,e,i,r,s,a,n,h,l,o){void 0===l&&(l=0),void 0===o&&(o=0),null===i&&(this._ib=this._ib||Ii.QuadrangleIB,i=this._ib,T.expandIBQuadrangle(i,r._byteLength/64+8)),this._setIBVB(t,e,i,r,s,a,n,h,l,o)},e.fillTrangles=function(t,e,i,r,s){this._curMat=this._curMat||v.create(),this._vb=this._vb||Li.create(),this._ib||(this._ib=Ii.create(),T.fillIBQuadrangle(this._ib,n/4));var a=this._vb,n=r.length>>4,r=(T.fillTranglesVB(a,e,i,r,s||this._curMat,0,0),T.expandIBQuadrangle(this._ib,a._byteLength/64+8),new C(1,0)),t=(r.textureHost=t,new wi("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}"));a._vertType=3,this._setIBVB(e,i,this._ib,a,6*n,s,t,r,0,0)}},S.enable=function(){var t;return H.__init__(),c.isConchApp&&!c.isConchWebGL?(s.skinAniSprite=function(){return new Ut},S.expandContext(),!1):(s.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:p.isStencil,alpha:p.isAlpha,antialias:p.isAntialias,premultipliedAlpha:p.premultipliedAlpha,preserveDrawingBuffer:p.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null!=(S.mainContext=s.getWebGLContext(c._mainCanvas))&&(c.isWebGL||(K.create=function(t,e){return new Di(t,e)},Q.create=function(t,e,i,r,s,a,n){return new mi(t,e,i,r,s,a,n)},c.WebGL=S,c.isWebGL=!0,oe.__init__(),s.createRenderSprite=function(t,e){return new Ee(t,e)},s.createWebGLContext2D=function(t){return new Ae(t)},s.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},s.createGraphics=function(){return new ve},t=s.createFilterAction,s.createFilterAction=t||function(t){return new we},s.clear=function(t){u.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=c.context.ctx,t=t&&(0==e._submits._length||p.preserveDrawingBuffer)?z.create(t)._color:et._wgColor;t?e.clearBG(t[0],t[1],t[2],t[3]):e.clearBG(0,0,0,0),u.clear()},s.addToAtlas=function(t,e){void 0===e&&(e=!1);e=t.bitmap;c.optimizeTextureMemory(t.url,t)?g.__typeof(e,"laya.webgl.resource.IMergeAtlasBitmap")&&e.allowMerageInAtlas&&e.on("recovered",t,t.addTextureToAtlas):e.enableMerageInAtlas=!1},s.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},x._enable(),s.beginFlush=function(){for(var t=x.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var r=t.getAtlaserByIndex(i).texture;r._flashCacheImageNeedFlush&&s.flashFlushImage(r)}},s.drawToCanvas=function(t,e,i,r,s,a){(i<=0||r<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),s|=0,a|=0;var n=Ke.create(i|=0,r|=0,6408,5121,0,!1),e=(n.start(),n.clear(0,0,0,0),c.context.clear(),j.renders[e]._fun(t,c.context,s,u.height-r+a),c.context.flush(),n.end(),n.getData(0,0,i,r));if(n.recycle(),e.byteLength==i*r*4)return(t=new oi)._canvas=H.createElement("canvas"),t.size(i,r),s=t._canvas.getContext("2d"),H.canvas.size(i,r),(n=(a=H.context).createImageData(i,r)).data.set(new Uint8ClampedArray(e.buffer)),t._imgData=n,a.putImageData(n,0,0),s.save(),s.translate(0,r),s.scale(1,-1),s.drawImage(H.canvas.source,0,0),s.restore(),t;console.log("drawToCanvas error: w:"+i+",h:"+r+",datalen:"+e.byteLength)},s.createFilterAction=function(t){var e;return e=32===t?new we:e},s.addTextureToAtlas=function(t){t._uvID++,x._atlasRestore++,t.bitmap.enableMerageInAtlas&&x.instance.addToAtlas(t)},s.getTexturePixels=function(t,e,i,r,s){c.context.ctx.clear();for(var a,n=new tt,t=(n.graphics.drawTexture(t,-e,-i),Ke.create(r,s)),h=(t.start(),t.clear(0,0,0,0),n.render(c.context,0,0),c.context.ctx.flush(),t.end(),t.getData(0,0,r,s)),l=[],o=s-1;0<=o;o--)for(var _=0;_<r;_++)l.push(h[a=4*(o*r+_)]),l.push(h[1+a]),l.push(h[2+a]),l.push(h[3+a]);return l},s.skinAniSprite=function(){return new Ut},X.create=function(t,e){var i=new oi;return i._imgData=e,i.flipY=!1,i},Y._filterStart=function(t,e,i,r,s){var a=t.getValue("bounds"),a=Ke.create(a.width,a.height);a.start(),a.clear(0,0,0,0),t.addValue("src",a),t.addValue("ScissorTest",u.worldScissorTest),u.worldScissorTest&&((a=new q).copyFrom(i.ctx._clipRect),t.addValue("clipRect",a),u.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089))},Y._filterEnd=function(t,e,i,r,s){var a=t.getValue("bounds"),a=(t.getValue("src").end(),Ke.create(a.width,a.height));a.start(),a.clear(0,0,0,0),t.addValue("out",a),e._set$P("_filterCache",a),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},Y._EndTarget=function(t,e){t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")&&(u.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save(),t=t.getValue("clipRect"),e.ctx.clipRect(t.x,t.y,t.width,t.height))},Y._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},Y._endSrc=function(t){t.getValue("src").end()},Y._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},Y._endOut=function(t){t.getValue("out").end()},Y._recycleScope=function(t){t.recycle()},Y._filter=function(t,e,i,r){var s=this._next;if(s){var a=t.filters,n=a.length;if(1==n&&32==a[0].type)e.ctx.save(),e.ctx.setFilters([a[0]]),s._fun.call(s,t,e,i,r),e.ctx.restore();else{var h,l,o=jt.create(),_=Z.TEMP,u=e.ctx._getTransformMatrix(),c=v.create(),u=(u.copyTo(c),0),d=0,f=!1,m=t._$P._filterCache||null;if(!m||t._repaint){f=t._isHaveGlowFilter(),o.addValue("_isHaveGlowFilter",f),f&&(u=50,d=25),(l=new q).copyFrom(t.getSelfBounds()),l.x+=t.x,l.y+=t.y,l.x-=t.pivotX+4,l.y-=t.pivotY+4;var p=l.x,g=l.y;if(l.width+=u+8,l.height+=u+8,_.x=l.x*c.a+l.y*c.c,_.y=l.y*c.d+l.x*c.b,l.x=_.x,l.y=_.y,_.x=l.width*c.a+l.height*c.c,_.y=l.height*c.d+l.width*c.b,l.width=_.x,l.height=_.y,l.width<=0||l.height<=0)return;m&&m.recycle(),o.addValue("bounds",l);var x=Zt.create([o,t,e,0,0],Y._filterStart),p=(e.addRenderObject(x),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null,t.x-p+d),g=t.y-g+d;s._fun.call(s,t,e,p,g),x=Zt.create([o,t,e,0,0],Y._filterEnd),e.addRenderObject(x);for(var b=0;b<n;b++)0!=b&&(x=Zt.create([o],Y._useSrc),e.addRenderObject(x),h=C.create(1,0),v.TEMP.identity(),e.ctx.drawTarget(o,0,0,l.width,l.height,v.TEMP,"out",h,null,y.TOINT.overlay),x=Zt.create([o],Y._useOut),e.addRenderObject(x)),a[b].action.apply3d(o,t,e,0,0);x=Zt.create([o,e],Y._EndTarget),e.addRenderObject(x)}else{if((f=t._$P._isHaveGlowFilter||!1)&&(u=50,d=25),(l=t.getBounds()).width<=0||l.height<=0)return;l.width+=u,l.height+=u,_.x=l.x*c.a+l.y*c.c,_.y=l.y*c.d+l.x*c.b,l.x=_.x,l.y=_.y,_.x=l.width*c.a+l.height*c.c,_.y=l.height*c.d+l.width*c.b,l.width=_.x,l.height=_.y,o.addValue("out",m)}i=i-d-t.x,r=r-d-t.y,_.setTo(i,r),c.transformPoint(_),i=_.x+l.x,r=_.y+l.y,h=C.create(1,0),v.TEMP.identity(),e.ctx.drawTarget(o,i,r,l.width,l.height,v.TEMP,"out",h,null,y.TOINT.overlay),x=Zt.create([o],Y._recycleScope),e.addRenderObject(x),c.destroy()}}},Float32Array.prototype.slice||(Float32Array.prototype.slice=S._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=S._uint16ArraySlice),Uint8Array.prototype.slice)||(Uint8Array.prototype.slice=S._uint8ArraySlice),!0))},S.onStageResize=function(t,e){null!=S.mainContext&&(S.mainContext.viewport(0,0,t,e),u.width=t,u.height=e)},S.onInvalidGLRes=function(){x.instance.freeAll(),J.releaseContentManagers(!0),S.doNodeRepaint(g.stage),S.mainContext.viewport(0,0,u.width,u.height),g.stage.event("devicelost")},S.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var e=0;e<t.numChildren;e++)S.doNodeRepaint(t.getChildAt(e))},S.init=function(t,e,i){S.mainCanvas=t,X._createContext=function(t){return new Ae(t)},oi._createContext=function(t){return new Ae(t)};var r,s=laya.webgl.WebGL.mainContext;if(null!=s.getShaderPrecisionFormat?(t=s.getShaderPrecisionFormat(35633,36338),r=s.getShaderPrecisionFormat(35632,36338),S.shaderHighPrecision=!(!t.precision||!r.precision)):S.shaderHighPrecision=!1,S.compressAstc=s.getExtension("WEBGL_compressed_texture_astc"),S.compressAtc=s.getExtension("WEBGL_compressed_texture_atc"),S.compressEtc=s.getExtension("WEBGL_compressed_texture_etc"),S.compressEtc1=s.getExtension("WEBGL_compressed_texture_etc1"),S.compressPvrtc=s.getExtension("WEBGL_compressed_texture_pvrtc"),S.compressS3tc=s.getExtension("WEBGL_compressed_texture_s3tc"),S.compressS3tc_srgb=s.getExtension("WEBGL_compressed_texture_s3tc_srgb"),s.deleteTexture1=s.deleteTexture,s.deleteTexture=function(t){t==w.curBindTexValue&&(w.curBindTexValue=null),s.deleteTexture1(t)},S.onStageResize(e,i),null==S.mainContext)throw new Error("webGL getContext err!");st.__init__(),x.__init__(),Ce.__init__(),d.__init__(),Ae.__init__(),C.__init__(),Bt.__init__(),xi.__int__(s),y._init_(s),c.isConchApp&&conch.setOnInvalidGLRes(S.onInvalidGLRes)},S.compressAstc=null,S.compressAtc=null,S.compressEtc=null,S.compressEtc1=null,S.compressPvrtc=null,S.compressS3tc=null,S.compressS3tc_srgb=null,S.mainCanvas=null,S.mainContext=null,S.antialias=!0,S.shaderHighPrecision=!1,S._bg_null=[0,0,0,0];var E=S;function S(){}r(R,"laya.webgl.WebGLContext"),R.UseProgram=function(t){return R._useProgram!==t&&(E.mainContext.useProgram(t),R._useProgram=t,!0)},R.setDepthTest=function(t,e){e!==R._depthTest&&((R._depthTest=e)?t.enable(2929):t.disable(2929))},R.setDepthMask=function(t,e){e!==R._depthMask&&(R._depthMask=e,t.depthMask(e))},R.setDepthFunc=function(t,e){e!==R._depthFunc&&(R._depthFunc=e,t.depthFunc(e))},R.setBlend=function(t,e){e!==R._blend&&((R._blend=e)?t.enable(3042):t.disable(3042))},R.setBlendFunc=function(t,e,i){e===R._sFactor&&i===R._dFactor||(R._sFactor=e,R._dFactor=i,t.blendFunc(e,i))},R.setCullFace=function(t,e){e!==R._cullFace&&((R._cullFace=e)?t.enable(2884):t.disable(2884))},R.setFrontFace=function(t,e){e!==R._frontFace&&(R._frontFace=e,t.frontFace(e))},R.bindTexture=function(t,e,i){t.bindTexture(e,i),R.curBindTexTarget=e,R.curBindTexValue=i},R.DEPTH_BUFFER_BIT=256,R.STENCIL_BUFFER_BIT=1024,R.COLOR_BUFFER_BIT=16384,R.POINTS=0,R.LINES=1,R.LINE_LOOP=2,R.LINE_STRIP=3,R.TRIANGLES=4,R.TRIANGLE_STRIP=5,R.TRIANGLE_FAN=6,R.ZERO=0,R.ONE=1,R.SRC_COLOR=768,R.ONE_MINUS_SRC_COLOR=769,R.SRC_ALPHA=770,R.ONE_MINUS_SRC_ALPHA=771,R.DST_ALPHA=772,R.ONE_MINUS_DST_ALPHA=773,R.DST_COLOR=774,R.ONE_MINUS_DST_COLOR=775,R.SRC_ALPHA_SATURATE=776,R.FUNC_ADD=32774,R.BLEND_EQUATION=32777,R.BLEND_EQUATION_RGB=32777,R.BLEND_EQUATION_ALPHA=34877,R.FUNC_SUBTRACT=32778,R.FUNC_REVERSE_SUBTRACT=32779,R.BLEND_DST_RGB=32968,R.BLEND_SRC_RGB=32969,R.BLEND_DST_ALPHA=32970,R.BLEND_SRC_ALPHA=32971,R.CONSTANT_COLOR=32769,R.ONE_MINUS_CONSTANT_COLOR=32770,R.CONSTANT_ALPHA=32771,R.ONE_MINUS_CONSTANT_ALPHA=32772,R.BLEND_COLOR=32773,R.ARRAY_BUFFER=34962,R.ELEMENT_ARRAY_BUFFER=34963,R.ARRAY_BUFFER_BINDING=34964,R.ELEMENT_ARRAY_BUFFER_BINDING=34965,R.STREAM_DRAW=35040,R.STATIC_DRAW=35044,R.DYNAMIC_DRAW=35048,R.BUFFER_SIZE=34660,R.BUFFER_USAGE=34661,R.CURRENT_VERTEX_ATTRIB=34342,R.FRONT=1028,R.BACK=1029,R.CULL_FACE=2884,R.FRONT_AND_BACK=1032,R.BLEND=3042,R.DITHER=3024,R.STENCIL_TEST=2960,R.DEPTH_TEST=2929,R.SCISSOR_TEST=3089,R.POLYGON_OFFSET_FILL=32823,R.SAMPLE_ALPHA_TO_COVERAGE=32926,R.SAMPLE_COVERAGE=32928,R.NO_ERROR=0,R.INVALID_ENUM=1280,R.INVALID_VALUE=1281,R.INVALID_OPERATION=1282,R.OUT_OF_MEMORY=1285,R.CW=2304,R.CCW=2305,R.LINE_WIDTH=2849,R.ALIASED_POINT_SIZE_RANGE=33901,R.ALIASED_LINE_WIDTH_RANGE=33902,R.CULL_FACE_MODE=2885,R.FRONT_FACE=2886,R.DEPTH_RANGE=2928,R.DEPTH_WRITEMASK=2930,R.DEPTH_CLEAR_VALUE=2931,R.DEPTH_FUNC=2932,R.STENCIL_CLEAR_VALUE=2961,R.STENCIL_FUNC=2962,R.STENCIL_FAIL=2964,R.STENCIL_PASS_DEPTH_FAIL=2965,R.STENCIL_PASS_DEPTH_PASS=2966,R.STENCIL_REF=2967,R.STENCIL_VALUE_MASK=2963,R.STENCIL_WRITEMASK=2968,R.STENCIL_BACK_FUNC=34816,R.STENCIL_BACK_FAIL=34817,R.STENCIL_BACK_PASS_DEPTH_FAIL=34818,R.STENCIL_BACK_PASS_DEPTH_PASS=34819,R.STENCIL_BACK_REF=36003,R.STENCIL_BACK_VALUE_MASK=36004,R.STENCIL_BACK_WRITEMASK=36005,R.VIEWPORT=2978,R.SCISSOR_BOX=3088,R.COLOR_CLEAR_VALUE=3106,R.COLOR_WRITEMASK=3107,R.UNPACK_ALIGNMENT=3317,R.PACK_ALIGNMENT=3333,R.MAX_TEXTURE_SIZE=3379,R.MAX_VIEWPORT_DIMS=3386,R.SUBPIXEL_BITS=3408,R.RED_BITS=3410,R.GREEN_BITS=3411,R.BLUE_BITS=3412,R.ALPHA_BITS=3413,R.DEPTH_BITS=3414,R.STENCIL_BITS=3415,R.POLYGON_OFFSET_UNITS=10752,R.POLYGON_OFFSET_FACTOR=32824,R.TEXTURE_BINDING_2D=32873,R.SAMPLE_BUFFERS=32936,R.SAMPLES=32937,R.SAMPLE_COVERAGE_VALUE=32938,R.SAMPLE_COVERAGE_INVERT=32939,R.NUM_COMPRESSED_TEXTURE_FORMATS=34466,R.COMPRESSED_TEXTURE_FORMATS=34467,R.DONT_CARE=4352,R.FASTEST=4353,R.NICEST=4354,R.GENERATE_MIPMAP_HINT=33170,R.BYTE=5120,R.UNSIGNED_BYTE=5121,R.SHORT=5122,R.UNSIGNED_SHORT=5123,R.INT=5124,R.UNSIGNED_INT=5125,R.FLOAT=5126,R.DEPTH_COMPONENT=6402,R.ALPHA=6406,R.RGB=6407,R.RGBA=6408,R.LUMINANCE=6409,R.LUMINANCE_ALPHA=6410,R.UNSIGNED_SHORT_4_4_4_4=32819,R.UNSIGNED_SHORT_5_5_5_1=32820,R.UNSIGNED_SHORT_5_6_5=33635,R.FRAGMENT_SHADER=35632,R.VERTEX_SHADER=35633,R.MAX_VERTEX_ATTRIBS=34921,R.MAX_VERTEX_UNIFORM_VECTORS=36347,R.MAX_VARYING_VECTORS=36348,R.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,R.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,R.MAX_TEXTURE_IMAGE_UNITS=34930,R.MAX_FRAGMENT_UNIFORM_VECTORS=36349,R.SHADER_TYPE=35663,R.DELETE_STATUS=35712,R.LINK_STATUS=35714,R.VALIDATE_STATUS=35715,R.ATTACHED_SHADERS=35717,R.ACTIVE_UNIFORMS=35718,R.ACTIVE_ATTRIBUTES=35721,R.SHADING_LANGUAGE_VERSION=35724,R.CURRENT_PROGRAM=35725,R.NEVER=512,R.LESS=513,R.EQUAL=514,R.LEQUAL=515,R.GREATER=516,R.NOTEQUAL=517,R.GEQUAL=518,R.ALWAYS=519,R.KEEP=7680,R.REPLACE=7681,R.INCR=7682,R.DECR=7683,R.INVERT=5386,R.INCR_WRAP=34055,R.DECR_WRAP=34056,R.VENDOR=7936,R.RENDERER=7937,R.VERSION=7938,R.NEAREST=9728,R.LINEAR=9729,R.NEAREST_MIPMAP_NEAREST=9984,R.LINEAR_MIPMAP_NEAREST=9985,R.NEAREST_MIPMAP_LINEAR=9986,R.LINEAR_MIPMAP_LINEAR=9987,R.TEXTURE_MAG_FILTER=10240,R.TEXTURE_MIN_FILTER=10241,R.TEXTURE_WRAP_S=10242,R.TEXTURE_WRAP_T=10243,R.TEXTURE_2D=3553,R.TEXTURE=5890,R.TEXTURE_CUBE_MAP=34067,R.TEXTURE_BINDING_CUBE_MAP=34068,R.TEXTURE_CUBE_MAP_POSITIVE_X=34069,R.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,R.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,R.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,R.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,R.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,R.MAX_CUBE_MAP_TEXTURE_SIZE=34076,R.TEXTURE0=33984,R.TEXTURE1=33985,R.TEXTURE2=33986,R.TEXTURE3=33987,R.TEXTURE4=33988,R.TEXTURE5=33989,R.TEXTURE6=33990,R.TEXTURE7=33991,R.TEXTURE8=33992,R.TEXTURE9=33993,R.TEXTURE10=33994,R.TEXTURE11=33995,R.TEXTURE12=33996,R.TEXTURE13=33997,R.TEXTURE14=33998,R.TEXTURE15=33999,R.TEXTURE16=34e3,R.TEXTURE17=34001,R.TEXTURE18=34002,R.TEXTURE19=34003,R.TEXTURE20=34004,R.TEXTURE21=34005,R.TEXTURE22=34006,R.TEXTURE23=34007,R.TEXTURE24=34008,R.TEXTURE25=34009,R.TEXTURE26=34010,R.TEXTURE27=34011,R.TEXTURE28=34012,R.TEXTURE29=34013,R.TEXTURE30=34014,R.TEXTURE31=34015,R.ACTIVE_TEXTURE=34016,R.REPEAT=10497,R.CLAMP_TO_EDGE=33071,R.MIRRORED_REPEAT=33648,R.FLOAT_VEC2=35664,R.FLOAT_VEC3=35665,R.FLOAT_VEC4=35666,R.INT_VEC2=35667,R.INT_VEC3=35668,R.INT_VEC4=35669,R.BOOL=35670,R.BOOL_VEC2=35671,R.BOOL_VEC3=35672,R.BOOL_VEC4=35673,R.FLOAT_MAT2=35674,R.FLOAT_MAT3=35675,R.FLOAT_MAT4=35676,R.SAMPLER_2D=35678,R.SAMPLER_CUBE=35680,R.VERTEX_ATTRIB_ARRAY_ENABLED=34338,R.VERTEX_ATTRIB_ARRAY_SIZE=34339,R.VERTEX_ATTRIB_ARRAY_STRIDE=34340,R.VERTEX_ATTRIB_ARRAY_TYPE=34341,R.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,R.VERTEX_ATTRIB_ARRAY_POINTER=34373,R.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,R.COMPILE_STATUS=35713,R.LOW_FLOAT=36336,R.MEDIUM_FLOAT=36337,R.HIGH_FLOAT=36338,R.LOW_INT=36339,R.MEDIUM_INT=36340,R.HIGH_INT=36341,R.FRAMEBUFFER=36160,R.RENDERBUFFER=36161,R.RGBA4=32854,R.RGB5_A1=32855,R.RGB565=36194,R.DEPTH_COMPONENT16=33189,R.STENCIL_INDEX=6401,R.STENCIL_INDEX8=36168,R.DEPTH_STENCIL=34041,R.RENDERBUFFER_WIDTH=36162,R.RENDERBUFFER_HEIGHT=36163,R.RENDERBUFFER_INTERNAL_FORMAT=36164,R.RENDERBUFFER_RED_SIZE=36176,R.RENDERBUFFER_GREEN_SIZE=36177,R.RENDERBUFFER_BLUE_SIZE=36178,R.RENDERBUFFER_ALPHA_SIZE=36179,R.RENDERBUFFER_DEPTH_SIZE=36180,R.RENDERBUFFER_STENCIL_SIZE=36181,R.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,R.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,R.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,R.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,R.COLOR_ATTACHMENT0=36064,R.DEPTH_ATTACHMENT=36096,R.STENCIL_ATTACHMENT=36128,R.DEPTH_STENCIL_ATTACHMENT=33306,R.NONE=0,R.FRAMEBUFFER_COMPLETE=36053,R.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,R.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,R.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,R.FRAMEBUFFER_UNSUPPORTED=36061,R.FRAMEBUFFER_BINDING=36006,R.RENDERBUFFER_BINDING=36007,R.MAX_RENDERBUFFER_SIZE=34024,R.INVALID_FRAMEBUFFER_OPERATION=1286,R.UNPACK_FLIP_Y_WEBGL=37440,R.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,R.CONTEXT_LOST_WEBGL=37442,R.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,R.BROWSER_DEFAULT_WEBGL=37444,R._useProgram=null,R._depthTest=!0,R._depthMask=!0,R._blend=!1,R._cullFace=!1,R.curBindTexTarget=null,R.curBindTexValue=null,N(R,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]);var w=R;function R(){}r(ye,"laya.webgl.display.GraphicsGL",e),(B=ye.prototype).setShader=function(t){this._saveToCmd(c.context._setShader,[t])},B.setIBVB=function(t,e,i,r,s,a){this._saveToCmd(c.context._setIBVB,[t,e,i,r,s,a])},B.drawParticle=function(t,e,i){i=s.createParticleTemplate2D(i);i.x=t,i.y=e,this._saveToCmd(c.context._drawParticle,[i])};var ve=ye;function ye(){ye.__super.call(this)}r(M,"laya.webgl.canvas.WebGLContext2D",W),(e=M.prototype).setIsMainContext=function(){this._isMain=!0},e.clearBG=function(t,e,i,r){var s=E.mainContext;s.clearColor(t,e,i,r),s.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},e.destroy=function(){--M._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=Ii.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._submits||(this._other=Te.DEFAULT,this._curMat=v.create(),this._vb=Li.create(-1),this._submits=[],this._save=[Rt.Create(this)],this._save.length=10,this._shader2D=new Bt,this._triangleMesh=Ge.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=Te.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=M.MAXCLIPRECT,this._curSubmit=d.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=gt.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,r=this._submits._length;i<r;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0===t&&0===e&&this._releaseMem()},e._getTransformMatrix=function(){return this._curMat},e.translate=function(t,e){0===t&&0===e||(Lt.save(this),this._curMat.bTransform&&(Mt.save(this),this._curMat.transformPointN(Z.TEMP.setTo(t,e)),t=Z.TEMP.x,e=Z.TEMP.y),this._x+=t,this._y+=e)},e.save=function(){this._save[this._save._length++]=Rt.Create(this)},e.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},e._fillText=function(t,e,i,r,s,a,n,h,l,o){void 0===o&&(o=0);var _,u=this._shader2D,c=this._curSubmit.shaderValue,s=s?_e.create(s):this._other.font;x.enabled?u.ALPHA!==c.ALPHA&&(u.glTexture=null):(this._shader2D.defines.getValue(),_=a?z.create(a)._color:u.colorAdd,u.ALPHA===c.ALPHA&&_===u.colorAdd&&c.colorAdd===u.colorAdd||(u.glTexture=null,u.colorAdd=_)),oe.drawText(this,t,e,this._curMat,s,l||this._other.textAlign,a,n,h,i,r,o)},e.fillWords=function(t,e,i,r,s,a){this._fillText(null,t,e,i,r,s,null,-1,null,a)},e.fillBorderWords=function(t,e,i,r,s,a,n){this._fillBorderText(null,t,e,i,r,s,a,n,null)},e.fillText=function(t,e,i,r,s,a){this._fillText(t,null,e,i,r,s,null,-1,a)},e.strokeText=function(t,e,i,r,s,a,n){this._fillText(t,null,e,i,r,null,s,a||1,n)},e.fillBorderText=function(t,e,i,r,s,a,n,h){this._fillBorderText(t,null,e,i,r,s,a,n,h)},e._fillBorderText=function(t,e,i,r,s,a,n,h,l){var o,_;x.enabled?(o=this._shader2D,_=this._curSubmit.shaderValue,o.ALPHA!==_.ALPHA&&(o.glTexture=null),_=s?(M._fontTemp.setFont(s),M._fontTemp):this._other.font,oe.drawText(this,t,e,this._curMat,_,l||this._other.textAlign,a,n,h||1,i,r,0)):(this._fillText(t,e,i,r,s,null,n,h||1,l),this._fillText(t,e,i,r,s,a,null,-1,l))},e.fillRect=function(t,e,i,r,s){var a=this._vb;T.fillRectImgVb(a,this._clipRect,t,e,i,r,nt.DEF_UV,this._curMat,this._x,this._y,0,0)&&(this._renderKey=0,t=this._shader2D.fillStyle,s&&(this._shader2D.fillStyle=gt.create(s)),e=this._shader2D,i=this._curSubmit.shaderValue,e.fillStyle===i.fillStyle&&e.ALPHA===i.ALPHA||(e.glTexture=null,(r=this._curSubmit=d.createSubmit(this,this._ib,a,(a._byteLength-64)/32*3,C.create(2,0))).shaderValue.color=e.fillStyle._color._color,r.shaderValue.ALPHA=e.ALPHA,this._submits[this._submits._length++]=r),this._curSubmit._numEle+=6,this._shader2D.fillStyle=t)},e.fillTexture=function(t,e,i,r,s,a,n,h){if(t.loaded&&t.bitmap&&t.source){var l,o,_,u=this._vb,c=t.bitmap.width,d=t.bitmap.height,f=t.uv,m=n.x%t.width,p=n.y%t.height;if(c!=h.w||d!=h.h){if(!h.w&&!h.h)switch(h.oy=h.ox=0,a){case"repeat":h.width=r,h.height=s;break;case"repeat-x":h.width=r,p<0?t.height+p>s?h.height=s:h.height=t.height+p:(h.oy=p,t.height+p>s?h.height=s-p:h.height=t.height);break;case"repeat-y":m<0?t.width+m>r?h.width=r:h.width=t.width+m:(h.ox=m,t.width+m>r?h.width=r-m:h.width=t.width),h.height=s;break;case"no-repeat":m<0?t.width+m>r?h.width=r:h.width=t.width+m:(h.ox=m,t.width+m>r?h.width=r-m:h.width=t.width),p<0?t.height+p>s?h.height=s:h.height=t.height+p:(h.oy=p,t.height+p>s?h.height=s-p:h.height=t.height);break;default:h.width=r,h.height=s}h.w=c,h.h=d,h.uv=[0,0,h.width/c,0,h.width/c,h.height/d,0,h.height/d]}e+=h.ox,i+=h.oy,m-=h.ox,p-=h.oy,T.fillRectImgVb(u,this._clipRect,e,i,h.width,h.height,h.uv,this._curMat,this._x,this._y,0,0)&&(this._renderKey=0,n=ke.create(this,this._ib,u,(u._byteLength-64)/32*3,C.create(256,0)),(a=(this._submits[this._submits._length++]=n).shaderValue).textureHost=t,e=f[0]*c,i=f[1]*d,l=(f[2]-f[0])*c,f=(f[5]-f[3])*d,o=-m/c,_=-p/d,a.u_TexRange[0]=e/c,a.u_TexRange[1]=l/c,a.u_TexRange[2]=i/d,a.u_TexRange[3]=f/d,a.u_offset[0]=o,a.u_offset[1]=_,x.enabled&&!this._isMain&&n.addTexture(t,(u._byteLength>>2)-16),(this._curSubmit=n)._renderType=10017,n._numEle+=6)}else this.sprite&&g.timer.callLater(this,this._repaintSprite)},e.setShader=function(t){yt.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},e.setFilters=function(t){yt.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=d.RENDERBASE,this._renderKey=0,this._drawCount++},e.drawTexture=function(t,e,i,r,s,a,n){this._drawTextureM(t,e,i,r,s,a,n,null,1)},e.addTextureVb=function(t,e,i){for(var r=this._curSubmit._vb||this._vb,s=r._byteLength>>2,a=(r.byteLength=s+16<<2,r.getFloat32Array()),n=0;n<16;n+=4)a[s++]=t[n]+e,a[s++]=t[n+1]+i,a[s++]=t[n+2],a[s++]=t[n+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),r._upload=!0},e.willDrawTexture=function(t,e){var i,r,s,a,n,h;return t.loaded&&t.bitmap&&t.source?((i=(n=t.bitmap).id+this._shader2D.ALPHA*e+10016)!=this._renderKey&&(s=(r=this._shader2D).ALPHA,a=this._curSubmit.shaderValue,r.ALPHA*=e,this._renderKey=i,this._drawCount++,r.glTexture=n,e=null,h=(n=this._vb)._byteLength/32*3,e=ke.create(this,this._ib,n,h,C.create(1,0)),(this._submits[this._submits._length++]=e).shaderValue.textureHost=t,e._renderType=10016,e._preIsSameTextureShader=10016===this._curSubmit._renderType&&r.ALPHA===a.ALPHA,this._curSubmit=e,r.ALPHA=s),i):(this.sprite&&g.timer.callLater(this,this._repaintSprite),0)},e.drawTextures=function(t,e,i,r){if(t.loaded&&t.bitmap&&t.source){var s=this._clipRect;if(this._clipRect=M.MAXCLIPRECT,this._drawTextureM(t,e[0],e[1],t.width,t.height,i,r,null,1)){if(this._clipRect=s,it.drawCall++,!(e.length<4)){for(var a=this._curSubmit._vb||this._vb,n=this._curMat.a,h=this._curMat.d,l=2,o=e.length;l<o;l+=2)T.copyPreImgVb(a,(e[l]-e[l-2])*n,(e[l+1]-e[l-1])*h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&g.timer.callLater(this,this._repaintSprite)},e._drawTextureM=function(t,e,i,r,s,a,n,h,l){var o,_,u,c;return t.loaded&&t.source?(o=this._curSubmit._vb||this._vb,u=t.bitmap,e+=a,i+=n,this._drawCount++,(a=u.id+this._shader2D.ALPHA*l+10016)!=this._renderKey&&(this._renderKey=a,n=this._curSubmit.shaderValue,_=(a=this._shader2D).ALPHA,a.ALPHA*=l,a.glTexture=u,l=null,c=(u=this._vb)._byteLength/32*3,l=ke.create(this,this._ib,u,c,C.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&a.ALPHA===n.ALPHA,this._curSubmit=l,o=this._curSubmit._vb||this._vb,a.ALPHA=_),!!T.fillRectImgVb(o,this._clipRect,e,i,r||t.width,s||t.height,t.uv,h||this._curMat,this._x,this._y,0,0)&&(x.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(o._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)):(this.sprite&&g.timer.callLater(this,this._repaintSprite),!1)},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e._drawText=function(t,e,i,r,s,a,n,h,l,o){var _,u,c=t.bitmap,d=(this._drawCount++,c.id+this._shader2D.ALPHA+10016),f=(d!=this._renderKey&&(this._renderKey=d,d=this._curSubmit.shaderValue,(_=this._shader2D).glTexture=c,c=null,u=(f=this._vb)._byteLength/32*3,(c=x.enabled?ke.create(this,this._ib,f,u,C.create(1,0)):ke.create(this,this._ib,f,u,Ai.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===d.ALPHA,(this._submits[this._submits._length++]=c).shaderValue.textureHost=t,c._renderType=10016,this._curSubmit=c),t.active(),this._curSubmit._vb||this._vb);T.fillRectImgVb(f,this._clipRect,e+n,i+h,r||t.width,s||t.height,t.uv,a||this._curMat,this._x,this._y,l,o,!0)&&(x.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(f._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(t,e,i,r,s,a,n,h,l){var o,_,u;a?(o=this._curMat,_=this._x,u=this._y,0===n&&0===h||(this._x=n*o.a+h*o.c,this._y=h*o.d+n*o.b),a&&o.bTransform?(v.mul(a,o,M._tmpMatrix),(a=M._tmpMatrix)._checkTransform()):(this._x+=o.tx,this._y+=o.ty),this._drawTextureM(t,e,i,r,s,0,0,a,l),this._x=_,this._y=u):this._drawTextureM(t,e,i,r,s,n,h,null,l)},e.fillQuadrangle=function(t,e,i,r,s){var a,n=this._curSubmit,h=this._vb,l=this._shader2D,o=n.shaderValue;this._renderKey=0,t.bitmap?(a=t.bitmap,l.glTexture==a&&l.ALPHA===o.ALPHA||(l.glTexture=a,(n=this._curSubmit=d.createSubmit(this,this._ib,h,h._byteLength/32*3,C.create(1,0))).shaderValue.glTexture=a,this._submits[this._submits._length++]=n),T.fillQuadrangleImgVb(h,e,i,r,t.uv,s||this._curMat,this._x,this._y)):(n.shaderValue.fillStyle&&n.shaderValue.fillStyle.equal(t)&&l.ALPHA===o.ALPHA||(l.glTexture=null,(n=this._curSubmit=d.createSubmit(this,this._ib,h,h._byteLength/32*3,C.create(2,0))).shaderValue.defines.add(2),n.shaderValue.fillStyle=gt.create(t),this._submits[this._submits._length++]=n),T.fillQuadrangleImgVb(h,e,i,r,nt.DEF_UV,s||this._curMat,this._x,this._y)),n._numEle+=6},e.drawTexture2=function(t,e,i,r,s,a,n,h){var l;0!=a&&(l=this._curMat,this._x=t*l.a+e*l.c,this._y=e*l.d+t*l.b,s=s&&(l.bTransform||s.bTransform?(v.mul(s,l,M._tmpMatrix),M._tmpMatrix):(this._x+=s.tx+l.tx,this._y+=s.ty+l.ty,v.EMPTY)),1!==a||n?(e=this._shader2D.ALPHA,t=this._nBlendType,this._shader2D.ALPHA=a,n&&(this._nBlendType=y.TOINT(n)),this._drawTextureM(h[0],h[1]-i,h[2]-r,h[3],h[4],0,0,s,1),this._shader2D.ALPHA=e,this._nBlendType=t):this._drawTextureM(h[0],h[1]-i,h[2]-r,h[3],h[4],0,0,s,1),this._x=this._y=0)},e.drawCanvas=function(t,e,i,r,s){var a,n,h=t.context;this._renderKey=0,h._targets?(this._submits[this._submits._length++]=Ve.create(h,0,null),this._curSubmit=d.RENDERBASE,h._targets.drawTo(this,e,i,r,s)):(a=this._submits[this._submits._length++]=Ve.create(h,this._shader2D.ALPHA,this._shader2D.filters),n=r/t.width,t=s/t.height,a=a._matrix,this._curMat.copyTo(a),1!=n&&1!=t&&a.scale(n,t),n=a.tx,t=a.ty,a.tx=a.ty=0,a.transformPoint(Z.TEMP.setTo(e,i)),a.translate(Z.TEMP.x+n,Z.TEMP.y+t),this._curSubmit=d.RENDERBASE),p.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=h._targets?"yellow":"green",this.strokeRect(e-1,i-1,r+2,s+2,1),this.strokeRect(e,i,r,s,1),this.restore())},e.drawTarget=function(t,e,i,r,s,a,n,h,l,o){void 0===o&&(o=-1);var _=this._vb;T.fillRectImgVb(_,this._clipRect,e,i,r,s,l||nt.DEF_UV,a||this._curMat,this._x,this._y,0,0)&&(this._renderKey=0,this._shader2D.glTexture=null,this._curSubmit.shaderValue,(e=this._curSubmit=se.create(this,this._ib,_,(_._byteLength-64)/32*3,h,n)).blendType=-1==o?this._nBlendType:o,e.scope=t,this._submits[this._submits._length++]=e,this._curSubmit._numEle+=6)},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.drawTriangles=function(t,e,i,r,s,a,n,h,l,o){if(!t.loaded||!t.source)return this.sprite&&g.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;t.bitmap;var h=this._mixRGBandAlpha(4294967295,h),_=(r.length,a.length),u=(this._renderKey=-1,this._curSubmit=ke.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,C.create(1,0)));return u.shaderValue.textureHost=t,u._renderType=10016,this._submits[this._submits._length++]=u,n?(M._tmpMatrix.a=n.a,M._tmpMatrix.b=n.b,M._tmpMatrix.c=n.c,M._tmpMatrix.d=n.d,M._tmpMatrix.tx=n.tx+e,M._tmpMatrix.ty=n.ty+i,v.mul(M._tmpMatrix,this._curMat,M._tmpMatrix)):(M._tmpMatrix.a=this._curMat.a,M._tmpMatrix.b=this._curMat.b,M._tmpMatrix.c=this._curMat.c,M._tmpMatrix.d=this._curMat.d,M._tmpMatrix.tx=this._curMat.tx+e,M._tmpMatrix.ty=this._curMat.ty+i),this._triangleMesh.addData(r,s,a,M._tmpMatrix,h,this),this._curSubmit._numEle+=_,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},e.transform=function(t,e,i,r,s,a){Mt.save(this),v.mul(v.TEMP.setTo(t,e,i,r,s,a),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.transformByMatrix=function(t){Mt.save(this),v.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(t){Mt.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){Mt.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,r){var s,a,n,h,l,o;0!=this._curMat.b||0!=this._curMat.c?(this._renderKey=0,l=re.create(4),this.addRenderObject(l),s=(l=this._vb)._byteLength>>2,T.fillRectImgVb(l,null,t,e,i,r,nt.DEF_UV,this._curMat,this._x,this._y,0,0)?(this._shader2D.glTexture=null,(a=this._curSubmit=d.createSubmit(this,this._ib,l,(l._byteLength-64)/32*3,C.create(2,0))).shaderValue.ALPHA=1,this._submits[this._submits._length++]=a,this._curSubmit._numEle+=6):alert("clipRect calc stencil rect error"),a=re.create(5),this.addRenderObject(a),l=l.getFloat32Array(),h=Math.min(Math.min(Math.min(l[s],l[4+s]),l[8+s]),l[12+s]),n=Math.max(Math.max(Math.max(l[s],l[4+s]),l[8+s]),l[12+s]),o=Math.min(Math.min(Math.min(l[1+s],l[5+s]),l[9+s]),l[13+s]),l=Math.max(Math.max(Math.max(l[1+s],l[5+s]),l[9+s]),l[13+s]),St.save(this,a,t,e,i,r,h,o,n-h,l-o)):(i*=this._curMat.a,r*=this._curMat.d,s=Z.TEMP,this._curMat.transformPoint(s.setTo(t,e)),i<0&&(s.x=s.x+i,i=-i),r<0&&(s.y=s.y+r,r=-r),this._renderKey=0,a=this._curSubmit=ee.create(this),(this._submits[this._submits._length++]=a).submitIndex=this._submits._length,a.submitLength=9999999,At.save(this,a),h=(n=this._clipRect).x,l=n.y,o=s.x+i,t=s.y+r,h<s.x&&(n.x=s.x),l<s.y&&(n.y=s.y),n.width=Math.min(o,h+n.width)-n.x,n.height=Math.min(t,l+n.height)-n.y,this._shader2D.glTexture=null,a.clipRect.copyFrom(n)),this._curSubmit=d.RENDERBASE},e.setIBVB=function(t,e,i,r,s,a,n,h,l,o,_){if(void 0===l&&(l=0),void 0===o&&(o=0),void 0===_&&(_=0),null===i&&(i=c.isFlash?((u=r)._selfIB||(u._selfIB=Ii.create(35044)),u._selfIB.clear(),u._selfIB):this._ib,T.expandIBQuadrangle(i,r._byteLength/(4*r.vertexStride*4))),!h||!n)throw Error("setIBVB must input:shader shaderValues");var u=Jt.create(this,r,i,s,n,h,l,o,_);(a=a||v.EMPTY).translate(t,e),v.mul(a,this._curMat,u._mat),a.translate(-t,-e),this._submits[this._submits._length++]=u,this._curSubmit=d.RENDERBASE,this._renderKey=0},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.fillTrangles=function(t,e,i,r,s){var a=this._curSubmit,n=this._vb,h=this._shader2D,l=a.shaderValue,o=r.length>>4,_=t.bitmap;this._renderKey=0,h.glTexture==_&&h.ALPHA===l.ALPHA||((a=this._curSubmit=d.createSubmit(this,this._ib,n,n._byteLength/32*3,C.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=a),T.fillTranglesVB(n,e,i,r,s||this._curMat,this._x,this._y),a._numEle+=6*o},e.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},e.finish=function(){E.mainContext.finish()},e.flush=function(){var t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&T.expandIBQuadrangle(this._ib,t),!this._isMain&&x.enabled&&x._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=x._atlasRestore;for(var e=this._submits,i=0,r=e._length;i<r;i++){var s=e[i];10016===s.getRenderType()&&s.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),Ht.instance&&Ht.getInstance().reset();for(var i=0,a=this.meshlist.length;i<a;i++){var n=this.meshlist[i];n.canReuse?n.releaseMesh():n.destroy()}return this.meshlist.length=0,this._curSubmit=d.RENDERBASE,this._renderKey=0,this._triangleMesh=Ge.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},e.setPathId=function(t){this.mId=t,-1!=this.mId&&(this.mHaveKey=!1,(t=lt.getInstance()).shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,t.shapeLineDic[this.mId])&&(this.mHaveLineKey=!0)},e.movePath=function(t,e){var i=t,r=e;t=this._curMat.a*i+this._curMat.c*r+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*r+this._curMat.ty,this.mX+=t,this.mY+=e},e.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},e.closePath=function(){this._path.closePath=!0},e.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},e.stroke=function(){var t,e=this._getPath();0<this.lineWidth&&(-1==this.mId?e.drawLine(0,0,e.tempArray,this.lineWidth,this.strokeStyle._color.numColor):this.mHaveLineKey?((t=lt.getInstance().shapeLineDic[this.mId]).rebuild(e.tempArray),e.setGeomtry(t)):lt.getInstance().addLine(this.mId,e.drawLine(0,0,e.tempArray,this.lineWidth,this.strokeStyle._color.numColor)),e.update(),t=[this.mX,this.mY],(e=d.createShape(this,e.ib,e.vb,e.count,e.offset,C.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,e.shaderValue.u_pos=t,e.shaderValue.u_mmat2=u.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=e,this._renderKey=-1)},e.line=function(t,e,i,r,s,a){var n=this._curSubmit,h=this._vb;T.fillLineVb(h,this._clipRect,t,e,i,r,s,a)&&(this._renderKey=0,t=this._shader2D,e=n.shaderValue,t.strokeStyle===e.strokeStyle&&t.ALPHA===e.ALPHA||(t.glTexture=null,(n=this._curSubmit=d.createSubmit(this,this._ib,h,(h._byteLength-64)/32*3,C.create(2,0))).shaderValue.strokeStyle=t.strokeStyle,n.shaderValue.mainID=2,n.shaderValue.ALPHA=t.ALPHA,this._submits[this._submits._length++]=n),n._numEle+=6)},e.moveTo=function(t,e,i){void 0===i&&(i=!0);var r,s=this._getPath();i&&(i=t,r=e,t=this._curMat.a*i+this._curMat.c*r,e=this._curMat.b*i+this._curMat.d*r),s.addPoint(t,e)},e.lineTo=function(t,e,i){void 0===i&&(i=!0);var r,s=this._getPath();i&&(i=t,r=e,t=this._curMat.a*i+this._curMat.c*r,e=this._curMat.b*i+this._curMat.d*r),s.addPoint(t,e)},e.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];for(var r=i[2],s=(t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(r[0],r[1]),2),a=r.length;s<a;)this.quadraticCurveTo(r[s++],r[s++],r[s++],r[s++]);this.stroke()},e.arcTo=function(t,e,i,r,s){if(-1==this.mId||!this.mHaveKey){var a=0,n=0,h=0,l=this._getPath(),o=(this._curMat.copyTo(M._tmpMatrix),M._tmpMatrix.tx=M._tmpMatrix.ty=0,M._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),M._tmpMatrix.invertTransformPoint(M._tempPoint),M._tempPoint.x-t),_=M._tempPoint.y-e,u=Math.sqrt(o*o+_*_);if(!(u<=1e-6)){var o=o/u,_=_/u,i=i-t,r=r-e,c=Math.sqrt(i*i+r*r);if(!(c<=1e-6)){var i=i/c,r=r/c,c=o+i,d=_+r,f=Math.sqrt(c*c+d*d);if(!(f<=1e-6))for(var c=c/f,d=d/f,f=Math.acos(c*o+d*_),f=Math.PI/2-f,m=(u=s/Math.tan(f))*o+t,p=u*_+e,u=Math.sqrt(u*u+s*s),g=t+c*u,x=e+d*u,b=0,v=0,y=(v=(b=(s=0<=o*r-_*i?2*f/M.SEGNUM:2*-f/M.SEGNUM,Math.sin(s)),Math.cos(s)),n=this._curMat.a*m+this._curMat.c*p,h=this._curMat.b*m+this._curMat.d*p,n==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(n,h),m-g),T=p-x,a=0;a<M.SEGNUM;a++){var A=y*v+T*b,E=-y*b+T*v,n=A+g,h=E+x;t=this._curMat.a*n+this._curMat.c*h,h=e=this._curMat.b*n+this._curMat.d*h,(n=t)==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(n,h),y=A,T=E}}}}},e.arc=function(t,e,i,r,s,a,n){if(void 0===a&&(a=!1),void 0===n&&(n=!0),-1!=this.mId){var h=lt.getInstance().shapeDic[this.mId];if(h&&this.mHaveKey&&!h.needUpdate(this._curMat))return;e=t=0}var l,o=0,_=0,u=0,c=0,d=0,o=s-r;if(a)if(Math.abs(o)>=2*Math.PI)o=2*-Math.PI;else for(;0<o;)o-=2*Math.PI;else if(Math.abs(o)>=2*Math.PI)o=2*Math.PI;else for(;o<0;)o+=2*Math.PI;h=o/(d=i<101?Math.max(10,o*i/5):i<201?Math.max(10,o*i/20):Math.max(10,o*i/40))/2,Math.abs(4/3*(1-Math.cos(h))/Math.sin(h));for(var f=this._getPath(),m=NaN,p=NaN,c=0;c<=d;c++)l=r+o*(c/d),_=t+Math.cos(l)*i,u=e+Math.sin(l)*i,n&&(m=_,p=u,_=this._curMat.a*m+this._curMat.c*p,u=this._curMat.b*m+this._curMat.d*p),_==this._path.getEndPointX()&&u==this._path.getEndPointY()||f.addPoint(_,u);_=t+Math.cos(s)*i,u=e+Math.sin(s)*i,n&&(m=_,p=u,_=this._curMat.a*m+this._curMat.c*p,u=this._curMat.b*m+this._curMat.d*p),_==this._path.getEndPointX()&&u==this._path.getEndPointY()||f.addPoint(_,u)},e.quadraticCurveTo=function(t,e,i,r){for(var s=U.I,a=i,n=r,h=(i=this._curMat.a*a+this._curMat.c*n,r=this._curMat.b*a+this._curMat.d*n,a=t,n=e,t=this._curMat.a*a+this._curMat.c*n,e=this._curMat.b*a+this._curMat.d*n,s.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,r],30,2)),l=0,o=h.length/2;l<o;l++)this.lineTo(h[2*l],h[2*l+1],!1);this.lineTo(i,r,!1)},e.rect=function(t,e,i,r){this._other=this._other.make(),this._other.path||(this._other.path=new bt),this._other.path.rect(t,e,i,r)},e.strokeRect=function(t,e,i,r,s){var a=.5*s;this.line(t-a,e,t+i+a,e,s,this._curMat),this.line(t+i,e,t+i,e+r,s,this._curMat),this.line(t,e,t,e+r,s,this._curMat),this.line(t-a,e+r,t+i+a,e+r,s,this._curMat)},e.clip=function(){},e.drawPoly=function(t,e,i,r,s,a,n){void 0===n&&(n=!1),this._renderKey=0,this._shader2D.glTexture=null;var n=this._getPath(),r=(-1==this.mId?n.polygon(t,e,i,r,s||1,a):this.mHaveKey?((h=lt.getInstance().shapeDic[this.mId]).setMatrix(this._curMat),h.rebuild(n.tempArray),n.setGeomtry(h)):(h=n.polygon(t,e,i,r,s||1,a),lt.getInstance().addShape(this.mId,h),h.setMatrix(this._curMat)),n.update(),[this.mX,this.mY]),h=d.createShape(this,n.ib,n.vb,n.count,n.offset,C.create(4,0));h.shaderValue.ALPHA=this._shader2D.ALPHA,h.shaderValue.u_pos=r,h.shaderValue.u_mmat2=u.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=h,0<s&&(this.mHaveLineKey?((r=lt.getInstance().shapeLineDic[this.mId]).rebuild(n.tempArray),n.setGeomtry(r)):lt.getInstance().addShape(this.mId,n.drawLine(t,e,i,s,a)),n.update(),(h=d.createShape(this,n.ib,n.vb,n.count,n.offset,C.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,h.shaderValue.u_mmat2=u.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=h)},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new bt)},t(0,e,"globalCompositeOperation",function(){return y.NAMES[this._nBlendType]},function(t){t=y.TOINT[t];null!=t&&this._nBlendType!==t&&(yt.save(this,65536,this,!0),this._curSubmit=d.RENDERBASE,this._renderKey=0,this._nBlendType=t)}),t(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(yt.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=gt.create(t))}),t(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(yt.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),t(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Dt),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),t(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(yt.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=gt.create(t))}),t(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign!==t&&(this._other=this._other.make(),yt.save(this,32768,this._other,!1),this._other.textAlign=t)}),t(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth!==t&&(this._other=this._other.make(),yt.save(this,256,this._other,!1),this._other.lineWidth=t)}),t(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline!==t&&(this._other=this._other.make(),yt.save(this,16384,this._other,!1),this._other.textBaseline=t)}),t(0,e,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),yt.save(this,8,this._other,!1),this._other.font===_e.EMPTY?this._other.font=new _e(t):this._other.font.setFont(t))}),M.__init__=function(){Te.DEFAULT=new Te},M._tempPoint=new Z,M._SUBMITVBSIZE=32e3,M._MAXSIZE=99999999,M._RECTVBSIZE=16,M.MAXCLIPRECT=new q(0,0,99999999,99999999),M._COUNT=0,M._tmpMatrix=new v,M.SEGNUM=32,M._contextcount=0,N(M,["_fontTemp",function(){return this._fontTemp=new _e},"_drawStyleTemp",function(){return this._drawStyleTemp=new gt(null)}]),M.__init$=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=_e.EMPTY}var e;r(t,""),(e=t.prototype).clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=_e.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,Te=t};var Te,Ae=M;function M(t){this._x=0,this._y=0,this._id=++M._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,M.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=M.MAXCLIPRECT,this.mOutPoint,this._canvas=t,M._contextcount++,c.isFlash?(this._ib=Ii.create(35044),T.fillIBQuadrangle(this._ib,16)):this._ib=Ii.QuadrangleIB,this.clear()}r(L,"laya.webgl.shader.d2.value.Value2D",a),(B=L.prototype).setValue=function(t){},B.refresh=function(){var t=this.size;return t[0]=u.width,t[1]=u.height,this.alpha=this.ALPHA*u.worldAlpha,this.mmat=u.worldMatrix4,this},B._ShaderWithCompile=function(){return D.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,wi.create)},B._withWorldShaderDefines=function(){var t=u.worldShaderDefines,e=D.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,r={},s=this.defines.toNameDic();for(i in s)r[i]="";for(i in t.toNameDic())r[i]="";e=D.withCompile2D(0,this.mainID,r,this.mainID|this.defines._value|t.getValue(),wi.create)}var a=u.worldFilters;if(a)for(var n,h=a.length,l=0;l<h;l++)(n=a[l])&&n.action.setValue(this);return e},B.upload=function(){var t,e=u,i=(this.alpha=this.ALPHA*e.worldAlpha,u.worldMatrix4!==u.TEMPMAT4_ARRAY&&this.defines.add(128),E.shaderHighPrecision&&this.defines.add(1024),e.worldShaderDefines?this._withWorldShaderDefines():D.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile());this.size[0]=e.width,this.size[1]=e.height,this.mmat=e.worldMatrix4,We.activeShader!==i?i._shaderValueWidth!==e.width||i._shaderValueHeight!==e.height?(i._shaderValueWidth=e.width,i._shaderValueHeight=e.height):t=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!==e.width||i._shaderValueHeight!==e.height?(i._shaderValueWidth=e.width,i._shaderValueHeight=e.height):t=i._params2dQuick1||i._make2dQuick1(),i.upload(this,t)},B.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,r=0;r<i;r++)(e=t[r])&&(this.defines.add(e.type),e.action.setValue(this))},B.clear=function(){this.defines.setValue(this.subID)},B.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.clear()},L._initone=function(t,e){L._typeClass[t]=e,L._cache[t]=[],L._cache[t]._length=0},L.__init__=function(){L._POSITION=[2,5126,!1,4*ce.BYTES_PE,0],L._TEXCOORD=[2,5126,!1,4*ce.BYTES_PE,2*ce.BYTES_PE],L._initone(2,Je),L._initone(4,ai),L._initone(256,ei),L._initone(512,je),L._initone(1,ri),L._initone(65,Ai),L._initone(9,ri)},L.create=function(t,e){var i=L._cache[t|e];return i._length?i[--i._length]:new L._typeClass[t|e](e)},L._POSITION=null,L._TEXCOORD=null,L._cache=[],L._typeClass=[],L.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var C=L;function L(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,L.__super.call(this),this.defines=new Ce,this.position=L._POSITION,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=L._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=L._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}r(Se,"laya.webgl.utils.RenderSprite3D",j),(e=Se.prototype).onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},e._mask=function(t,e,i,r){var s,a,n,h,l,o,_,u,c,d=this._next,f=t.mask;f?(e.ctx.save(),a=e.ctx.globalCompositeOperation,(n=new q).copyFrom(f.getBounds()),n.width=Math.round(n.width),n.height=Math.round(n.height),n.x=Math.round(n.x),n.y=Math.round(n.y),0<n.width&&0<n.height&&(h=t._style._tf,(l=jt.create()).addValue("bounds",n),s=Zt.create([l,e],laya.webgl.utils.RenderSprite3D.tmpTarget),e.addRenderObject(s),f.render(e,-n.x,-n.y),s=Zt.create([l],laya.webgl.utils.RenderSprite3D.endTmpTarget),e.addRenderObject(s),e.ctx.save(),e.clipRect(i-h.translateX+n.x,r-h.translateY+n.y,n.width,n.height),d._fun.call(d,t,e,i,r),e.ctx.restore(),f=re.create(6),a=e.ctx.globalCompositeOperation,f.blendMode="mask",e.addRenderObject(f),v.TEMP.identity(),o=C.create(1,0),_=nt.INV_UV,u=n.width,c=n.height,(n.width<32||n.height<32)&&((_=Se.tempUV)[0]=0,_[1]=0,_[2]=32<=n.width?1:n.width/32,_[3]=0,_[4]=32<=n.width?1:n.width/32,_[5]=32<=n.height?1:n.height/32,_[6]=0,_[7]=32<=n.height?1:n.height/32,n.width=32<=n.width?n.width:32,n.height=32<=n.height?n.height:32,_[1]*=-1,_[3]*=-1,_[5]*=-1,_[7]*=-1,_[1]+=1,_[3]+=1,_[5]+=1,_[7]+=1),e.ctx.drawTarget(l,i+n.x-h.translateX,r+n.y-h.translateY,u,c,v.TEMP,"tmpTarget",o,_,6),s=Zt.create([l],laya.webgl.utils.RenderSprite3D.recycleTarget),e.addRenderObject(s),(f=re.create(6)).blendMode=a,e.addRenderObject(f)),e.ctx.restore()):d._fun.call(d,t,e,i,r)},e._blend=function(t,e,i,r){var s=t._style,a=this._next;s.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=s.blendMode,a._fun.call(a,t,e,i,r),e.ctx.restore()):a._fun.call(a,t,e,i,r)},e._transform=function(t,e,i,r){var s,a,n=t.transform,h=this._next;n&&h!=j.NORENDER?(s=e.ctx,t._style,n.tx=i,n.ty=r,a=(s=s._getTransformMatrix()).clone(),v.mul(n,s,s),s._checkTransform(),n.tx=n.ty=0,h._fun.call(h,t,e,0,0),a.copyTo(s),a.destroy()):h._fun.call(h,t,e,i,r)},Se.tmpTarget=function(t,e){var i=t.getValue("bounds"),i=Ke.create(i.width,i.height);i.start(),i.clear(0,0,0,0),t.addValue("tmpTarget",i)},Se.endTmpTarget=function(t){t.getValue("tmpTarget").end()},Se.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},N(Se,["tempUV",function(){return this.tempUV=new Array(8)}]);var Ee=Se;function Se(t,e){Se.__super.call(this,t,e)}r(Re,"laya.filters.webgl.ColorFilterActionGL",i),a=Re.prototype,g.imps(a,{"laya.filters.IFilterActionGL":!0}),a.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},a.apply3d=function(t,e,i,r,s){var a=t.getValue("bounds"),n=C.create(1,0),h=(n.setFilters([this.data]),v.TEMP);h.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,h,"src",n)};var we=Re;function Re(){this.data=null,Re.__super.call(this)}r(Me,"laya.webgl.atlas.Atlaser",dt),(B=Me.prototype).computeUVinAtlasTexture=function(t,e,i,r){var s=x.atlasTextureWidth,a=x.atlasTextureHeight,n=i/s,h=r/a,i=(i+t.bitmap.width)/s,r=(r+t.bitmap.height)/a,s=t.bitmap.width/s,a=t.bitmap.height/a;t.uv=[n+e[0]*s,h+e[1]*a,i-(1-e[2])*s,h+e[3]*a,i-(1-e[4])*s,r-(1-e[5])*a,n+e[6]*s,r-(1-e[7])*a]},B.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t.url,e=this._InAtlasWebGLImagesKey[e||t.id];if(e)return e.offsetInfoID}return-1},B.addToAtlasTexture=function(t,e,i){var r;t instanceof laya.webgl.resource.WebGLImage&&(r=t.url,this._InAtlasWebGLImagesKey[r||t.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])),this._atlasCanvas.texSubImage2D(e,i,t.atlasImgData||t.atlasSource),t.clearAtlasSource()},B.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var r=t.uv.slice(),s=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(r),this._inAtlasTextureBitmapValue.push(s),this.computeUVinAtlasTexture(t,r,e,i),t.bitmap=this._atlasCanvas},B.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},B.dispose=function(){this.clear(),this._atlasCanvas.destroy()},t(0,B,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),t(0,B,"texture",function(){return this._atlasCanvas}),t(0,B,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey});var Ie=Me;function Me(t,e,i,r,s){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,Me.__super.call(this,t,e,s),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new hi,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=i,this._atlasCanvas.height=r,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}r(P,"laya.webgl.shader.d2.ShaderDefines2D",Ot),P.__init__=function(){P.reg("TEXTURE2D",1),P.reg("COLOR2D",2),P.reg("PRIMITIVE",4),P.reg("GLOW_FILTER",8),P.reg("BLUR_FILTER",16),P.reg("COLOR_FILTER",32),P.reg("COLOR_ADD",64),P.reg("WORLDMAT",128),P.reg("FILLTEXTURE",256),P.reg("FSHIGHPRECISION",1024)},P.reg=function(t,e){Ot._reg(t,e,P.__name2int,P.__int2name)},P.toText=function(t,e,i){return Ot._toText(t,e,i)},P.toInt=function(t){return Ot._toInt(t,P.__name2int)},P.TEXTURE2D=1,P.COLOR2D=2,P.PRIMITIVE=4,P.FILTERGLOW=8,P.FILTERBLUR=16,P.FILTERCOLOR=32,P.COLORADD=64,P.WORLDMAT=128,P.FILLTEXTURE=256,P.SKINMESH=512,P.SHADERDEFINE_FSHIGHPRECISION=1024,P.__name2int={},P.__int2name=[],P.__int2nameMap=[];var Ce=P;function P(){P.__super.call(this,P.__name2int,P.__int2name,P.__int2nameMap)}r(Le,"laya.webgl.shapes.Ellipse",h);function Le(t,e,i,r,s,a,n){Le.__super.call(this,t,e,i,r,40,s,a,n)}r(De,"laya.webgl.shapes.Line",h),(e=De.prototype).rebuild=function(t){for(var e,i,r=t.length,s=(r!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(r/2-1)),this.mFloat32Array=new Float32Array(5*r)),this._points.length=0,-1),a=-1,n=t.length/2,h=0;h<n;h++)e=t[2*h],i=t[2*h+1],(.01<Math.abs(s-e)||.01<Math.abs(a-i))&&this._points.push(e,i),s=e,a=i},e.getData=function(t,e,i){var r=[],s=[];0<this.borderWidth&&this.createLine2(this._points,r,this.borderWidth,i,s,this._points.length/2),this.mUint16Array.set(r,0),this.mFloat32Array.set(s,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)};var Pe=De;function De(t,e,i,r,s){this._points=[],this.rebuild(i),De.__super.call(this,t,e,0,0,0,s,r,s,0)}r(Be,"laya.webgl.shapes.LoopLine",h),(i=Be.prototype).getData=function(t,e,i){if(0<this.borderWidth){for(var r,s,a=this.color,n=(a>>16&255)/255,h=(a>>8&255)/255,l=(255&a)/255,o=[],a=[],_=Math.floor(this._points.length/2),u=0;u<_;u++)r=this._points[2*u],s=this._points[2*u+1],o.push(this.x+r,this.y+s,n,h,l);this.createLoopLine(o,a,this.borderWidth,i+o.length/5),t.append(new Uint16Array(a)),e.append(new Float32Array(o))}},i.createLoopLine=function(t,e,i,r,s,a){t.length;var n,h,l,o,_,u,c,d=t.concat(),f=s||t,s=this.borderColor,m=(s>>16&255)/255,p=(s>>8&255)/255,g=(255&s)/255,t=[d[0],d[1]],s=[d[d.length-5],d[d.length-4]],x=s[0]+.5*(t[0]-s[0]),t=s[1]+.5*(t[1]-s[1]),b=(d.unshift(x,t,0,0,0),d.push(x,t,0,0,0),d.length/5),v=r,y=i/2,T=d[0],A=d[1],E=d[5],S=d[6],w=-(A-S),R=T-E,I=Math.sqrt(w*w+R*R);f.push(T-(w=w/I*y),A-(R=R/I*y),m,p,g,T+w,A+R,m,p,g);for(var M=1;M<b-1;M++)T=d[5*(M-1)],A=d[5*(M-1)+1],E=d[5*M],S=d[5*M+1],o=d[5*(M+1)],h=d[5*(M+1)+1],R=T-E,c=E-o,l=(-(w=(w=-(A-S))/(I=Math.sqrt(w*w+R*R))*y)+T)*(-(R=R/I*y)+S)-(-w+E)*(-R+A),u=(-(_=(_=-(S-h))/(I=Math.sqrt(_*_+c*c))*y)+o)*(-(c=c/I*y)+S)-(-_+E)*(-c+h),c=(n=-R+A-(-R+S))*(_=-_+E-(-_+o))-(o=-c+h-(-c+S))*(h=-w+E-(-w+T)),Math.abs(c)<.1?(c+=10.1,f.push(E-w,S-R,m,p,g,E+w,S+R,m,p,g)):(h=(h*u-_*l)/c,_=(o*l-n*u)/c,f.push(h,_,m,p,g,E-(h-E),S-(_-S),m,p,g));a&&(e=a);for(var C=this.edges+1,M=1;M<C;M++)e.push(v+2*(M-1),v+2*(M-1)+1,v+2*M+1,v+2*M+1,v+2*M,v+2*(M-1));return e.push(v+2*(M-1),v+2*(M-1)+1,v+1,v+1,v,v+2*(M-1)),f};var Fe=Be;function Be(t,e,i,r,s){this._points=[];for(var a=NaN,n=NaN,h=-1,l=-1,o=i.length/2-1,_=0;_<o;_++)a=i[2*_],n=i[2*_+1],(.01<Math.abs(h-a)||.01<Math.abs(l-n))&&this._points.push(a,n),h=a,l=n;a=i[2*o],n=i[2*o+1],h=this._points[0],l=this._points[1],(.01<Math.abs(h-a)||.01<Math.abs(l-n))&&this._points.push(a,n),Be.__super.call(this,t,e,0,0,this._points.length/2,0,r,s)}r(Oe,"laya.webgl.shapes.Polygon",h),(a=Oe.prototype).rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},a.setMatrix=function(t){t.copyTo(this._mat)},a.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},a.getData=function(t,e,i){var r=0,s=this._points,a=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,n=[],a=this.earcutTriangles.length,r=0;r<a;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n)}}else{this._start=i;for(var n=[],h=[],l=[],o=this.color,_=(o>>16&255)/255,u=(o>>8&255)/255,c=(255&o)/255,a=Math.floor(s.length/2),r=0;r<a;r++)h.push(this.x+s[2*r],this.y+s[2*r+1],_,u,c),l.push(this.x+s[2*r],this.y+s[2*r+1]);for(this.earcutTriangles=Wt.earcut(l,null,2),a=this.earcutTriangles.length,r=0;r<a;r++)n.push(this.earcutTriangles[r]+i);this.mUint16Array=new Uint16Array(n),this.mFloat32Array=new Float32Array(h)}t.append(this.mUint16Array),e.append(this.mFloat32Array)};var Ne=Oe;function Oe(t,e,i,r,s,a){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=v.create(),this._points=i.slice(0,i.length),Oe.__super.call(this,t,e,0,0,this._points.length/2,r,s,a)}r(Ue,"laya.webgl.submit.SubmitCanvas",d),(B=Ue.prototype).renderSubmit=function(){var t,e,i,r,s,a,n,h,l;return this._ctx_src._targets?this._ctx_src._targets.flush(this._ctx_src):(t=u.worldAlpha,e=u.worldMatrix4,i=u.worldMatrix,r=u.worldFilters,s=u.worldShaderDefines,a=this.shaderValue,n=this._matrix,h=this._matrix4,l=v.TEMP,v.mul(n,i,l),h[0]=l.a,h[1]=l.b,h[4]=l.c,h[5]=l.d,h[12]=l.tx,h[13]=l.ty,u.worldMatrix=l.clone(),u.worldMatrix4=h,u.worldAlpha=u.worldAlpha*a.alpha,a.filters&&a.filters.length&&(u.worldFilters=a.filters,u.worldShaderDefines=a.defines),this._ctx_src.flush(),u.worldAlpha=t,u.worldMatrix4=e,u.worldMatrix.destroy(),u.worldMatrix=i,u.worldFilters=r,u.worldShaderDefines=s),1},B.releaseRender=function(){var t=Ue._cache;this._ctx_src=null,t[t._length++]=this},B.getRenderType=function(){return 10003},Ue.create=function(t,e,i){var r=Ue._cache._length?Ue._cache[--Ue._cache._length]:new Ue,t=(r._ctx_src=t,r.shaderValue);return t.alpha=e,t.defines.setValue(0),i&&i.length&&t.setFilters(i),r},Ue._cache=((Ue._cache=[])._length=0,Ue._cache);var Ve=Ue;function Ue(){this._matrix=new v,this._matrix4=ce.defaultMatrix4.concat(),Ue.__super.call(this,1e4),this.shaderValue=new C(0,0)}r(He,"laya.webgl.submit.SubmitTexture",d),(e=He.prototype).releaseRender=function(){var t=He._cache;(t[t._length++]=this).shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},e.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},e.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!==t)for(var e=this._vb.getFloat32Array(),i=0,r=this._texs.length;i<r;i++){var s,a=this._texs[i],n=(a.active(),a.uv);this._texsID[i]!==a._uvID&&(this._texsID[i]=a._uvID,e[(s=this._vbPos[i])+2]=n[0],e[s+3]=n[1],e[s+6]=n[2],e[s+7]=n[3],e[s+10]=n[4],e[s+11]=n[5],e[s+14]=n[6],e[s+15]=n[7],this._vb.setNeedUpload()),a.bitmap!==t&&(this._isSameTexture=!1)}}},e.renderSubmit=function(){if(0===this._numEle)He._shaderSet=!1;else{var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return He._shaderSet=!1,1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=E.mainContext;if(y.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),y.activeBlendFunction=this._blendFn),it.drawCall++,it.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&We.activeShader&&He._shaderSet?We.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),He._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var r=t.bitmap,s=0,a=We.activeShader,n=0,h=this._texs.length;n<h;n++){var l=this._texs[n];l.bitmap===r&&n+1!==h||(a.uploadTexture2D(l.source),i.drawElements(4,6*(n-s+1),5123,this._startIdx+6*s*ce.BYTES_PIDX),r=l.bitmap,s=n)}else i.drawElements(4,this._numEle,5123,this._startIdx)}return 1},He.create=function(t,e,i,r,s){var a=He._cache._length?He._cache[--He._cache._length]:new He,e=(null==i&&((i=a._selfVb||(a._selfVb=Li.create(-1))).clear(),r=0),a._ib=e,a._vb=i,a._startIdx=r*ce.BYTES_PIDX,a._numEle=0,t._nBlendType),i=(a._blendFn=(t._targets?y.targetFns:y.fns)[e],a.shaderValue=s,a.shaderValue.setValue(t._shader2D),t._shader2D.filters);return i&&a.shaderValue.setFilters(i),a},He._cache=((He._cache=[])._length=0,He._cache),He._shaderSet=!0;var ke=He;function He(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,He.__super.call(this,t=void 0===t?1e4:t)}r(ze,"laya.webgl.utils.MeshTexture",_),(i=ze.prototype).addData=function(t,e,i,r,s,a){for(var n=t.length/2,h=this._vb.needSize(n*ze.const_stride)>>2,l=this._vb.getFloat32Array(),o=0,_=0;_<n;_++){var u=t[o],c=t[o+1],d=u*r.a+c*r.c+r.tx,u=u*r.b+c*r.d+r.ty;l[h++]=d,l[h++]=u,l[h++]=e[o],l[h++]=e[o+1],o+=2}this._vb.setNeedUpload();var f=this.vertNum;if(0<f){var m=i.length;m>ze.tmpIdx.length&&(ze.tmpIdx=new Uint16Array(m));for(var p=0;p<m;p++)ze.tmpIdx[p]=i[p]+f;this._ib.appendU16Array(ze.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=i.length},i.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},i.destroy=function(){this._ib.destroy(),this._vb.destroy()},ze.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new ze},ze.const_stride=16,ze._POOL=[],N(ze,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]);var Ge=ze;function ze(){ze.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}r(Ye,"laya.webgl.shader.BaseShader",$),Ye.activeShader=null,Ye.bindShader=null;var We=Ye;function Ye(){Ye.__super.call(this),this.lock=!0}r(Qe,"laya.webgl.resource.RenderTarget2D",Xe=nt),h=Qe.prototype,g.imps(h,{"laya.resource.IDispose":!0}),h.getType=function(){return this._type},h.getTexture=function(){return this},h.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},h.release=function(){this.destroy()},h.recycle=function(){Qe.POOL.push(this)},h.start=function(){var t=E.mainContext;return this._preRenderTarget=u.curRenderTarget,u.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=u.width,this._svHeight=u.height,u.width=this._w,u.height=this._h,We.activeShader=null),this},h.clear=function(t,e,i,r){var s=E.mainContext,a=(s.clearColor(t=void 0===t?0:t,e=void 0===e?0:e,i=void 0===i?0:i,r=void 0===r?1:r),16384);switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a=a|256|1024}s.clear(a)},h.end=function(){var t=E.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,u.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),u.width=this._svWidth,u.height=this._svHeight,We.activeShader=null):t.viewport(0,0,g.stage.width,g.stage.height)},h.getData=function(t,e,i,r){var s,a=E.mainContext;return a.bindFramebuffer(36160,this.bitmap.frameBuffer),36053===a.checkFramebufferStatus(36160)?(s=new Uint8Array(this._w*this._h*4),a.readPixels(t,e,i,r,this._surfaceFormat,this._surfaceType,s),a.bindFramebuffer(36160,null),s):(a.bindFramebuffer(36160,null),null)},h.destroy=function(t){void 0===t&&(t=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,Xe.prototype.destroy.call(this))},h.dispose=function(){},h._createWebGLRenderTarget=function(){this.bitmap=new di(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},t(0,h,"surfaceFormat",function(){return this._surfaceFormat}),t(0,h,"magFifter",function(){return this._magFifter}),t(0,h,"surfaceType",function(){return this._surfaceType}),t(0,h,"mipMap",function(){return this._mipMap}),t(0,h,"depthStencilFormat",function(){return this._depthStencilFormat}),t(0,h,"minFifter",function(){return this._minFifter}),t(0,h,"source",function(){return this._alreadyResolved?g.superGet(nt,this,"source"):null}),Qe.create=function(t,e,i,r,s,a,n,h,l){void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=-1);var o=Qe.POOL.pop();return(o=o||new Qe(t,e)).bitmap&&o._w==t&&o._h==e&&o._surfaceFormat==i&&o._surfaceType==r&&o._depthStencilFormat==s&&o._mipMap==a&&o._repeat==n&&o._minFifter==h&&o._magFifter==l||(o._w=t,o._h=e,o._surfaceFormat=i,o._surfaceType=r,o._depthStencilFormat=s,c.isConchWebGL&&34041===o._depthStencilFormat&&(o._depthStencilFormat=33189),o._mipMap=a,o._repeat=n,o._minFifter=h,o._magFifter=l,o.release(),o._createWebGLRenderTarget()),o},Qe.TYPE2D=1,Qe.TYPE3D=2,Qe.POOL=[];var Xe,Ke=Qe;function Qe(t,e,i,r,s,a,n,h,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=s,c.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=n,this._minFifter=h,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,Qe.__super.call(this,this.bitmap,nt.INV_UV)}r(qe,"laya.webgl.utils.Buffer",$),(a=qe.prototype)._bind=function(){this.activeResource(),qe._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(qe._bindVertexBuffer=this._glBuffer),qe._gl.bindBuffer(this._bufferType,qe._bindActive[this._bufferType]=this._glBuffer),We.activeShader=null)},a.recreateResource=function(){this._glBuffer||(this._glBuffer=qe._gl.createBuffer()),this.completeCreate()},a.disposeResource=function(){this._glBuffer&&(E.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},t(0,a,"bufferUsage",function(){return this._bufferUsage}),qe._gl=null,qe._bindActive={},qe._bindVertexBuffer=null,qe._enableAtributes=[];var Ze=qe;function qe(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,qe.__super.call(this),qe._gl=E.mainContext}r($e,"laya.webgl.shader.d2.skinAnishader.SkinSV",C);var je=$e;function $e(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,$e.__super.call(this,512,0);var e=8*ce.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*ce.BYTES_PE],this.color=[4,5126,!1,e,4*ce.BYTES_PE]}r(ti,"laya.webgl.shader.d2.value.Color2dSV",C),ti.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)};var Je=ti;function ti(t){ti.__super.call(this,2,0),this.color=[]}r(ii,"laya.webgl.shader.d2.value.FillTextureSV",C),(B=ii.prototype).setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},B.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)};var ei=ii;function ii(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=C._TEXCOORD,ii.__super.call(this,256,0)}r(si,"laya.webgl.shader.d2.value.TextureSV",C),(e=si.prototype).setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},e.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)};var ri=si;function si(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=C._TEXCOORD,si.__super.call(this,1,t=void 0===t?0:t)}r(ni,"laya.webgl.shader.d2.value.PrimitiveSV",C);var ai=ni;function ni(t){this.a_color=null,this.u_pos=[0,0],ni.__super.call(this,4,0),this.position=[2,5126,!1,5*ce.BYTES_PE,0],this.a_color=[3,5126,!1,5*ce.BYTES_PE,2*ce.BYTES_PE]}r(li,"laya.webgl.atlas.AtlasWebGLCanvas",_=k),(i=li.prototype).recreateResource=function(){var t=E.mainContext,e=this._source=t.createTexture(),i=w.curBindTexTarget,r=w.curBindTexValue;w.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&r&&w.bindTexture(t,i,r),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(E.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){var r,s,a;c.isFlash?(this._flashCacheImage||(this._flashCacheImage=K.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h)),r=i.bitmapdata,this._flashCacheImage._image.copyPixels(r,0,0,r.width,r.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)):(r=E.mainContext,s=w.curBindTexTarget,a=w.curBindTexValue,w.bindTexture(r,3553,this._source),c.isConchWebGL?(i!==ConchTextCanvas&&(0<=t-1&&r.texSubImage2DEx(!0,3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2DEx(!0,3553,0,t+1,e,6408,5121,i),0<=e-1&&r.texSubImage2DEx(!0,3553,0,t,e-1,6408,5121,i),e+1<=this._h)&&r.texSubImage2DEx(!0,3553,0,t,e+1,6408,5121,i),r.texSubImage2DEx(!0,3553,0,t,e,6408,5121,i)):(r.pixelStorei(37441,!0),0<=t-1&&r.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&r.texSubImage2D(3553,0,t+1,e,6408,5121,i),0<=e-1&&r.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&r.texSubImage2D(3553,0,t,e+1,6408,5121,i),r.texSubImage2D(3553,0,t,e,6408,5121,i),r.pixelStorei(37441,!1)),s&&a&&w.bindTexture(r,s,a))},i.texSubImage2DPixel=function(t,e,i,r,s){var a=E.mainContext,n=w.curBindTexTarget,h=w.curBindTexValue,s=(w.bindTexture(a,3553,this._source),new Uint8Array(s.data));c.isConchWebGL?a.texSubImage2DEx(!0,3553,0,t,e,i,r,6408,5121,s):(a.pixelStorei(37441,!0),a.texSubImage2D(3553,0,t,e,i,r,6408,5121,s),a.pixelStorei(37441,!1)),n&&h&&w.bindTexture(a,n,h)},t(0,i,"width",_.prototype._$get_width,function(t){this._w=t}),t(0,i,"height",_.prototype._$get_height,function(t){this._h=t});var hi=li;function li(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,li.__super.call(this)}r(_i,"laya.webgl.resource.WebGLCanvas",k),(h=_i.prototype).getCanvas=function(){return this._canvas},h.clear=function(){this._ctx&&this._ctx.clear()},h.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},h._setContext=function(t){this._ctx=t},h.getContext=function(t,e){return this._ctx||(this._ctx=_i._createContext(this))},h.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},h.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},h.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},h.disposeResource=function(){this._source&&!this.iscpuSource&&(E.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},h.createWebGlTexture=function(){var t=E.mainContext,e=(this._canvas,this._source=t.createTexture()),i=(this.iscpuSource=!1,w.curBindTexTarget),r=w.curBindTexValue;w.bindTexture(t,3553,e),t.pixelStorei(37440,this.flipY?1:0),c.isConchWebGL?t.texImage2DEx(_i.premulAlpha,3553,0,6408,6408,5121,this._imgData):(_i.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),_i.premulAlpha&&t.pixelStorei(37441,!1)),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,i&&r&&w.bindTexture(t,i,r)},h.reloadCanvasData=function(){var t=E.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var e=w.curBindTexTarget,i=w.curBindTexValue;w.bindTexture(t,3553,this._source),c.isConchWebGL?t.texImage2DEx(_i.premulAlpha,3553,0,6408,6408,5121,this._imgData):(_i.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),_i.premulAlpha&&t.pixelStorei(37441,!1)),t.pixelStorei(37440,0),e&&i&&w.bindTexture(t,e,i)},h.texSubImage2D=function(t,e,i){var r=E.mainContext,s=w.curBindTexTarget,a=w.curBindTexValue;w.bindTexture(r,3553,this._source),c.isConchWebGL?r.texSubImage2DEx(!0,3553,0,e,i,6408,5121,t._source):(r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,e,i,6408,5121,t._source),r.pixelStorei(37441,!1)),s&&a&&w.bindTexture(r,s,a)},h.toBase64=function(t,e,i){var r=null;this._canvas&&(r=this._canvas.toDataURL(t,e)),i.call(this,r)},t(0,h,"context",function(){return this._ctx}),t(0,h,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),t(0,h,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),_i._createContext=null,_i.premulAlpha=!1;var oi=_i;function _i(){this.flipY=!0,this.alwaysChange=!1,_i.__super.call(this)}r(ci,"laya.webgl.resource.WebGLCharImage",k),$=ci.prototype,g.imps($,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$.active=function(){this.texture.active()},$.recreateResource=function(){var t,e=c.isConchApp;this.onresize(this.cw+2*p.CborderSize,this.ch+2*p.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),e?(e=this.fontSize,1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+"")),t=(t="normal 100 "+this.font).replace(ci._fontSizeReg,e),this.borderColor&&(t+=" 1 "+this.borderColor),this._ctx.font=t,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,p.CborderSize,p.CborderSize,null,null,null)):(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*p.CborderSize,this.ch+2*p.CborderSize),this._ctx.font=this.font,at.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",1!=this.xs||1!=this.ys?this._ctx.setTransform(this.xs,0,0,this.ys,p.CborderSize,p.CborderSize):this._ctx.setTransform(1,0,0,1,p.CborderSize,p.CborderSize),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor||"white",this._ctx.fillText(this.char,0,0)):(this._ctx.strokeStyle=this.borderColor||"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine&&(this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1),e=this._ctx.measureText(this.char).width+1,this._ctx.lineTo(e,this.fontSize+1),this._ctx.stroke()),this._ctx.restore()),this.borderSize=p.CborderSize,this.completeCreate()},$.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},$.clearAtlasSource=function(){},t(0,$,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),t(0,$,"atlasSource",function(){return this.canvas}),t(0,$,"atlasImgData",function(){return!ci.canUseCanvas&&this._ctx.getImageData?this._ctx.getImageData(0,0,this._w,this._h):null}),t(0,$,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),ci.createOneChar=function(t,e){return new ci(t,e)},ci.canUseCanvas=!0,ci._fontSizeReg=new RegExp("\\d+(?=px)","g");var ui=ci;function ci(t,e){ci.__super.call(this),this.char=t,this.isSpace=" "===t,this.xs=e.scaleX,this.ys=e.scaleY,this.font=e.font.toString(),this.fontSize=e.font.size,this.fillColor=e.fillColor,this.borderColor=e.borderColor,this.lineWidth=e.lineWidth,this.underLine=e.underLine;var i,t=c.isConchApp,e=(t?((i=ConchTextCanvas)._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas):i=H.canvas.source,this.canvas=i,this._enableMerageInAtlas=!0,this._ctx=t?i:this.canvas.getContext("2d",void 0),ht.measureText(this.char,this.font));this.cw=e.width*this.xs,this.ch=(e.height||this.fontSize)*this.ys,this.onresize(this.cw+2*p.CborderSize,this.ch+2*p.CborderSize),this.texture=new nt(this)}r(fi,"laya.webgl.resource.WebGLRenderTarget",k),(a=fi.prototype).recreateResource=function(){var t=E.mainContext,e=(this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture()),w.curBindTexTarget),i=w.curBindTexValue,r=(w.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null),this._minFifter),s=this._magFifter,a=this._repeat?10497:33071,n=V.isPOT(this._w,this._h);if(n?(this._mipMap?-1===r&&(r=9987):-1===r&&(r=9729),-1===s&&(s=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this._mipMap&&t.generateMipmap(3553)):(-1===s&&(s=9729),t.texParameteri(3553,10241,r=-1===r?9729:r),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&w.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),n&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},a.disposeResource=function(){this._frameBuffer&&(E.mainContext.deleteTexture(this._source),E.mainContext.deleteFramebuffer(this._frameBuffer),E.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},t(0,a,"depthStencilBuffer",function(){return this._depthStencilBuffer}),t(0,a,"frameBuffer",function(){return this._frameBuffer});var di=fi;function fi(t,e,i,r,s,a,n,h,l){void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===s&&(s=34041),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=1),fi.__super.call(this),this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=s,c.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=a,this._repeat=n,this._minFifter=h,this._magFifter=l}r(pi,"laya.webgl.resource.WebGLSubImage",k),B=pi.prototype,g.imps(B,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),B.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},B.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},B.createWebGlTexture=function(){var t=E.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=w.curBindTexTarget,r=w.curBindTexValue,e=(w.bindTexture(t,3553,e),c.isConchWebGL?t.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1)),this.minFifter),s=this.magFifter,a=this.repeat?10497:33071,n=V.isPOT(this.width,this.height);n?(this.mipmap?-1===e&&(e=9987):-1===e&&(e=9729),t.texParameteri(3553,10240,s=-1===s?9729:s),t.texParameteri(3553,10241,e),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this.mipmap&&t.generateMipmap(3553)):(-1===s&&(s=9729),t.texParameteri(3553,10241,e=-1===e?9729:e),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&r&&w.bindTexture(t,i,r),this.canvas=null,n&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},B.disposeResource=function(){x.enabled&&this._allowMerageInAtlas||!this._source||(E.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},B.clearAtlasSource=function(){},t(0,B,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),t(0,B,"atlasSource",function(){return this.canvas}),t(0,B,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t});var mi=pi;function pi(t,e,i,r,s,a,n){this.offsetX=0,this.offsetY=0,pi.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=a,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=r,this._h=s,this.offsetX=e,this.offsetY=i,this.src=n,this._enableMerageInAtlas=!0,x.enabled&&this._w<x.atlasLimitWidth&&this._h<x.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}r(F,"laya.webgl.shader.Shader",We),(e=F.prototype).recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){E.mainContext.deleteShader(this._vshader),E.mainContext.deleteShader(this._pshader),E.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t=[this._vs,this._ps],e=E.mainContext;if(this._program=e.createProgram(),this._vshader=F._createShader(e,t[0],35633),this._pshader=F._createShader(e,t[1],35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader),e.linkProgram(this._program),!c.isConchApp&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);for(var i,r=0,s=0,s=c.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35721):e.getProgramParameter(this._program,35721),r=0;r<s;r++){var a=null,n={vartype:"attribute",glfun:null,ivartype:0,attrib:a=c.isConchApp?e.getActiveAttribEx(this._vs,this._ps,"",r):e.getActiveAttrib(this._program,r),location:e.getAttribLocation(this._program,a.name),name:a.name,type:a.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0};this._params.push(n)}var h=0,h=c.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35718):e.getProgramParameter(this._program,35718);for(r=0;r<h;r++){var l=null,l=c.isConchApp?e.getActiveUniformEx(this._vs,this._ps,"",r):e.getActiveUniform(this._program,r);0<(n={vartype:"uniform",glfun:null,ivartype:1,attrib:a,location:e.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=e.getUniformLocation(this._program,n.name)),this._params.push(n)}for(r=0,i=this._params.length;r<i;r++)if((n=this._params[r]).indexOfParams=r,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=this._nameMap[n.codename]||n.codename,(this._paramsMap[n.name]=n)._this=this,n.uploadedValue=[],"attribute"===n.vartype)n.fun=this._attribute;else switch(n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.glfun=e.uniformMatrix4fv,n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._attribute=function(t,e){var i=E.mainContext,r=Ze._enableAtributes,t=t.location;return r[t]||i.enableVertexAttribArray(t),i.vertexAttribPointer(t,e[0],e[1],e[2],e[3],e[4]+this._offset),r[t]=Ze._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(E.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){var i;return e.length<4?(i=t.uploadedValue)[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(E.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0:(E.mainContext.uniform1fv(t.location,e),1)},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(E.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){var i;return e.length<2?(i=t.uploadedValue)[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(E.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0:(E.mainContext.uniform2fv(t.location,e),1)},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(E.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return E.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(E.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return E.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return E.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return E.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return E.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(E.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return E.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(E.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return E.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(E.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return E.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(E.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return E.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=E.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(F._TEXTURES[this._curActTexIndex]),w.bindTexture(i,3553,e),this._curActTexIndex++,1):(i.activeTexture(F._TEXTURES[r[0]]),w.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=E.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(F._TEXTURES[this._curActTexIndex]),w.bindTexture(i,34067,e),this._curActTexIndex++,1):(i.activeTexture(F._TEXTURES[r[0]]),w.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){this.activeResource(),w.UseProgram(this._program);t=this._paramsMap[t];t.fun.call(this,t,e)},e.uploadTexture2D=function(t){it.shaderCall++;var e=E.mainContext;e.activeTexture(33984),w.bindTexture(e,3553,t)},e.upload=function(t,e){(We.activeShader=We.bindShader=this)._lastUseFrameCount!==it.loopCount&&this.activeResource(),w.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;E.mainContext;for(var i,r,s=e.length,a=0,n=0;n<s;n++)null!==(r=t[(i=e[n]).name])&&(a+=i.fun.call(this,i,r));it.shaderCall+=a},e.uploadArray=function(t,e,i){We.activeShader=this,(We.bindShader=this).activeResource(),w.UseProgram(this._program);this._params;for(var r,s,a=0,n=e-2;0<=n;n-=2)(s=this._paramsMap[t[n]])&&null!=(r=t[n+1])&&(i&&i[s.name]&&i[s.name].bind(),a+=s.fun.call(this,s,r));it.shaderCall+=a},e.getParams=function(){return this._params},F.getShader=function(t){return F.sharders[t]},F.create=function(t,e,i,r){return new F(t,e,i,r)},F.withCompile=function(t,e,i,r){if(i&&F.sharders[i])return F.sharders[i];var s=F._preCompileShader[2e-4*t];if(s)return s.createShader(e,i,r);throw new Error("withCompile shader err!"+t)},F.withCompile2D=function(t,e,i,r,s){if(r&&F.sharders[r])return F.sharders[r];var a=F._preCompileShader[2e-4*t+e];if(a)return a.createShader(i,r,s);throw new Error("withCompile shader err!"+t+" "+e)},F.addInclude=function(t,e){be.addInclude(t,e)},F.preCompile=function(t,e,i,r){t*=2e-4;F._preCompileShader[t]=new be(t,e,i,r)},F.preCompile2D=function(t,e,i,r,s){t=2e-4*t+e;F._preCompileShader[t]=new be(t,i,r,s)},F._createShader=function(t,e,i){i=t.createShader(i);return t.shaderSource(i,e),t.compileShader(i),i},F._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],F._count=0,F._preCompileShader={},F.SHADERNAME2ID=2e-4,F.sharders=(F.sharders=[],F.sharders.length=32,F.sharders),N(F,["nameKey",function(){return this.nameKey=new rt}]);var D=F;function F(t,e,i,r){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,F.__super.call(this),!t||!e)throw"Shader Error";this._id=++F._count,this._vs=t,this._ps=e,this._nameMap=r||{},null!=i&&(F.sharders[i]=this)}r(bi,"laya.webgl.utils.Buffer2D",gi=Ze),(i=bi.prototype).needSize=function(t){var e=this._byteLength;return t&&((t=this._byteLength+t)<=this._buffer.byteLength||this._resizeBuffer(t<<1,!0),this._byteLength=t),e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),it.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ze._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Ze._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),it.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Ze._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i?(e=this._buffer.slice(e,i),Ze._gl.bufferSubData(this._bufferType,t,e)):Ze._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){return t<this._buffer.byteLength||(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength?(e=new ArrayBuffer(t),new Uint8Array(e).set(new Uint8Array(this._buffer),0),this._buffer=e):this._buffer=new ArrayBuffer(t),this._checkArrayUse(),this._upload=!0),this},i.append=function(t){this._upload=!0;var e,i=t.byteLength;t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+i,!0),e=new Float32Array(this._buffer,this._byteLength)),e.set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),r=0;r<e;r++)i[r]=t[r];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i=t.byteLength;this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,r){void 0===r&&(r=1),this._upload=!0;this._resizeBuffer(this._byteLength+(r=i*r),!0);for(var s=new e(this._buffer,this._byteLength),a=0,a=0;a<i;a++)s[a]=t[a];this._byteLength+=r,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Ze._gl.bindBuffer(this._bufferType,null),Ze._bindActive[this._bufferType]=null,We.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);t=this._bind_subUpload();return Ze._gl.bindBuffer(this._bufferType,null),Ze._bindActive[this._bufferType]=null,We.activeShader=null,t},i.disposeResource=function(){gi.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},t(0,i,"bufferLength",function(){return this._buffer.byteLength}),t(0,i,"byteLength",null,function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),bi.__int__=function(t){Ii.QuadrangleIB=Ii.create(35044),T.fillIBQuadrangle(Ii.QuadrangleIB,16)},bi.FLOAT32=4,bi.SHORT=2;var gi,xi=bi;function bi(){this._maxsize=0,this._upload=!0,this._uploadSize=0,bi.__super.call(this),this.lock=!0}var vi;r(yi,"laya.webgl.shader.d2.value.GlowSV",vi=ri),(_=yi.prototype).setValue=function(t){vi.prototype.setValue.call(this,t)},_.clear=function(){vi.prototype.clear.call(this)};function yi(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,yi.__super.call(this,9)}r(Ei,"laya.webgl.shader.d2.value.TextSV",Ti=ri),(h=Ei.prototype).release=function(){(Ei.pool[Ei._length++]=this).clear()},h.clear=function(){Ti.prototype.clear.call(this)},Ei.create=function(){return Ei._length?Ei.pool[--Ei._length]:new Ei},Ei.pool=[],Ei._length=0;var Ti,Ai=Ei;function Ei(t){Ei.__super.call(this,64),this.defines.add(64)}r(Ri,"laya.webgl.shader.d2.Shader2X",Si=D),($=Ri.prototype).upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},$._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)t=e[i],(c.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},$.disposeResource=function(){Si.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},$._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)t=e[i],!c.isFlash&&"size"===t.name||this._params2dQuick2.push(t)}return this._params2dQuick2},Ri.create=function(t,e,i,r){return new Ri(t,e,i,r)};var Si,wi=Ri;function Ri(t,e,i,r){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,Ri.__super.call(this,t,e,i,r)}r(Mi,"laya.webgl.utils.IndexBuffer2D",xi),(a=Mi.prototype)._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},a.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},a.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},a.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},Mi.QuadrangleIB=null,Mi.create=function(t){return new Mi(t=void 0===t?35044:t)};var Ii=Mi;function Mi(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),Mi.__super.call(this),this._bufferUsage=t,this._bufferType=34963,c.isFlash||(this._buffer=new ArrayBuffer(8))}r(Pi,"laya.webgl.utils.VertexBuffer2D",Ci=xi),(k=Pi.prototype).getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},k.bind=function(t){t&&t._bind(),this._bind()},k.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},k.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},k._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},k.disposeResource=function(){Ci.prototype.disposeResource.call(this)},k.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},t(0,k,"vertexStride",function(){return this._vertexStride}),Pi.create=function(t,e){return new Pi(t,e=void 0===e?35048:e)};var Ci,Li=Pi;function Pi(t,e){this._floatArray32=null,this._vertexStride=0,Pi.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,c.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}r(Fi,"laya.webgl.resource.WebGLImage",K),B=Fi.prototype,g.imps(B,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),B._init_=function(t,e){},B._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=E.mainContext,e=this._source=t.createTexture(),i=w.curBindTexTarget,r=w.curBindTexValue;if(w.bindTexture(t,3553,e),c.isConchWebGL)switch(this._format){case 6408:t.texImage2DEx(!0,3553,0,this._format,6408,5121,this._image);break;case E.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(t.pixelStorei(37441,!0),this._format){case 6408:t.texImage2D(3553,0,this._format,6408,5121,this._image);break;case E.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}t.pixelStorei(37441,!1)}var e=this.minFifter,s=this.magFifter,a=this.repeat?10497:33071,n=V.isPOT(this._w,this._h);n?(this.mipmap?-1===e&&(e=9987):-1===e&&(e=9729),-1===s&&(s=9729),t.texParameteri(3553,10241,e),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this.mipmap&&t.generateMipmap(3553)):(-1===s&&(s=9729),t.texParameteri(3553,10241,e=-1===e?9729:e),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&r&&w.bindTexture(t,i,r),this._image.onload=null,this._image=null,n&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},B.recreateResource=function(){var t,e=this;null!=this._src&&""!==this._src&&(this._needReleaseAgain=!1,this._image?this._recreateLock||(this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()):(this._recreateLock=!0,(t=this)._image=new H.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){t._needReleaseAgain?(t._needReleaseAgain=!1,t._image.onload=null,t._image=null):(t._allowMerageInAtlas&&t._enableMerageInAtlas?(e.memorySize=0,e._recreateLock=!1):t._createWebGlTexture(),t.completeCreate())},this._image.src=this._src))},B.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(E.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},B.onresize=function(){this._w=this._image.width,this._h=this._image.height,x.enabled&&this._w<x.atlasLimitWidth&&this._h<x.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},B.clearAtlasSource=function(){this._image=null},t(0,B,"format",function(){return this._format}),t(0,B,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(t){this._$5__enableMerageInAtlas=t}),t(0,B,"mipmap",function(){return this._mipmap}),t(0,B,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),t(0,B,"atlasSource",function(){return this._image}),t(0,B,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),t(0,B,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)});var B,Di=Fi;function Fi(t,e,i,r){this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===i&&(i=6408),void 0===r&&(r=!0),Fi.__super.call(this,t,e),this._format=i,this._mipmap=r,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t?(this._url=t,this._src=t,this._image=new H.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate)&&e.onCreate(this),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t)):t instanceof ArrayBuffer?(this._src=e,this._url=this._src,(i=new G(t)).readUTFBytes(4),i.readUTFBytes(2),i.getInt16(),i.endian="bigEndian",this._w=i.getInt16(),this._h=i.getInt16(),i.getInt16(),i.getInt16(),this._image=new Uint8Array(t,i.pos),this._format=E.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,x.enabled&&this._w<x.atlasLimitWidth&&this._h<x.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1):(this._src=e,this._url=this._src,this._image=t.source||t,this.onresize()),this._$5__enableMerageInAtlas=!0}g.__init([oe,dt,Ae,be])}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var r=Laya[i];r&&r.__isclass&&(e[i]=r)}});