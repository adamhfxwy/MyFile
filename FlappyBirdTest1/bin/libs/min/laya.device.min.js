!function(a){a.un,a.uns;var e=a.static,t=a.class,n=a.getset,i=(a.__newvec,laya.resource.Bitmap),s=laya.utils.Browser,o=(laya.events.Event,laya.events.EventDispatcher),r=(laya.utils.Handler,laya.maths.Rectangle,laya.renders.Render),l=laya.display.Sprite,d=(laya.display.Stage,laya.resource.Texture),c=laya.utils.Utils,h=laya.webgl.WebGL,u=laya.webgl.WebGLContext;t(v,"laya.device.geolocation.Geolocation"),v.getCurrentPosition=function(t,n){v.navigator.geolocation.getCurrentPosition(function(e){v.position.setPosition(e),t.runWith(v.position)},function(e){n.runWith(e)},{enableHighAccuracy:laya.device.geolocation.Geolocation.enableHighAccuracy,timeout:laya.device.geolocation.Geolocation.timeout,maximumAge:laya.device.geolocation.Geolocation.maximumAge})},v.watchPosition=function(t,n){return v.navigator.geolocation.watchPosition(function(e){v.position.setPosition(e),t.runWith(v.position)},function(e){n.runWith(e)},{enableHighAccuracy:v.enableHighAccuracy,timeout:v.timeout,maximumAge:v.maximumAge})},v.clearWatch=function(e){v.navigator.geolocation.clearWatch(e)},v.PERMISSION_DENIED=1,v.POSITION_UNAVAILABLE=2,v.TIMEOUT=3,v.enableHighAccuracy=!1,v.maximumAge=0,e(v,["navigator",function(){return this.navigator=s.window.navigator},"position",function(){return this.position=new m},"supported",function(){return this.supported=!!v.navigator.geolocation},"timeout",function(){return this.timeout=1e10}]);function v(){}t(g,"laya.device.geolocation.GeolocationInfo"),(f=g.prototype).setPosition=function(e){this.pos=e,this.coords=e.coords},n(0,f,"heading",function(){return this.coords.heading}),n(0,f,"latitude",function(){return this.coords.latitude}),n(0,f,"altitudeAccuracy",function(){return this.coords.altitudeAccuracy}),n(0,f,"longitude",function(){return this.coords.longitude}),n(0,f,"altitude",function(){return this.coords.altitude}),n(0,f,"accuracy",function(){return this.coords.accuracy}),n(0,f,"speed",function(){return this.coords.speed}),n(0,f,"timestamp",function(){return this.pos.timestamp});var m=g;function g(){this.pos=null,this.coords=null}t(p,"laya.device.media.Media"),p.supported=function(){return!!s.window.navigator.getUserMedia},p.getMedia=function(e,t,n){s.window.navigator.getUserMedia&&s.window.navigator.getUserMedia(e,function(e){t.runWith(s.window.URL.createObjectURL(e))},function(e){n.runWith(e)})},p.__init$=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia};var f=p;function p(){}t(E,"laya.device.motion.AccelerationInfo");var y=E;function E(){this.x=NaN,this.y=NaN,this.z=NaN}t(w,"laya.device.motion.RotationInfo");var L=w;function w(){this.absolute=!1,this.alpha=NaN,this.beta=NaN,this.gamma=NaN,this.compassAccuracy=NaN}t(b,"laya.device.motion.Accelerator",x=o),(P=b.prototype).on=function(e,t,n,i){return x.prototype.on.call(this,e,t,n,i),s.window.addEventListener("devicemotion",this.onDeviceOrientationChange),this},P.off=function(e,t,n,i){return void 0===i&&(i=!1),this.hasListener(e)||s.window.removeEventListener("devicemotion",this.onDeviceOrientationChange),x.prototype.off.call(this,e,t,n,i)},P.onDeviceOrientationChange=function(e){var t=e.interval;b.acceleration.x=e.acceleration.x,b.acceleration.y=e.acceleration.y,b.acceleration.z=e.acceleration.z,b.accelerationIncludingGravity.x=e.accelerationIncludingGravity.x,b.accelerationIncludingGravity.y=e.accelerationIncludingGravity.y,b.accelerationIncludingGravity.z=e.accelerationIncludingGravity.z,b.rotationRate.alpha=-1*e.rotationRate.gamma,b.rotationRate.beta=-1*e.rotationRate.alpha,b.rotationRate.gamma=e.rotationRate.beta,s.onAndroid?(b.onChrome&&(b.rotationRate.alpha*=180/Math.PI,b.rotationRate.beta*=180/Math.PI,b.rotationRate.gamma*=180/Math.PI),b.acceleration.x*=-1,b.accelerationIncludingGravity.x*=-1):s.onIOS&&(b.acceleration.y*=-1,b.acceleration.z*=-1,b.accelerationIncludingGravity.y*=-1,b.accelerationIncludingGravity.z*=-1,t*=1e3),this.event("change",[b.acceleration,b.accelerationIncludingGravity,b.rotationRate,t])},n(1,b,"instance",function(){return b._instance=b._instance||new b},laya.events.EventDispatcher._$SET_instance),b.getTransformedAcceleration=function(e){(b.transformedAcceleration=b.transformedAcceleration||new y).z=e.z,90==s.window.orientation?(b.transformedAcceleration.x=e.y,b.transformedAcceleration.y=-e.x):-90==s.window.orientation?(b.transformedAcceleration.x=-e.y,b.transformedAcceleration.y=e.x):s.window.orientation?180==s.window.orientation&&(b.transformedAcceleration.x=-e.x,b.transformedAcceleration.y=-e.y):(b.transformedAcceleration.x=e.x,b.transformedAcceleration.y=e.y);e=NaN;return-90==a.stage.canvasDegree?(e=b.transformedAcceleration.x,b.transformedAcceleration.x=-b.transformedAcceleration.y,b.transformedAcceleration.y=e):90==a.stage.canvasDegree&&(e=b.transformedAcceleration.x,b.transformedAcceleration.x=b.transformedAcceleration.y,b.transformedAcceleration.y=-e),b.transformedAcceleration},b._instance=null,b.transformedAcceleration=null,e(b,["acceleration",function(){return this.acceleration=new y},"accelerationIncludingGravity",function(){return this.accelerationIncludingGravity=new y},"rotationRate",function(){return this.rotationRate=new L},"onChrome",function(){return this.onChrome=-1<s.userAgent.indexOf("Chrome")}]);var x,T=b;function b(e){b.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}var _;t(A,"laya.device.motion.Gyroscope",_=o),(P=A.prototype).on=function(e,t,n,i){return _.prototype.on.call(this,e,t,n,i),s.window.addEventListener("deviceorientation",this.onDeviceOrientationChange),this},P.off=function(e,t,n,i){return void 0===i&&(i=!1),this.hasListener(e)||s.window.removeEventListener("deviceorientation",this.onDeviceOrientationChange),_.prototype.off.call(this,e,t,n,i)},P.onDeviceOrientationChange=function(e){A.info.alpha=e.alpha,A.info.beta=e.beta,A.info.gamma=e.gamma,e.webkitCompassHeading&&(A.info.alpha=-1*e.webkitCompassHeading,A.info.compassAccuracy=e.webkitCompassAccuracy),this.event("change",[e.absolute,A.info])},n(1,A,"instance",function(){return A._instance=A._instance||new A},laya.events.EventDispatcher._$SET_instance),A._instance=null,e(A,["info",function(){return this.info=new L}]);function A(e){A.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}var P;t(S,"laya.device.Shake",o),(P=S.prototype).start=function(e,t){this.throushold=e,this.shakeInterval=t,this.lastX=this.lastY=this.lastZ=NaN,T.instance.on("change",this,this.onShake)},P.stop=function(){T.instance.off("change",this,this.onShake)},P.onShake=function(e,t,n,i){var a,o,r;isNaN(this.lastX)?(this.lastX=t.x,this.lastY=t.y,this.lastZ=t.z,this.lastMillSecond=s.now()):(a=Math.abs(this.lastX-t.x),o=Math.abs(this.lastY-t.y),r=Math.abs(this.lastZ-t.z),this.isShaked(a,o,r)&&s.now()-this.lastMillSecond>this.shakeInterval&&(this.event("change"),this.lastMillSecond=s.now()),this.lastX=t.x,this.lastY=t.y,this.lastZ=t.z)},P.isShaked=function(e,t,n){return e>this.throushold&&t>this.throushold||e>this.throushold&&n>this.throushold||t>this.throushold&&n>this.throushold},n(1,S,"instance",function(){return S._instance=S._instance||new S},laya.events.EventDispatcher._$SET_instance),S._instance=null;function S(){this.throushold=0,this.shakeInterval=0,this.callback=null,this.lastX=NaN,this.lastY=NaN,this.lastZ=NaN,this.lastMillSecond=NaN,S.__super.call(this)}t(N,"laya.device.media.Video",C=l),(e=N.prototype).onPlayComplete=function(e){a.timer.clear(this,this.renderCanvas),this.event("ended")},e.load=function(e){0==e.indexOf("blob:")?this.videoElement.src=e:this.htmlVideo.setSource(e,laya.device.media.Video.MP4)},e.play=function(){this.videoElement.play(),a.timer.frameLoop(1,this,this.renderCanvas)},e.pause=function(){this.videoElement.pause(),a.timer.clear(this,this.renderCanvas)},e.reload=function(){this.videoElement.load()},e.canPlayType=function(e){var t;switch(e){case laya.device.media.Video.MP4:t="video/mp4";break;case laya.device.media.Video.OGG:t="video/ogg";break;case laya.device.media.Video.WEBM:t="video/webm"}return this.videoElement.canPlayType(t)},e.renderCanvas=function(){0!==this.readyState&&(r.isWebGL&&this.htmlVideo.updateTexture(),this.graphics.clear(),this.graphics.drawTexture(this.internalTexture,0,0,this.width,this.height))},e.onDocumentClick=function(){this.videoElement.play(),this.videoElement.pause(),s.document.removeEventListener("touchend",this.onDocumentClick)},e.size=function(e,t){return C.prototype.size.call(this,e,t),this.videoElement.width=e/s.pixelRatio,this.paused&&this.renderCanvas(),this},e.destroy=function(e){C.prototype.destroy.call(this,e=void 0===e?!0:e),this.videoElement.removeEventListener("abort",N.onAbort),this.videoElement.removeEventListener("canplay",N.onCanplay),this.videoElement.removeEventListener("canplaythrough",N.onCanplaythrough),this.videoElement.removeEventListener("durationchange",N.onDurationchange),this.videoElement.removeEventListener("emptied",N.onEmptied),this.videoElement.removeEventListener("error",N.onError),this.videoElement.removeEventListener("loadeddata",N.onLoadeddata),this.videoElement.removeEventListener("loadedmetadata",N.onLoadedmetadata),this.videoElement.removeEventListener("loadstart",N.onLoadstart),this.videoElement.removeEventListener("pause",N.onPause),this.videoElement.removeEventListener("play",N.onPlay),this.videoElement.removeEventListener("playing",N.onPlaying),this.videoElement.removeEventListener("progress",N.onProgress),this.videoElement.removeEventListener("ratechange",N.onRatechange),this.videoElement.removeEventListener("seeked",N.onSeeked),this.videoElement.removeEventListener("seeking",N.onSeeking),this.videoElement.removeEventListener("stalled",N.onStalled),this.videoElement.removeEventListener("suspend",N.onSuspend),this.videoElement.removeEventListener("timeupdate",N.onTimeupdate),this.videoElement.removeEventListener("volumechange",N.onVolumechange),this.videoElement.removeEventListener("waiting",N.onWaiting),this.videoElement.removeEventListener("ended",this.onPlayComplete),this.pause(),this.videoElement=null},e.syncVideoPosition=function(){var e=a.stage,t=c.getGlobalPosAndScale(this),n=e._canvasTransform.a,i=e._canvasTransform.d,n=t.x*e.clientScaleX*n+e.offset.x,t=t.y*e.clientScaleY*i+e.offset.y;this.videoElement.style.left=n+"px",this.videoElement.style.top=t+"px",this.videoElement.width=this.width/s.pixelRatio,this.videoElement.height=this.height/s.pixelRatio},n(0,e,"buffered",function(){return this.videoElement.buffered}),n(0,e,"videoWidth",function(){return this.videoElement.videoWidth}),n(0,e,"currentSrc",function(){return this.videoElement.currentSrc}),n(0,e,"currentTime",function(){return this.videoElement.currentTime},function(e){this.videoElement.currentTime=e,this.renderCanvas()}),n(0,e,"ended",function(){return this.videoElement.ended}),n(0,e,"volume",function(){return this.videoElement.volume},function(e){this.videoElement.volume=e}),n(0,e,"videoHeight",function(){return this.videoElement.videoHeight}),n(0,e,"readyState",function(){return this.videoElement.readyState}),n(0,e,"duration",function(){return this.videoElement.duration}),n(0,e,"error",function(){return this.videoElement.error}),n(0,e,"loop",function(){return this.videoElement.loop},function(e){this.videoElement.loop=e}),n(0,e,"playbackRate",function(){return this.videoElement.playbackRate},function(e){this.videoElement.playbackRate=e}),n(0,e,"muted",function(){return this.videoElement.muted},function(e){this.videoElement.muted=e}),n(0,e,"paused",function(){return this.videoElement.paused}),n(0,e,"preload",function(){return this.videoElement.preload},function(e){this.videoElement.preload=e}),n(0,e,"seekable",function(){return this.videoElement.seekable}),n(0,e,"seeking",function(){return this.videoElement.seeking}),n(0,e,"height",C.prototype._$get_height,function(e){a.superSet(l,this,"height",e),this.paused&&this.renderCanvas()}),n(0,e,"width",C.prototype._$get_width,function(e){this.videoElement.width=this.width/s.pixelRatio,a.superSet(l,this,"width",e),this.paused&&this.renderCanvas()}),N.onAbort=function(e){e.target.layaTarget.event("abort")},N.onCanplay=function(e){e.target.layaTarget.event("canplay")},N.onCanplaythrough=function(e){e.target.layaTarget.event("canplaythrough")},N.onDurationchange=function(e){e.target.layaTarget.event("durationchange")},N.onEmptied=function(e){e.target.layaTarget.event("emptied")},N.onError=function(e){e.target.layaTarget.event("error")},N.onLoadeddata=function(e){e.target.layaTarget.event("loadeddata")},N.onLoadedmetadata=function(e){e.target.layaTarget.event("loadedmetadata")},N.onLoadstart=function(e){e.target.layaTarget.event("loadstart")},N.onPause=function(e){e.target.layaTarget.event("pause")},N.onPlay=function(e){e.target.layaTarget.event("play")},N.onPlaying=function(e){e.target.layaTarget.event("playing")},N.onProgress=function(e){e.target.layaTarget.event("progress")},N.onRatechange=function(e){e.target.layaTarget.event("ratechange")},N.onSeeked=function(e){e.target.layaTarget.event("seeked")},N.onSeeking=function(e){e.target.layaTarget.event("seeking")},N.onStalled=function(e){e.target.layaTarget.event("stalled")},N.onSuspend=function(e){e.target.layaTarget.event("suspend")},N.onTimeupdate=function(e){e.target.layaTarget.event("timeupdate")},N.onVolumechange=function(e){e.target.layaTarget.event("volumechange")},N.onWaiting=function(e){e.target.layaTarget.event("waiting")},N.MP4=1,N.OGG=2,N.CAMERA=4,N.WEBM=8,N.SUPPORT_PROBABLY="probably",N.SUPPORT_MAYBY="maybe",N.SUPPORT_NO="";var C,k=N;function N(e,t){this.htmlVideo=null,this.videoElement=null,this.internalTexture=null,void 0===e&&(e=320),void 0===t&&(t=240),N.__super.call(this),r.isWebGL?this.htmlVideo=new I:this.htmlVideo=new R,this.videoElement=this.htmlVideo.getVideo(),(this.videoElement.layaTarget=this).internalTexture=new d(this.htmlVideo),this.videoElement.addEventListener("abort",N.onAbort),this.videoElement.addEventListener("canplay",N.onCanplay),this.videoElement.addEventListener("canplaythrough",N.onCanplaythrough),this.videoElement.addEventListener("durationchange",N.onDurationchange),this.videoElement.addEventListener("emptied",N.onEmptied),this.videoElement.addEventListener("error",N.onError),this.videoElement.addEventListener("loadeddata",N.onLoadeddata),this.videoElement.addEventListener("loadedmetadata",N.onLoadedmetadata),this.videoElement.addEventListener("loadstart",N.onLoadstart),this.videoElement.addEventListener("pause",N.onPause),this.videoElement.addEventListener("play",N.onPlay),this.videoElement.addEventListener("playing",N.onPlaying),this.videoElement.addEventListener("progress",N.onProgress),this.videoElement.addEventListener("ratechange",N.onRatechange),this.videoElement.addEventListener("seeked",N.onSeeked),this.videoElement.addEventListener("seeking",N.onSeeking),this.videoElement.addEventListener("stalled",N.onStalled),this.videoElement.addEventListener("suspend",N.onSuspend),this.videoElement.addEventListener("timeupdate",N.onTimeupdate),this.videoElement.addEventListener("volumechange",N.onVolumechange),this.videoElement.addEventListener("waiting",N.onWaiting),this.videoElement.addEventListener("ended",this.onPlayComplete.bind(this)),this.size(e,t),s.onMobile&&(this.onDocumentClick=this.onDocumentClick.bind(this),s.document.addEventListener("touchend",this.onDocumentClick))}t(G,"laya.device.media.HtmlVideo",i),(o=G.prototype).createDomElement=function(){var e=this,t=(this._source=this.video=s.createElement("video"),this.video.style);t.position="absolute",t.top="0px",t.left="0px",this.video.addEventListener("loadedmetadata",function(){this._w=e.video.videoWidth,this._h=e.video.videoHeight}.bind(this))},o.setSource=function(e,t){for(;this.video.childElementCount;)this.video.firstChild.remove();t&k.MP4&&this.appendSource(e,"video/mp4"),t&k.OGG&&this.appendSource(e+".ogg","video/ogg")},o.appendSource=function(e,t){var n=s.createElement("source");n.src=e,n.type=t,this.video.appendChild(n)},o.getVideo=function(){return this.video},G.create=function(){return new G};var R=G;function G(){this.video=null,G.__super.call(this),this._w=1,this._h=1,this.createDomElement()}t(M,"laya.device.media.WebGLVideo",R),M.prototype.updateTexture=function(){s.onIPhone||(u.bindTexture(this.gl,3553,this._source),this.gl.texImage2D(3553,0,6407,6407,5121,this.video))};var I=M;function M(){this.gl=null,this.preTarget=null,this.preTexture=null,M.__super.call(this),s.onIPhone||(this.gl=h.mainContext,this._source=this.gl.createTexture(),this.preTarget=u.curBindTexTarget,this.preTexture=u.curBindTexValue,u.bindTexture(this.gl,3553,this._source),this.gl.texParameteri(3553,10242,33071),this.gl.texParameteri(3553,10243,33071),this.gl.texParameteri(3553,10240,9729),this.gl.texParameteri(3553,10241,9729),this.preTarget&&this.preTexture&&u.bindTexture(this.gl,this.preTarget,this.preTexture))}a.__init([f])}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var n in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var i=Laya[n];i&&i.__isclass&&(t[n]=i)}});