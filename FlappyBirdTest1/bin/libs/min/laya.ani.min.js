!function(F){F.un,F.uns;var t=F.static,e=F.class,i=F.getset,S=F.__newvec,w=laya.maths.Bezier,U=laya.utils.Browser,At=laya.utils.Byte,a=(laya.events.Event,laya.events.EventDispatcher),s=laya.display.Graphics,L=laya.resource.HTMLCanvas,l=laya.utils.Handler,r=laya.net.Loader,R=laya.maths.MathUtil,Tt=laya.maths.Matrix,O=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle),o=laya.renders.Render,n=(laya.renders.RenderContext,laya.resource.Resource),E=laya.utils.RunDriver,u=(laya.media.SoundChannel,laya.media.SoundManager),k=laya.display.Sprite,V=laya.utils.Stat,Ct=laya.resource.Texture,K=(laya.net.URL,laya.utils.Utils),Y=(e(W,"laya.ani.AnimationContent"),W);function W(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}e(z,"laya.ani.AnimationNodeContent");var X=z;function z(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}e(G,"laya.ani.AnimationParser01"),G.parse=function(t,e){var i,a=e.__getBuffer(),s=0,r=0,n=0,h=0,l=0,o=0,u=0,c=e.readUTFString(),d=(t._aniClassName=c,e.readUTFString().split("\n")),_=e.getUint8(),c=e.getUint32(),p=e.getUint32(),f=(0<c&&(i=a.slice(c,p)),new At(i));for(0<p&&(t._publicExtData=a.slice(p,a.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=_,s=0;s<_;s++)for(var m=t._anis[s]=new Y,y=(m.nodes=new Array,m.name=d[e.getUint16()]),x=(t._aniMap[y]=s,m.bone3DMap={},m.playTime=e.getFloat32(),m.nodes.length=e.getUint8()),r=m.totalKeyframeDatasLength=0;r<x;r++){var g=m.nodes[r]=new X,v=(g.childs=[],e.getInt16()),v=(0<=v&&(g.name=d[v],m.bone3DMap[g.name]=r),g.keyFrame=new Array,g.parentIndex=e.getInt16(),-1==g.parentIndex?g.parent=null:g.parent=m.nodes[g.parentIndex],g.lerpType=e.getUint8(),e.getUint32()),M=(f.pos=v,g.keyframeWidth=f.getUint16());if(m.totalKeyframeDatasLength+=M,0===g.lerpType||1===g.lerpType)for(g.interpolationMethod=[],g.interpolationMethod.length=M,n=0;n<M;n++)g.interpolationMethod[n]=Mt.interpolation[f.getUint8()];null!=g.parent&&g.parent.childs.push(g);for(var D,v=e.getUint16(),v=(0<v&&(g.extenData=a.slice(e.pos,e.pos+v),e.pos+=v),e.getUint16()),I=0,n=0,h=g.keyFrame.length=v;n<h;n++){if((D=g.keyFrame[n]=new ft).duration=e.getFloat32(),D.startTime=I,2===g.lerpType){D.interpolationData=[];var b,N=e.getUint8();switch(b=e.getFloat32()){case 254:for(D.interpolationData.length=M,u=0;u<M;u++)D.interpolationData[u]=0;break;case 255:for(D.interpolationData.length=M,u=0;u<M;u++)D.interpolationData[u]=5;break;default:for(D.interpolationData.push(b),o=1;o<N;o++)D.interpolationData.push(e.getFloat32())}}for(D.data=new Float32Array(M),l=0;l<M;l++)D.data[l]=e.getFloat32(),-1e-8<D.data[l]&&D.data[l]<1e-8&&(D.data[l]=0);I+=D.duration}D.startTime=m.playTime,g.playTime=m.playTime,t._calculateKeyFrame(g,v,M)}};var q=G;function G(){}e(x,"laya.ani.AnimationParser02"),x.READ_DATA=function(){x._DATA.offset=x._reader.getUint32(),x._DATA.size=x._reader.getUint32()},x.READ_BLOCK=function(){for(var t=x._BLOCK.count=x._reader.getUint16(),e=x._BLOCK.blockStarts=[],i=x._BLOCK.blockLengths=[],a=0;a<t;a++)e.push(x._reader.getUint32()),i.push(x._reader.getUint32())},x.READ_STRINGS=function(){var t=x._reader.getUint32(),e=x._reader.getUint16(),i=x._reader.pos;x._reader.pos=t+x._DATA.offset;for(var a=0;a<e;a++)x._strings[a]=x._reader.readUTFString();x._reader.pos=i},x.parse=function(t,e){x._templet=t;(x._reader=e).__getBuffer();x.READ_DATA(),x.READ_BLOCK(),x.READ_STRINGS();for(var i=0,a=x._BLOCK.count;i<a;i++){var s=e.getUint16(),r=x._strings[s],n=x["READ_"+r];if(null==n)throw new Error("model file err,no this function:"+s+" "+r);n.call()}},x.READ_ANIMATIONS=function(){var t=x._reader,e=t.__getBuffer(),i=0,a=0,s=0,r=0,n=t.getUint16(),h=[];for(h.length=n,i=0;i<n;i++)h[i]=Mt.interpolation[t.getByte()];var l=t.getUint8();for(x._templet._anis.length=l,i=0;i<l;i++)for(var o=x._templet._anis[i]={},u=(o.nodes=new Array,o.name=x._strings[t.getUint16()]),c=(x._templet._aniMap[u]=i,o.bone3DMap={},o.playTime=t.getFloat32(),o.nodes.length=t.getInt16()),a=o.totalKeyframeDatasLength=0;a<c;a++){for(var d=o.nodes[a]={},_=(d.keyframeWidth=n,d.childs=[],t.getUint16()),_=(0<=_&&(d.name=x._strings[_],o.bone3DMap[d.name]=a),d.keyFrame=new Array,d.parentIndex=t.getInt16(),-1==d.parentIndex?d.parent=null:d.parent=o.nodes[d.parentIndex],o.totalKeyframeDatasLength+=n,d.interpolationMethod=h,null!=d.parent&&d.parent.childs.push(d),t.getUint16()),p=null,f=null,s=0,r=d.keyFrame.length=_;s<r;s++){(p=d.keyFrame[s]={}).startTime=t.getFloat32(),f&&(f.duration=p.startTime-f.startTime);var m=x._DATA.offset,y=t.getUint32(),m=e.slice(m+y,m+y+4*n);p.data=new Float32Array(m),f=p}p.duration=0,d.playTime=o.playTime,x._templet._calculateKeyFrame(d,_,n)}},x._templet=null,x._reader=null,x._strings=[],t(x,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]);var H=x;function x(){}e(h,"laya.ani.AnimationState"),h.stopped=0,h.paused=1,h.playing=2;function h(){}e(c,"laya.ani.bone.Bone"),(_=c.prototype).setTempMatrix=function(t){this._tempMatrix=t;for(var e=0,e=0,i=this._children.length;e<i;e++)this._children[e].setTempMatrix(this._tempMatrix)},_.update=function(t){this.rotation=this.transform.skX,t?(s=this.resultTransform.getMatrix(),Tt.mul(s,t,this.resultMatrix),this.resultRotation=this.rotation):(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone?this.inheritRotation&&this.inheritScale?(s=this.resultTransform.getMatrix(),Tt.mul(s,this.parentBone.resultMatrix,this.resultMatrix)):(t=this.parentBone,a=i=e=NaN,n=this.parentBone.resultMatrix,s=this.resultTransform.getMatrix(),r=n.a*s.tx+n.c*s.ty+n.tx,n=n.b*s.tx+n.d*s.ty+n.ty,h=new Tt,this.inheritRotation?(e=Math.atan2(t.resultMatrix.b,t.resultMatrix.a),i=Math.cos(e),a=Math.sin(e),h.setTo(i,a,-a,i,0,0),Tt.mul(this._tempMatrix,h,Tt.TEMP),Tt.TEMP.copyTo(h),s=this.resultTransform.getMatrix(),Tt.mul(s,h,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,s=this.resultTransform.getMatrix(),Tt.TEMP.identity(),Tt.TEMP.d=this.d,Tt.mul(s,Tt.TEMP,this.resultMatrix)),this.resultMatrix.tx=r,this.resultMatrix.ty=n):(s=this.resultTransform.getMatrix()).copyTo(this.resultMatrix));for(var e,i,a,s,r,n,h,l=0,l=0,o=this._children.length;l<o;l++)this._children[l].update()},_.updateChild=function(){for(var t=0,t=0,e=this._children.length;t<e;t++)this._children[t].update()},_.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},_.updateDraw=function(t,e){c.ShowBones&&!c.ShowBones[this.name]||(this._sprite||(this._sprite=new k,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),F.stage.addChild(this._sprite)),this._sprite.x=t+this.resultMatrix.tx,this._sprite.y=e+this.resultMatrix.ty);for(var i=0,i=0,a=this._children.length;i<a;i++)this._children[i].updateDraw(t,e)},_.addChild=function(t){this._children.push(t),t.parentBone=this},_.findBone=function(t){if(this.name==t)return this;for(var e,i=0,i=0,a=this._children.length;i<a;i++)if(e=this._children[i].findBone(t))return e;return null},_.localToWorld=function(t){var e=t[0],i=t[1];t[0]=e*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,t[1]=e*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},c.ShowBones={};var St=c;function c(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new Yt,this.resultMatrix=new Tt,this._children=[]}e(d,"laya.ani.bone.BoneSlot"),(_=d.prototype).showSlotData=function(t,e){void 0===e&&(e=!0),this.currSlotData=t,e&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},_.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},_.replaceDisplayByName=function(t,e){var i;this.currSlotData&&(i=0,i=this.currSlotData.getDisplayByName(t),t=0,t=this.currSlotData.getDisplayByName(e),this.replaceDisplayByIndex(i,t))},_.replaceDisplayByIndex=function(t,e){this.currSlotData&&(this._replaceDic[t]=e,this.originalIndex==t)&&this.showDisplayByIndex(t)},_.showDisplayByIndex=function(t){this.originalIndex=t,null!=this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&-1<t&&t<this.currSlotData.displayArr.length?(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData&&(t=this.currDisplayData.name,this.currTexture=this.templet.getTexture(t),this.currTexture)&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!o.isConchApp||o.isConchApp&&"0.9.15"<k.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))):(this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null)},_.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},_.setParentMatrix=function(t){this._parentMatrix=t},_.draw=function(t,e,i,a){if(void 0===i&&(i=!1),void 0===a&&(a=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var s,r,n,h,l=this.currTexture;switch(this._diyTexture&&(l=this._diyTexture),this.currDisplayData.type){case 0:t&&(n=this.getDisplayMatrix(),this._parentMatrix)&&(s=!1,n)&&(Tt.mul(n,this._parentMatrix,Tt.TEMP),n=i?(null==this._resultMatrix&&(this._resultMatrix=new Tt),this._resultMatrix):new Tt,!o.isWebGL&&this.currDisplayData.uvs||o.isWebGL&&this._diyTexture&&this.currDisplayData.uvs?((r=d._tempMatrix).identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(r.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(s=!0,r.rotate(-Math.PI/2)),Tt.mul(r,Tt.TEMP,n)):Tt.TEMP.copyTo(n),s?t.drawTexture(l,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,n):t.drawTexture(l,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,n));break;case 1:null!=(h=i?(null==this._skinSprite&&(this._skinSprite=d.createSkinMesh()),this._skinSprite):d.createSkinMesh())&&(0,null==this.currDisplayData.bones?(r=this.currDisplayData.weights,this.deformData&&(r=this.deformData),s=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=v.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=v.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=r,this.currDisplayData.triangles.length,n=this.currDisplayData.triangles,h.init2(l,null,n,this._mVerticleArr,s),r=this.getDisplayMatrix(),this._parentMatrix&&r&&(Tt.mul(r,this._parentMatrix,Tt.TEMP),n=i?(null==this._resultMatrix&&(this._resultMatrix=new Tt),this._resultMatrix):new Tt,Tt.TEMP.copyTo(n),h.transform=n)):this.skinMesh(e,h,a),t.drawSkin(h));break;case 2:null!=(h=i?(null==this._skinSprite&&(this._skinSprite=d.createSkinMesh()),this._skinSprite):d.createSkinMesh())&&(this.skinMesh(e,h,a),t.drawSkin(h))}}},_.skinMesh=function(t,e,i){var a,s=this.currTexture,r=this.currDisplayData.bones,n=this._diyTexture?(s=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=v.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=v.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,h=this.currDisplayData.weights,l=this.currDisplayData.triangles,o=0,u=0,c=0,d=NaN,_=NaN,p=0,f=0,m=[],y=0,x=0;if(this.deformData&&0<this.deformData.length)for(var g=0,y=0,x=r.length;y<x;){for(c=r[y++]+y,u=o=0;y<c;y++)a=t[r[y]],d=h[p]+this.deformData[g++],_=h[p+1]+this.deformData[g++],f=h[p+2],o+=(d*a.a+_*a.c+a.tx)*f,u+=(d*a.b+_*a.d+a.ty)*f,p+=3;m.push(o,u)}else for(y=0,x=r.length;y<x;){for(c=r[y++]+y,u=o=0;y<c;y++)a=t[r[y]],d=h[p],_=h[p+1],f=h[p+2],o+=(d*a.a+_*a.c+a.tx)*f,u+=(d*a.b+_*a.d+a.ty)*f,p+=3;m.push(o,u)}this._mVerticleArr=m,e.init2(s,null,l,this._mVerticleArr,n)},_.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},_.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},_.getMatrix=function(){return this._resultMatrix},_.copy=function(){var t=new d;return t.type="copy",t.name=this.name,t.attachmentName=this.attachmentName,t.srcDisplayIndex=this.srcDisplayIndex,t.parent=this.parent,t.displayIndex=this.displayIndex,t.templet=this.templet,t.currSlotData=this.currSlotData,t.currTexture=this.currTexture,t.currDisplayData=this.currDisplayData,t},d.createSkinMesh=function(){return o.isWebGL||o.isConchApp?E.skinAniSprite():o.isWebGL?null:new(Wt.useSimpleMeshInCanvas?It:vt)},t(d,["_tempMatrix",function(){return this._tempMatrix=new Tt}]);var wt=d;function d(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this.originalIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}e(Q,"laya.ani.bone.canvasmesh.CanvasMeshRender"),(_=Q.prototype).renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},_._renderNoIndexes=function(t){for(var e,i=0,a=t.vertices.length/2,i=0;i<a-2;i++)this._renderDrawTriangle(t,e=2*i,2+e,4+e)},_._renderWithIndexes=function(t){for(var e=t.indexes,i=0,a=e.length,i=0;i<a;i+=3){var s=2*e[i],r=2*e[i+1],n=2*e[i+2];this._renderDrawTriangle(t,s,r,n)}},_._renderDrawTriangle=function(t,e,i,a){var s,r,n,h,l=this.context,o=t.uvs,u=t.vertices,c=t.texture,d=c.bitmap,_=d.source,p=c.width,f=c.height,m=d.width,d=d.height,y=NaN,x=NaN,g=NaN,v=NaN,M=NaN,D=NaN,I=(D=t.useUvTransform?(I=t.uvTransform,y=(o[e]*I.a+o[e+1]*I.c+I.tx)*m,x=(o[i]*I.a+o[i+1]*I.c+I.tx)*m,g=(o[a]*I.a+o[a+1]*I.c+I.tx)*m,v=(o[e]*I.b+o[e+1]*I.d+I.ty)*d,M=(o[i]*I.b+o[i+1]*I.d+I.ty)*d,(o[a]*I.b+o[a+1]*I.d+I.ty)*d):(y=o[e]*m,x=o[i]*m,g=o[a]*m,v=o[e+1]*d,M=o[i+1]*d,o[a+1]*d),u[e]),o=u[i],b=u[a],e=u[e+1],i=u[i+1],u=u[a+1];0<t.canvasPadding&&(a=t.canvasPadding,t=t.canvasPadding,r=e-(s=(e+i+u)/3),I=(h=(I+o+b)/3)+(N=I-h)/(n=Math.sqrt(N*N+r*r))*(n+a),e=s+r/n*(n+t),r=i-s,o=h+(N=o-h)/(n=Math.sqrt(N*N+r*r))*(n+a),i=s+r/n*(n+t),r=u-s,b=h+(N=b-h)/(n=Math.sqrt(N*N+r*r))*(n+a),u=s+r/n*(n+t)),l.save(),this.transform&&(h=this.transform,l.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),l.beginPath(),l.moveTo(I,e),l.lineTo(o,i),l.lineTo(b,u),l.closePath(),l.clip();var N=1/(y*M+v*g+x*D-M*g-v*x-y*D);l.transform((I*M+v*b+o*D-M*b-v*o-I*D)*N,(e*M+v*u+i*D-M*u-v*i-e*D)*N,(y*o+I*g+x*b-o*g-I*x-y*b)*N,(y*i+e*g+x*u-i*g-e*x-y*u)*N,(y*M*b+v*o*g+I*x*D-I*M*g-v*x*b-y*o*D)*N,(y*M*u+v*i*g+e*x*D-e*M*g-v*x*u-y*i*D)*N),l.drawImage(_,c.uv[0]*m,c.uv[1]*d,p,f,c.uv[0]*m,c.uv[1]*d,p,f),l.restore()};var _=Q;function Q(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}e(j,"laya.ani.bone.canvasmesh.MeshData"),j.prototype.getBounds=function(){return O._getWrapRec(this.vertices)};var Z=j;function j(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}e($,"laya.ani.bone.DeformAniData");var Ft=$;function $(){this.skinName=null,this.deformSlotDataList=[]}e(J,"laya.ani.bone.DeformSlotData");var kt=J;function J(){this.deformSlotDisplayList=[]}e(tt,"laya.ani.bone.DeformSlotDisplayData"),(A=tt.prototype).binarySearch1=function(t,e){var i=0,a=t.length-2;if(0==a)return 1;for(var s=a>>>1;;){if(t[Math.floor(s+1)]<=e?i=s+1:a=s,i==a)return i+1;s=i+a>>>1}return 0},A.apply=function(t,e,i){if(void 0===i&&(i=1),t+=.05,!(this.timeList.length<=0)){var a=0,s=this.timeList[0];if(!(t<s)){var r=this.vectices[0].length,n=[],s=this.binarySearch1(this.timeList,t);if(this.frameIndex=s,t>=this.timeList[this.timeList.length-1]){var h=this.vectices[this.vectices.length-1];if(i<1)for(a=0;a<r;a++)n[a]+=(h[a]-n[a])*i;else for(a=0;a<r;a++)n[a]=h[a]}else{this.tweenKeyList[this.frameIndex];for(var l,o=this.vectices[this.frameIndex-1],u=this.vectices[this.frameIndex],c=this.timeList[this.frameIndex-1],d=this.timeList[this.frameIndex],a=(i=this.tweenKeyList[s-1]?(t-c)/(d-c):0,0);a<r;a++)l=o[a],n[a]=l+(u[a]-l)*i}this.deformData=n}}};var Pt=tt;function tt(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}e(et,"laya.ani.bone.DrawOrderData");var Bt=et;function et(){this.time=NaN,this.drawOrder=[]}e(it,"laya.ani.bone.EventData");var Ut=it;function it(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.audioValue=null,this.time=NaN}e(P,"laya.ani.bone.IkConstraint"),(A=P.prototype).apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},A._applyIk1=function(t,e,i,a){var s=t.parentBone,r=1/(s.resultMatrix.a*s.resultMatrix.d-s.resultMatrix.b*s.resultMatrix.c),e=e-s.resultMatrix.tx,i=i-s.resultMatrix.ty,n=(e*s.resultMatrix.d-i*s.resultMatrix.c)*r-t.transform.x,i=(i*s.resultMatrix.a-e*s.resultMatrix.b)*r-t.transform.y,e=Math.atan2(i,n)*P.radDeg-t.transform.skX;t.transform.scX<0&&(e+=180),180<e?e-=360:e<-180&&(e+=360),t.transform.skX=t.transform.skY=t.transform.skX+e*a,t.update()},A.updatePos=function(t,e){this._sp&&this._sp.pos(t,e)},A._applyIk2=function(t,e,i,a,s,r){var n,h,l,o,u,c,d,_,p,f,m,y,x,g,v,M,D,I,b,N,A,T,C,S,w;0!=r&&(n=t.resultTransform.x,h=t.resultTransform.y,o=(N=t.transform.scX)<(o=u=l=0)?(N=-N,l=180,-1):(l=0,1),(I=t.transform.scY)<0&&(I=-I,o=-o),u=(C=e.transform.scX)<0?(C=-C,180):0,c=e.resultTransform.x,p=w=d=NaN,S=t.resultMatrix.a,f=t.resultMatrix.c,b=t.resultMatrix.b,x=t.resultMatrix.d,p=(T=Math.abs(N-I)<=1e-4)?(w=S*c+f*(d=e.resultTransform.y)+t.resultMatrix.tx,b*c+x*d+t.resultMatrix.ty):(d=0,w=S*c+t.resultMatrix.tx,b*c+t.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new k,F.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(i,a,15,"#ffff00"),this._sp.graphics.drawCircle(w,p,15,"#ff00ff")),t.setRotation(Math.atan2(p-t.resultMatrix.ty,w-t.resultMatrix.tx)),S=(_=t.parentBone).resultMatrix.a,f=_.resultMatrix.c,b=_.resultMatrix.b,m=1/(S*(x=_.resultMatrix.d)-f*b),M=((i=i-_.resultMatrix.tx)*x-(a=a-_.resultMatrix.ty)*f)*m-n,y=(a*S-i*b)*m-h,w=((i=w-_.resultMatrix.tx)*x-(a=p-_.resultMatrix.ty)*f)*m-n,p=(a*S-i*b)*m-h,_=Math.sqrt(w*w+p*p),m=e.length*C,p=w=NaN,T?((C=(M*M+y*y-_*_-(m*=N)*m)/(2*_*m))<-1?C=-1:1<C&&(C=1),p=Math.acos(C)*s,S=_+m*C,f=m*Math.sin(p),w=Math.atan2(y*S-M*f,M*S+y*f)):(T=(S=N*m)*S,C=(f=I*m)*f,m=M*M+y*y,y=Math.atan2(y,M),0<(x=(M=-2*C*_)*M-4*(D=C-T)*(b=C*_*_+T*m-T*C))&&(g=Math.sqrt(x),M=(g=-(M+(g=M<0?-g:g))/2)/D,D=b/g,(b=Math.abs(M)<Math.abs(D)?M:D)*b<=m)&&(a=Math.sqrt(m-b*b)*s,w=y-Math.atan2(a,b),p=Math.atan2(a/I,(b-_)/N)),A=N=b=I=D=M=g=0,b<(x=(i=_+S)*i)&&(I=0,b=x,N=i),(x=(i=_-S)*i)<(v=Number.MAX_VALUE)&&(g=Math.PI,v=x,M=i),T=Math.acos(-S*_/(T-C)),(x=(i=S*Math.cos(T)+_)*i+(a=f*Math.sin(T))*a)<v&&(g=T,v=x,M=i,D=a),b<x&&(I=T,b=x,N=i,A=a),p=m<=(v+b)/2?(w=y-Math.atan2(D*s,M),g*s):(w=y-Math.atan2(A*s,N),I*s)),C=Math.atan2(d,c)*o,S=t.resultTransform.skX,180<(w=(w-C)*P.radDeg+l-S)?w-=360:w<-180&&(w+=360),t.resultTransform.x=n,t.resultTransform.y=h,t.resultTransform.skX=t.resultTransform.skY=S+w*r,S=e.resultTransform.skX,180<(p=(p+C)*P.radDeg*o+u-(S%=360))?p-=360:p<-180&&(p+=360),e.resultTransform.x=c,e.resultTransform.y=d,e.resultTransform.skX=e.resultTransform.skY=e.resultTransform.skY+p*r,t.update())},A._applyIk3=function(t,e,i,a,s,r){var n,h,l,o,u,c,d,_,p,f,m,y,x,g;0!=r&&(n=r=NaN,c=(c=e.resultMatrix.a*e.length)*c+(c=e.resultMatrix.b*e.length)*c,y=Math.sqrt(c),h=t.resultMatrix.tx,l=t.resultMatrix.ty,f=(x=(o=e.resultMatrix.tx)-h)*x+(p=(u=e.resultMatrix.ty)-l)*p,_=Math.sqrt(f),m=(x=i-t.resultMatrix.tx)*x+(p=a-t.resultMatrix.ty)*p,u=y+_<=(g=Math.sqrt(m))||g+y<=_||g+_<=y?(d=NaN,o=h+(d=y+_<=g?1:-1)*(i-h)*_/g,l+d*(a-l)*_/g):(d=h+x*(y=(f-c+m)/(2*m)),_=l+p*y,p=-p*(c=Math.sqrt(f-y*y*m)/g),f=x*c,0<s?(o=d-p,_-f):(o=d+p,_+f)),r=o,n=u,this.isDebug&&(this._sp||(this._sp=new k,F.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(h,l,15,"#ff00ff"),this._sp.graphics.drawCircle(i,a,15,"#ffff00"),this._sp.graphics.drawCircle(r,n,15,"#ff00ff")),y=NaN,y=Math.atan2(n-t.resultMatrix.ty,r-t.resultMatrix.tx),t.setRotation(y),(m=P._tempMatrix).identity(),m.rotate(y),m.scale(t.resultMatrix.getScaleX(),t.resultMatrix.getScaleY()),m.translate(t.resultMatrix.tx,t.resultMatrix.ty),m.copyTo(t.resultMatrix),t.updateChild(),g=NaN,g=Math.atan2(a-n,i-r),e.setRotation(g),(x=P._tempMatrix).identity(),x.rotate(g),x.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),x.translate(r,n),m.copyTo(e.resultMatrix),e.updateChild())},t(P,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new Tt}]);var at=P;function P(t,e){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=e[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]);for(var i=this._bones.length=0,a=t.boneIndexs.length;i<a;i++)this._bones.push(e[t.boneIndexs[i]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}e(st,"laya.ani.bone.IkConstraintData");var Lt=st;function st(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}e(p,"laya.ani.bone.MeshTools"),p.findEdge=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);for(var a=0,s=0,r=t.length,s=-1,a=0;a<r;a+=2)(s<0||i==t[s+e]<t[a+e])&&(s=a);return s},p.findBestTriangle=function(t){var e=p.findEdge(t,1,!0),i=p.findEdge(t,1,!1),a=p.findEdge(t,0,!0),t=p.findEdge(t,0,!1),s=p._bestTriangle;return s.length=0,s.push(a,t),s.indexOf(e)<0&&s.push(e),s.indexOf(i)<0&&s.push(i),s},p.solveMesh=function(t,e){(e=e||[]).length=0,i=t.uvs,a=t.vertices;var i,a,s=(n=p.findBestTriangle(i))[0],r=n[1],n=n[2];return p._absArr.length=0,p.isNormalUV(t.texture.uv)&&p.adptTexture(t),t=p.solvePoints(t.texture.uv,i[s],i[s+1],i[r]-i[s],i[r+1]-i[s+1],i[n]-i[s],i[n+1]-i[s+1],p._absArr),p.transPoints(t,a[s],a[s+1],a[r]-a[s],a[r+1]-a[s+1],a[n]-a[s],a[n+1]-a[s+1],e)},p.findWrapRect=function(t){var e=p.findEdge(t,1,!0),i=p.findEdge(t,1,!1),a=p.findEdge(t,0,!0),s=p.findEdge(t,0,!1),a=t[a],s=t[s],e=t[e+1];return[s,t=t[i+1],a-s,e-t]},p.adptTexture=function(t){var e=p.findWrapRect(t.uvs),i=t.texture,a=i.width,s=i.height,i=Ct.create(i,e[0]*a,e[1]*s,e[2]*a,e[3]*s);t.texture=i},p.isNormalUV=function(t){return 0==t[0]&&0==t[1]&&1==t[4]&&1==t[5]},p.solvePoints=function(t,e,i,a,s,r,n,h){h=h||[];for(var l,o=0,u=t.length,o=0;o<u;o+=2)l=p.solve2(t[o],t[o+1],e,i,a,s,r,n),h.push(l[0],l[1]);return h},p.transPoints=function(t,e,i,a,s,r,n,h){h=h||[];for(var l=0,o=t.length,l=0;l<o;l+=2)p.transPoint(t[l],t[l+1],e,i,a,s,r,n,h);return h},p.transPoint=function(t,e,i,a,s,r,n,h,l){return(l=l||[]).push(i+s*t+n*e,a+r*t+h*e),l},p.solve2=function(t,e,i,a,s,r,n,h,l,o){void 0===l&&(l=!1),o=o||[];var u,c=NaN;return 0==s?p.solve2(t,e,i,a,n,h,s,r,!0,o):(u=NaN,c=((u=t-i)-(t=(e-a-u*r/s)/(h-n*r/s))*n)/s,l?o.push(t,c):o.push(c,t),o)},p.solve=function(t,e,i,a){return p.solve2(t.x,t.y,e.x,e.y,i.x,i.y,a.x,a.y)},p._bestTriangle=[],p._absArr=[];var rt=p;function p(){}e(B,"laya.ani.bone.PathConstraint"),(A=B.prototype).apply=function(t,e){if(this.target){var i=this.translateMix,a=this.translateMix,s=0<a,r=this.data.spacingMode,n="length"==r,h=this.data.rotateMode,l="tangent"==h,o="chainScale"==h,u=[],c=this.bones.length,d=l?c:c+1,_=[],p=((this._spaces=_)[0]=this.position,this.spacing);if(o||n)for(var f=0,m=d-1;f<m;){var y=this.bones[f],x=(v=y.length)*y.resultMatrix.a,g=v*y.resultMatrix.b,v=Math.sqrt(x*x+g*g);o&&(u[f]=v),_[++f]=n?Math.max(0,v+p):p}else for(f=1;f<d;f++)_[f]=p;var M=this.computeWorldPositions(this.target,t,e,d,l,"percent"==this.data.positionMode,"percent"==r);if(this._debugKey){for(f=0;f<M.length;f++)e.drawCircle(M[f++],M[f++],5,"#00ff00");for(var D=[],f=0;f<M.length;f++)D.push(M[f++],M[f++]);e.drawLines(0,0,D,"#ff0000")}var I=M[0],b=M[1],N=this.data.offsetRotation,L="chain"==h&&0==N,A=NaN;for(f=0,A=3;f<c;f++,A+=3){(y=this.bones[f]).resultMatrix.tx+=(I-y.resultMatrix.tx)*i,y.resultMatrix.ty+=(b-y.resultMatrix.ty)*i;var T,C,S,w,F,k,P,B=(x=M[A])-I,U=(g=M[A+1])-b;o&&0!=(v=u[f])&&(T=(Math.sqrt(B*B+U*U)/v-1)*a+1,y.resultMatrix.a*=T,y.resultMatrix.c*=T),I=x,b=g,s&&(T=y.resultMatrix.a,C=y.resultMatrix.c,S=y.resultMatrix.b,w=y.resultMatrix.d,k=F=P=NaN,P=l?M[A-1]:0==_[f+1]?M[A+2]:Math.atan2(U,B),P-=Math.atan2(S,T)-N/180*Math.PI,L&&(F=Math.cos(P),k=Math.sin(P),I+=((v=y.length)*(F*T-k*S)-B)*a,b+=(v*(k*T+F*S)-U)*a),P>Math.PI?P-=2*Math.PI:P<-Math.PI&&(P+=2*Math.PI),P*=a,F=Math.cos(P),k=Math.sin(P),y.resultMatrix.a=F*T-k*S,y.resultMatrix.c=F*C-k*w,y.resultMatrix.b=k*T+F*S,y.resultMatrix.d=k*C+F*w)}}},A.computeWorldVertices2=function(t,e,i,a,s,r){var n,h,l=t.currDisplayData.bones,o=t.currDisplayData.weights,u=t.currDisplayData.triangles,c=0,d=0,_=0,p=0,f=0,m=0,y=0,x=0,g=0,v=0;if(null==l){var M,u=u||o;if(t.deformData&&(u=t.deformData),M=t.parent,e)for(h=e.length,c=0;c<h;c++)if(e[c].name==M){n=e[c];break}var D,I=(D=(D=n?n.resultMatrix:D)||B._tempMt).tx,b=D.ty,N=D.a,A=D.b,T=D.c,C=D.d;for(n&&(C*=n.d),d=i,f=r;f<a;d+=2,f+=2)g=u[d],v=u[d+1],s[f]=g*N+v*A+I,s[f+1]=-(g*T+v*C+b)}else{for(c=0;c<i;c+=2)d+=(p=l[d])+1,_+=p;for(var S=e,f=r,m=3*_;f<a;f+=2){for(x=y=0,p=l[d++],p+=d;d<p;d++,m+=3){var w=S[l[d]].resultMatrix,g=o[m],v=o[m+1],F=o[m+2];y+=(g*w.a+v*w.c+w.tx)*F,x+=(g*w.b+v*w.d+w.ty)*F}s[f]=y,s[f+1]=x}}},A.computeWorldPositions=function(t,L,R,e,O,E,V){t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles;var i=[],a=0,s=t.currDisplayData.verLen,K=this.position,Y=this._spaces,r=[],n=[],h=s/6,W=-1,l=NaN,o=0,u=0,c=NaN,X=NaN,d=NaN,_=NaN;if(h--,this.computeWorldVertices2(t,L,2,s-=4,i,0),this._debugKey)for(a=0;a<i.length;)R.drawCircle(i[a++],i[a++],10,"#ff0000");r=i,this._curves.length=h;for(var p=this._curves,f=r[l=0],m=r[1],y=0,x=0,g=0,v=0,M=0,D=0,I=NaN,b=NaN,N=NaN,A=NaN,T=NaN,C=NaN,S=NaN,w=NaN,F=0,a=0,F=2;a<h;a++,F+=6)y=r[F],x=r[F+1],g=r[F+2],v=r[F+3],T=2*(I=.1875*(f-2*y+g))+(N=.09375*(3*(y-g)-f+(M=r[F+4]))),C=2*(b=.1875*(m-2*x+v))+(A=.09375*(3*(x-v)-m+(D=r[F+5]))),S=.75*(y-f)+I+.16666667*N,w=.75*(x-m)+b+.16666667*A,l+=Math.sqrt(S*S+w*w),S+=T,w+=C,T+=N,C+=A,l+=Math.sqrt(S*S+w*w),S+=T,w+=C,l+=Math.sqrt(S*S+w*w),S+=T+N,w+=C+A,l+=Math.sqrt(S*S+w*w),p[a]=l,f=M,m=D;if(E&&(K*=l),V)for(a=0;a<e;a++)Y[a]*=l;for(var k=this._segments,P=0,B=0,B=u=o=a=0;a<e;a++,o+=3)if((c=K+=X=Y[a])<0)this.addBeforePosition(c,r,0,n,o);else if(l<c)this.addAfterPosition(c-l,r,s-4,n,o);else{for(;;u++)if(!((_=p[u])<c)){0==u?c/=_:c=(c-(d=p[u-1]))/(_-d);break}if(u!=W){var W=u,U=6*u,f=r[U],m=r[U+1],y=r[U+2],x=r[U+3],g=r[U+4],v=r[U+5],T=2*(I=.03*(f-2*y+g))+(N=.006*(3*(y-g)-f+(M=r[U+6]))),C=2*(b=.03*(m-2*x+v))+(A=.006*(3*(x-v)-m+(D=r[U+7]))),S=.3*(y-f)+I+.16666667*N,w=.3*(x-m)+b+.16666667*A,P=Math.sqrt(S*S+w*w);for(k[0]=P,U=1;U<8;U++)S+=T,w+=C,T+=N,C+=A,P+=Math.sqrt(S*S+w*w),k[U]=P;S+=T,w+=C,P+=Math.sqrt(S*S+w*w),k[8]=P,S+=T+N,w+=C+A,P+=Math.sqrt(S*S+w*w),k[9]=P,B=0}for(c*=P;;B++)if(!((_=k[B])<c)){0==B?c/=_:c=B+(c-(d=k[B-1]))/(_-d);break}this.addCurvePosition(.1*c,f,m,y,x,g,v,M,D,n,o,O||0<a&&0==X)}return n},A.addBeforePosition=function(t,e,i,a,s){var r=e[i],n=e[i+1],h=e[i+2]-r,e=e[i+3]-n,i=Math.atan2(e,h);a[s]=r+t*Math.cos(i),a[s+1]=n+t*Math.sin(i),a[s+2]=i},A.addAfterPosition=function(t,e,i,a,s){var r=e[i+2],n=e[i+3],h=r-e[i],e=n-e[i+1],i=Math.atan2(e,h);a[s]=r+t*Math.cos(i),a[s+1]=n+t*Math.sin(i),a[s+2]=i},A.addCurvePosition=function(t,e,i,a,s,r,n,h,l,o,u,c){var d=(t=0==t?1e-4:t)*t,_=d*t,p=1-t,f=p*p,m=f*p,y=p*t,x=3*y,p=p*x,x=x*t,t=e*m+a*p+r*x+h*_,h=i*m+s*p+n*x+l*_;o[u]=t,o[u+1]=h,o[u+2]=c?Math.atan2(h-(i*f+s*y*2+n*d),t-(e*f+a*y*2+r*d)):0},B.NONE=-1,B.BEFORE=-2,B.AFTER=-3,t(B,["_tempMt",function(){return this._tempMt=new Tt}]);var nt=B;function B(t,e){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var i=this.data.bones,a=0,s=i.length;a<s;a++)this.bones.push(e[i[a]])}e(ht,"laya.ani.bone.PathConstraintData");var Rt=ht;function ht(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}e(lt,"laya.ani.bone.SkinData");var Ot=lt;function lt(){this.name=null,this.slotArr=[]}e(ot,"laya.ani.bone.SkinSlotDisplayData"),(A=ot.prototype).createTexture=function(t){return this.texture||(this.texture=new Ct(t.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),o.isWebGL)||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY),this.texture},A.destory=function(){this.texture&&this.texture.destroy()};var Et=ot;function ot(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}e(ut,"laya.ani.bone.SlotData"),ut.prototype.getDisplayByName=function(t){for(var e=0,i=this.displayArr.length;e<i;e++)if(this.displayArr[e].attachmentName==t)return e;return-1};var Vt=ut;function ut(){this.name=null,this.displayArr=[]}e(dt,"laya.ani.bone.TfConstraint"),dt.prototype.apply=function(){for(var t=this.target.resultMatrix.a,e=this.target.resultMatrix.b,i=this.target.resultMatrix.c,a=this.target.resultMatrix.d,s=0,r=this._bones.length;s<r;s++){var n,h,l,o,u,c,d,_,p=this._bones[s];0<this.rotateMix&&(h=p.resultMatrix.a,u=p.resultMatrix.b,l=p.resultMatrix.c,c=p.resultMatrix.d,(_=Math.atan2(i,t)-Math.atan2(l,h)+this._data.offsetRotation*Math.PI/180)>Math.PI?_-=2*Math.PI:_<-Math.PI&&(_+=2*Math.PI),_*=this.rotateMix,n=Math.cos(_),d=Math.sin(_),p.resultMatrix.a=n*h-d*l,p.resultMatrix.b=n*u-d*c,p.resultMatrix.c=d*h+n*l,p.resultMatrix.d=d*u+n*c),this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),p.resultMatrix.tx+=(this._temp[0]-p.resultMatrix.tx)*this.translateMix,p.resultMatrix.ty+=(this._temp[1]-p.resultMatrix.ty)*this.translateMix,p.updateChild()),0<this.scaleMix&&(h=Math.sqrt(p.resultMatrix.a*p.resultMatrix.a+p.resultMatrix.c*p.resultMatrix.c),l=Math.sqrt(t*t+i*i),o=1e-5<h?(h+(l-h+this._data.offsetScaleX)*this.scaleMix)/h:0,p.resultMatrix.a*=o,p.resultMatrix.c*=o,h=Math.sqrt(p.resultMatrix.b*p.resultMatrix.b+p.resultMatrix.d*p.resultMatrix.d),l=Math.sqrt(e*e+a*a),o=1e-5<h?(h+(l-h+this._data.offsetScaleY)*this.scaleMix)/h:0,p.resultMatrix.b*=o,p.resultMatrix.d*=o),0<this.shearMix&&(u=p.resultMatrix.b,c=p.resultMatrix.d,d=Math.atan2(c,u),(_=Math.atan2(a,e)-Math.atan2(i,t)-(d-Math.atan2(p.resultMatrix.c,p.resultMatrix.a)))>Math.PI?_-=2*Math.PI:_<-Math.PI&&(_+=2*Math.PI),_=d+(_+this._data.offsetShearY*Math.PI/180)*this.shearMix,o=Math.sqrt(u*u+c*c),p.resultMatrix.b=Math.cos(_)*o,p.resultMatrix.d=Math.sin(_)*o)}};var ct=dt;function dt(t,e){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=S(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=e[t.targetIndex];for(var i=0,i=0,a=t.boneIndexs.length;i<a;i++)this._bones.push(e[t.boneIndexs[i]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}e(_t,"laya.ani.bone.TfConstraintData");var Kt=_t;function _t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}e(pt,"laya.ani.bone.Transform"),(A=pt.prototype).initData=function(t){null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.skX&&(this.skX=t.skX),null!=t.skY&&(this.skY=t.skY),null!=t.scX&&(this.scX=t.scX),null!=t.scY&&(this.scY=t.scY)},A.getMatrix=function(){var t=this.mMatrix||(this.mMatrix=new Tt);return t.identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},A.skew=function(t,e,i){var a=Math.sin(i),i=Math.cos(i),s=Math.sin(e),e=Math.cos(e);return t.setTo(t.a*e-t.b*a,t.a*s+t.b*i,t.c*e-t.d*a,t.c*s+t.d*i,t.tx*e-t.ty*a,t.tx*s+t.ty*i),t};var Yt=pt;function pt(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}e(f,"laya.ani.bone.UVTools"),f.getRelativeUV=function(t,e,i){for(var a=t[0],s=t[2]-t[0],r=t[1],t=t[5]-t[1],n=((i=i||[]).length=e.length,0),h=i.length,l=1/s,o=1/t,n=0;n<h;n+=2)i[n]=(e[n]-a)*l,i[n+1]=(e[n+1]-r)*o;return i},f.getAbsoluteUV=function(t,e,i){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return i?(K.copyArray(i,e),i):e;for(var a=t[0],s=t[2]-t[0],r=t[1],n=t[5]-t[1],h=((i=i||[]).length=e.length,0),l=i.length,h=0;h<l;h+=2)i[h]=e[h]*s+a,i[h+1]=e[h+1]*n+r;return i};var v=f;function f(){}e(mt,"laya.ani.KeyFramesContent");var ft=mt;function mt(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}e(m,"laya.ani.math.BezierLerp"),m.getBezierRate=function(t,e,i,a,s){var r=m._getBezierParamKey(e,i,a,s),n=100*r+t;if(m._bezierResultCache[n])return m._bezierResultCache[n];for(var h=m._getBezierPoints(e,i,a,s,r),l=0,o=h.length,l=0;l<o;l+=2)if(t<=h[l])return m._bezierResultCache[n]=h[l+1],h[l+1];return m._bezierResultCache[n]=1},m._getBezierParamKey=function(t,e,i,a){return 100*(100*(100*(100*t+e)+i)+a)},m._getBezierPoints=function(t,e,i,a,s){return m._bezierPointsCache[s]||(t=[0,0,t,e,i,a,1,1],e=(new w).getBezierPoints(t,100,3),m._bezierPointsCache[s]=e)},m._bezierResultCache={},m._bezierPointsCache={};var yt=m;function m(){}e(y,"laya.ani.AnimationPlayer",a),A=y.prototype,F.imps(A,{"laya.resource.IDestroy":!0}),A._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},A._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,a=0,s=e.getAnimationCount();a<s;a++){for(var r=[],n=0,h=e.getAnimation(a).nodes.length;n<h;n++){for(var l=e.getAnimation(a).nodes[n],o=Math.floor(l.playTime/i+.01),u=new Uint16Array(o+1),c=-1,d=0,_=l.keyFrame.length;d<_;d++){var p=l.keyFrame[d],f=p.startTime,m=f+p.duration+i;do{for(var y=Math.floor(f/i+.5),x=c+1;x<y;x++)u[x]=d}while(u[c=y]=d,(f+=i)<=m)}r.push(u)}t.push(r)}},A._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},A._calculatePlayDuration=function(){var t;0!==this.state&&(t=this._templet.getAniDuration(this._currentAnimationClipIndex),0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart)},A._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e},A._setPlayParamsWhenStop=function(t,e,i){void 0===i&&(i=-1),this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor((0<i?i:t)/e+.01),0),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},A._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0,a=(this._startUpdateLoopCount!==V.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i),this.playDuration);if(i+=this._currentTime,0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=a||0===this._overallDuration&&i>=this.playEnd)this._setPlayParamsWhenStop(a,e,this.playEnd),this.event("stopped");else if(0<a)if(a<=i){do{if(i-=a,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(a,e),this._stopWhenCircleFinish=!1,void this.event("stopped")}while(i<a&&(this._setPlayParams(i,e),this.event("complete")),a<=i)}else this._setPlayParams(i,e);else this._stopWhenCircleFinish?(this._setPlayParamsWhenStop(a,e),this._stopWhenCircleFinish=!1,this.event("stopped")):(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete"))}},A._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},A.play=function(t,e,i,a,s){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===a&&(a=0),void 0===s&&(s=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(i<0||a<0||s<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==s&&s<a)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=a,this._playEnd=s,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=V.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},A.playByFrame=function(t,e,i,a,s,r){r=1e3/(r=void 0===r?30:r);this.play(t=void 0===t?0:t,e=void 0===e?1:e,i=void 0===i?2147483647:i,(a=void 0===a?0:a)*r,(s=void 0===s?0:s)*r)},A.stop=function(t){(t=void 0===t?!0:t)?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},i(0,A,"playEnd",function(){return this._playEnd}),i(0,A,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet!==t&&((this._templet=t).loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),i(0,A,"playStart",function(){return this._playStart}),i(0,A,"playDuration",function(){return this._playDuration}),i(0,A,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),i(0,A,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),i(0,A,"overallDuration",function(){return this._overallDuration}),i(0,A,"currentFrameTime",function(){return this._currentFrameTime}),i(0,A,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),i(0,A,"currentPlayTime",function(){return this._currentTime+this._playStart}),i(0,A,"cachePlayRate",function(){return this._cachePlayRate},function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet)&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate]))}),i(0,A,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet)&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t]))}),i(0,A,"currentTime",null,function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=V.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/e),0),this._currentFrameTime=this._currentKeyframeIndex*e}}),i(0,A,"paused",function(){return this._paused},function(t){(this._paused=t)&&this.event("paused")}),i(0,A,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),i(0,A,"destroyed",function(){return this._destroyed});var xt=y;function y(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,y.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}e(g,"laya.ani.GraphicsAni",s),g.prototype.drawSkin=function(t){this._saveToCmd(o._context._drawSkin,[t])},g.create=function(){return g._caches.pop()||new g},g.recycle=function(t){t.clear(),g._caches.push(t)},g._caches=[];var gt=g;function g(){g.__super.call(this),o.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=Tt.EMPTY),this._addCmd([t]),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}e(M,"laya.ani.bone.canvasmesh.SkinMeshCanvas",_),(a=M.prototype).init2=function(t,e,i,a,s){var r;this.transform&&(this.transform=null),i?r=i:(r=[]).push(0,1,3,3,1,2),this.mesh.texture=t,this.mesh.indexes=r,this.mesh.vertices=a,this.mesh.uvs=s},a.render=function(t,e,i){this.mesh.texture&&(this.transform?(this.transform.translate(e,i),this.renderToContext(t),this.transform.translate(-e,-i)):(this.transform=M._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this.renderToContext(t),this.transform.translate(-e,-i),this.transform=null))},t(M,["_tempMatrix",function(){return this._tempMatrix=new Tt}]);var vt=M;function M(){M.__super.call(this),this.mesh=new Z}e(D,"laya.ani.AnimationTemplet",n),(A=D.prototype).parse=function(t){t=new At(t);this._aniVersion=t.readUTFString(),q.parse(this,t)},A._calculateKeyFrame=function(t,e,i){var a=t.keyFrame;a[e]=a[0];for(var s=0;s<e;s++){var r=a[s];r.nextData=(0===r.duration?r:a[s+1]).data}a.length--},A.onAsynLoaded=function(t,e,i){e=new At(e);this._aniVersion=e.readUTFString(),("LAYAANIMATION:02"===this._aniVersion?H:q).parse(this,e),this._endLoaded()},A.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},A.getAnimationCount=function(){return this._anis.length},A.getAnimation=function(t){return this._anis[t]},A.getAniDuration=function(t){return this._anis[t].playTime},A.getNodes=function(t){return this._anis[t].nodes},A.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},A.getNodeCount=function(t){return this._anis[t].nodes.length},A.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},A.getPublicExtData=function(){return this._publicExtData},A.getAnimationDataWithCache=function(t,e,i,a){e=e[i];return e&&(i=e[t])?i[a]:null},A.setAnimationDataWithCache=function(t,e,i,a,s){e=e[i]||(e[i]={});(e[t]||(e[t]=[]))[a]=s},A.getOriginalData=function(t,e,i,a,s){for(var r=this._anis[t].nodes,n=0,h=0,l=r.length,o=0;h<l;h++){var u=r[h],c=u.keyFrame[i[h][a]],d=(u.dataOffset=o,s-c.startTime),_=u.lerpType;if(_)switch(_){case 0:case 1:for(n=0;n<u.keyframeWidth;)n+=u.interpolationMethod[n](u,n,e,o+n,c.data,d,null,c.duration,c.nextData);break;case 2:for(var p=c.interpolationData,f=p.length,m=0,n=0;n<f;){var y=p[n];switch(y){case 6:case 7:n+=D.interpolation[y](u,m,e,o+m,c.data,d,null,c.duration,c.nextData,p,n+1);break;default:n+=D.interpolation[y](u,m,e,o+m,c.data,d,null,c.duration,c.nextData)}m++}}else for(n=0;n<u.keyframeWidth;)n+=u.interpolationMethod[n](u,n,e,o+n,c.data,d,null,c.duration,c.nextData);o+=u.keyframeWidth}},A.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t].nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(i.length),this.unfixedCurrentTimes=new Float32Array(i.length),this.unfixedLastAniIndex=t);for(var a=0,s=i.length;a<s;a++){var r=i[a];for(e<this.unfixedCurrentTimes[a]&&(this.unfixedCurrentFrameIndexes[a]=0),this.unfixedCurrentTimes[a]=e;this.unfixedCurrentFrameIndexes[a]<r.keyFrame.length&&!(r.keyFrame[this.unfixedCurrentFrameIndexes[a]].startTime>this.unfixedCurrentTimes[a]);)this.unfixedCurrentFrameIndexes[a]++;this.unfixedCurrentFrameIndexes[a]--}return this.unfixedCurrentFrameIndexes},A.getOriginalDataUnfixedRate=function(t,e,i){for(var a=this._anis[t].nodes,s=(t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedKeyframes=S(a.length),this.unfixedLastAniIndex=t),0),r=0,n=a.length,h=0;r<n;r++){var l=a[r];for(i<this.unfixedCurrentTimes[r]&&(this.unfixedCurrentFrameIndexes[r]=0),this.unfixedCurrentTimes[r]=i;this.unfixedCurrentFrameIndexes[r]<l.keyFrame.length&&!(l.keyFrame[this.unfixedCurrentFrameIndexes[r]].startTime>this.unfixedCurrentTimes[r]);)this.unfixedKeyframes[r]=l.keyFrame[this.unfixedCurrentFrameIndexes[r]],this.unfixedCurrentFrameIndexes[r]++;var o=this.unfixedKeyframes[r],u=(l.dataOffset=h,i-o.startTime);if(l.lerpType)switch(l.lerpType){case 0:case 1:for(s=0;s<l.keyframeWidth;)s+=l.interpolationMethod[s](l,s,e,h+s,o.data,u,null,o.duration,o.nextData);break;case 2:for(var c=o.interpolationData,d=c.length,_=0,s=0;s<d;){var p=c[s];switch(p){case 6:case 7:s+=D.interpolation[p](l,_,e,h+_,o.data,u,null,o.duration,o.nextData,c,s+1);break;default:s+=D.interpolation[p](l,_,e,h+_,o.data,u,null,o.duration,o.nextData)}_++}}else for(s=0;s<l.keyframeWidth;)s+=l.interpolationMethod[s](l,s,e,h+s,o.data,u,null,o.duration,o.nextData);h+=l.keyframeWidth}},D._LinearInterpolation_0=function(t,e,i,a,s,r,n,h,l,o){r=0===h?0:r/h;return i[a]=(1-r)*s[e]+r*l[e],1},D._QuaternionInterpolation_1=function(t,e,i,a,s,r,n,h,l,o){return R.slerpQuaternionArray(s,e,l,e,0===h?0:r/h,i,a),4},D._AngleInterpolation_2=function(t,e,i,a,s,r,n,h,l,o){return 0},D._RadiansInterpolation_3=function(t,e,i,a,s,r,n,h,l,o){return 0},D._Matrix4x4Interpolation_4=function(t,e,i,a,s,r,n,h,l,o){for(var u=0;u<16;u++,e++)i[a+u]=s[e]+r*n[e];return 16},D._NoInterpolation_5=function(t,e,i,a,s,r,n,h,l,o){return i[a]=s[e],1},D._BezierInterpolation_6=function(t,e,i,a,s,r,n,h,l,o,u){return i[a]=s[e]+(l[e]-s[e])*yt.getBezierRate(r/h,o[u=void 0===u?0:u],o[u+1],o[u+2],o[u+3]),5},D._BezierInterpolation_7=function(t,e,i,a,s,r,n,h,l,o,u){return i[a]=o[(u=void 0===u?0:u)+4]+o[u+5]*yt.getBezierRate((.001*r+o[u+6])/o[u+7],o[u],o[u+1],o[u+2],o[u+3]),9},D.load=function(t){return F.loader.create(t,null,null,D)},D.interpolation=[D._LinearInterpolation_0,D._QuaternionInterpolation_1,D._AngleInterpolation_2,D._RadiansInterpolation_3,D._Matrix4x4Interpolation_4,D._NoInterpolation_5,D._BezierInterpolation_6,D._BezierInterpolation_7];var Mt=D;function D(){this._aniMap={},this.unfixedLastAniIndex=-1,D.__super.call(this),this._anis=new Array}e(I,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",vt),(s=I.prototype).getCanvasPic=function(){var t,e=new L("2D"),i=e.getContext("2d");return this.rec=this.mesh.getBounds(),e.size(this.rec.width,this.rec.height),t=this.transform,this.transform=I.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(i),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=t,new Ct(e)},s.render=function(t,e,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i)):(this.transform=vt._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i),this.transform=null))},s._renderTextureToContext=function(t){var e,i;this.context=t.ctx||t,t.save(),e=this.tex,this.transform&&(i=this.transform,t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)),this.rec=this.mesh.getBounds(),t.translate(this.rec.x,this.rec.y),t.drawTexture(e,0,0,e.width,e.height,0,0),t.restore()},t(I,["tempMt",function(){return this.tempMt=new Tt}]);function I(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,I.__super.call(this)}e(bt,"laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas",Dt=vt),(_=bt.prototype).init2=function(t,e,i,a,s){Dt.prototype.init2.call(this,t,e,i,a,s),this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds.length=6,this.drawCmds.length=9},_.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(this.mesh.uvs.length<=8?0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh):(this.cacheOK||(this.tempMesh.texture=this.mesh.texture,this.tempMesh.uvs=this.mesh.texture.uv,this.tempMesh.vertices=rt.solveMesh(this.mesh,this.tempMesh.vertices),this.cacheOK=!0),0==this.mode?this._renderWithIndexes(this.tempMesh):this._renderNoIndexes(this.tempMesh)))},_._renderWithIndexes=function(t){if(this.cacheCmdOK)this.renderByCache(t);else{var e=t.indexes,i=0,a=e.length;for(1<a&&(a=1),i=0;i<a;i+=3){var s=2*e[i],r=2*e[i+1],n=2*e[i+2];this._renderDrawTriangle(t,s,r,n)}this.cacheCmdOK=!0}},_._renderDrawTriangle=function(t,e,i,a){var s=this.context,r=t.uvs,n=t.vertices,h=t.texture,l=h.bitmap,o=l.source,u=h.width,c=h.height,d=l.width,l=l.height,_=NaN,p=NaN,f=NaN,m=NaN,y=NaN,x=NaN,t=(x=t.useUvTransform?(t=t.uvTransform,_=(r[e]*t.a+r[e+1]*t.c+t.tx)*d,p=(r[i]*t.a+r[i+1]*t.c+t.tx)*d,f=(r[a]*t.a+r[a+1]*t.c+t.tx)*d,m=(r[e]*t.b+r[e+1]*t.d+t.ty)*l,y=(r[i]*t.b+r[i+1]*t.d+t.ty)*l,(r[a]*t.b+r[a+1]*t.d+t.ty)*l):(_=r[e]*d,p=r[i]*d,f=r[a]*d,m=r[e+1]*l,y=r[i+1]*l,r[a+1]*l),n[e]),r=n[i],g=n[a],e=n[e+1],i=n[i+1],n=n[a+1],a=1/(_*y+m*f+p*x-y*f-m*p-_*x),v=_*r+t*f+p*g-r*f-t*p-_*g,M=_*y*g+m*r*f+t*p*x-t*y*f-m*p*g-_*r*x,D=e*y+m*n+i*x-y*n-m*i-e*x,I=_*i+e*f+p*n-i*f-e*p-_*n,e=_*y*n+m*i*f+e*p*x-e*y*f-m*p*n-_*i*x;this.transformCmds[0]=(t*y+m*g+r*x-y*g-m*r-t*x)*a,this.transformCmds[1]=D*a,this.transformCmds[2]=v*a,this.transformCmds[3]=I*a,this.transformCmds[4]=M*a,this.transformCmds[5]=e*a,this.drawCmds[0]=o,this.drawCmds[1]=h.uv[0]*d,this.drawCmds[2]=h.uv[1]*l,this.drawCmds[3]=u,this.drawCmds[4]=c,this.drawCmds[5]=h.uv[0]*d,this.drawCmds[6]=h.uv[1]*l,this.drawCmds[7]=u,this.drawCmds[8]=c,s.save(),this.transform&&(f=this.transform,s.transform(f.a,f.b,f.c,f.d,f.tx,f.ty)),s.transform.apply(s,this.transformCmds),s.drawImage.apply(s,this.drawCmds),s.restore()},_.renderByCache=function(t){var e,i=this.context;i.save(),this.transform&&(e=this.transform,i.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),i.transform.apply(i,this.transformCmds),i.drawImage.apply(i,this.drawCmds),i.restore()};var Dt,It=bt;function bt(){this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds=[],this.drawCmds=[],bt.__super.call(this),this.tempMesh=new Z}e(b,"laya.ani.bone.Skeleton",Nt=k),(a=b.prototype).init=function(t,e){var i,a,s,r=0,n=0;if(1==(e=void 0===e?0:e))for(this._graphicsCache=[],r=0,n=t.getAnimationCount();r<n;r++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=e,this._templet=t,this._player=new xt,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,0<t.ikArr.length)for(this._ikArr=[],r=0,n=t.ikArr.length;r<n;r++)this._ikArr.push(new at(t.ikArr[r],this._boneList));if(0<t.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),r=0,n=t.pathArr.length;r<n;r++)i=t.pathArr[r],a=new nt(i,this._boneList),(s=this._boneSlotDic[i.name])&&((a=new nt(i,this._boneList)).target=s),this._pathDic[i.name]=a;if(0<t.tfArr.length)for(this._tfArr=[],r=0,n=t.tfArr.length;r<n;r++)this._tfArr.push(new ct(t.tfArr[r],this._boneList));0<t.skinDataArray.length&&(e=this._templet.skinDataArray[this._skinIndex],this._skinName=e.name),this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},a.load=function(t,e,i){void 0===i&&(i=0),this._aniPath=t,this._complete=e,this._loadAniMode=i,F.loader.load([{url:t,type:"arraybuffer"}],l.create(this,this._onLoaded))},a._onLoaded=function(){var t,e=r.getRes(this._aniPath);null!=e&&(null==T.TEMPLET_DICTIONARY&&(T.TEMPLET_DICTIONARY={}),(t=T.TEMPLET_DICTIONARY[this._aniPath])?t.isParseFail?this._parseFail():t.isParserComplete?this._parseComplete():(t.on("complete",this,this._parseComplete),t.on("error",this,this._parseFail)):((t=new T)._setUrl(this._aniPath),(T.TEMPLET_DICTIONARY[this._aniPath]=t).on("complete",this,this._parseComplete),t.on("error",this,this._parseFail),t.isParserComplete=!1,t.parseData(null,e)))},a._parseComplete=function(){var t=T.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},a._parseFail=function(){console.log("[Error]:"+this._aniPath+"")},a._onPlay=function(){this.event("played")},a._onStop=function(){var t,e=this._templet.eventAniArr[this._aniClipIndex];if(e&&this._eventIndex<e.length)for(;this._eventIndex<e.length;this._eventIndex++)(t=e[this._eventIndex]).time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._drawOrder=null,this.event("stopped")},a._onPause=function(){this.event("paused")},a._parseSrcBoneMatrix=function(){var t=0,e=0;for(e=this._templet.srcBoneMatrixArr.length,t=0;t<e;t++)this._boneMatrixArray.push(new Tt);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);for(var i,a,s=this._templet.boneSlotArray,t=0,e=s.length;t<e;t++)i=s[t],null==(a=this._bindBoneBoneSlotDic[i.parent])&&(this._bindBoneBoneSlotDic[i.parent]=a=[]),this._boneSlotDic[i.name]=i=i.copy(),a.push(i),this._boneSlotArray.push(i)}},a._emitMissedEvents=function(t,e,i){void 0===i&&(i=0);var a=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(a)for(var s,r=0,n=a.length,r=i;r<n;r++)(s=a[r]).time>=this._player.playStart&&s.time<=this._player.playEnd&&this.event("label",s)},a._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var e=this.timer.currTimer,i=this._player.currentKeyframeIndex,a=e-this._lastTime;if(t?this._player._update(a):i=-1,this._lastTime=e,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<a&&this._clipIndex==i&&this._lastUpdateAniClipIndex==this._aniClipIndex))){this._lastUpdateAniClipIndex=this._aniClipIndex,i>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var s,r,t=this._templet.eventAniArr[this._aniClipIndex];if(t&&this._eventIndex<t.length&&((e=t[this._eventIndex]).time>=this._player.playStart&&e.time<=this._player.playEnd?this._player.currentPlayTime>=e.time&&(this.event("label",e),this._eventIndex++,this._playAudio)&&e.audioValue&&"null"!==e.audioValue&&(s=u.playSound(this._player.templet._path+e.audioValue,1,l.create(this,this._onAniSoundStoped)),u.playbackRate=this._player.playbackRate,s)&&this._soundChannelArr.push(s):e.time<this._player.playStart&&this._playAudio&&e.audioValue&&"null"!==e.audioValue?(this._eventIndex++,s=u.playSound(this._player.templet._path+e.audioValue,1,l.create(this,this._onAniSoundStoped),null,(this._player.currentPlayTime-e.time)/1e3),u.playbackRate=this._player.playbackRate,s&&this._soundChannelArr.push(s)):this._eventIndex++),0==this._aniMode){if(r=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=r&&(this.graphics=r));for(var n=0,h=0,h=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,h-1)&&0<h;)h--;if(h<this._clipIndex)for(n=h;n<this._clipIndex;n++)this._createGraphics(n)}else if(1==this._aniMode){if(r=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=r&&(this.graphics=r));for(h=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,h-1)&&0<h;)h--;if(h<this._clipIndex)for(n=h;n<this._clipIndex;n++)this._createGraphics(n)}this._createGraphics()}}},a._onAniSoundStoped=function(t){for(var e,i=this._soundChannelArr.length,a=0;a<i;a++)((e=this._soundChannelArr[a]).isStopped||t)&&(e.isStopped||e.stop(),this._soundChannelArr.splice(a,1),i--,a--)},a._createGraphics=function(t){var e,i=(t=-1==(t=void 0===t?-1:t)?this._clipIndex:t)*this._player.cacheFrameRateInterval,a=this._templet.drawOrderAniArr[this._aniClipIndex];if(a&&0<a.length)for(this._drawOrderIndex=0,e=a[this._drawOrderIndex];i>=e.time&&(this._drawOrder=e.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=a.length));)e=a[this._drawOrderIndex];0!=this._aniMode&&1!=this._aniMode&&this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=gt.create();var s,r,n,h,l=this.graphics,o=this._templet.getNodes(this._aniClipIndex),u=(this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,i),this._aniSectionDic[this._aniClipIndex]),c=0,d=0,_=0,p=0,f=0,m=this._templet.srcBoneMatrixArr.length;for(f=u[d=0];d<m;d++)h=this._boneList[d],n=this._templet.srcBoneMatrixArr[d],h.resultTransform.scX=n.scX*this._curOriginalData[c++],h.resultTransform.skX=n.skX+this._curOriginalData[c++],h.resultTransform.skY=n.skY+this._curOriginalData[c++],h.resultTransform.scY=n.scY*this._curOriginalData[c++],h.resultTransform.x=n.x+this._curOriginalData[c++],h.resultTransform.y=n.y+this._curOriginalData[c++],8===this._templet.tMatrixDataLen&&(h.resultTransform.skewX=n.skewX+this._curOriginalData[c++],h.resultTransform.skewY=n.skewY+this._curOriginalData[c++]);var y={},x={};for(f+=u[1];d<f;d++)y[(M=o[d]).name]=this._curOriginalData[c++],x[M.name]=this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++];var g={},v={};for(f+=u[2];d<f;d++)g[(M=o[d]).name]=this._curOriginalData[c++],v[M.name]=this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++],this._curOriginalData[c++];if(this._pathDic)for(f+=u[3];d<f;d++){var M=o[d],D=this._pathDic[M.name];if(D)switch(new At(M.extenData).getByte()){case 1:D.position=this._curOriginalData[c++];break;case 2:D.spacing=this._curOriginalData[c++];break;case 3:D.rotateMix=this._curOriginalData[c++],D.translateMix=this._curOriginalData[c++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(Tt.TEMP.identity()),this._ikArr)for(var I,d=0,f=this._ikArr.length;d<f;d++)I=this._ikArr[d],g.hasOwnProperty(I.name)&&(I.bendDirection=g[I.name]),v.hasOwnProperty(I.name)&&(I.mix=v[I.name]),I.apply();if(this._pathDic)for(var b in this._pathDic)(D=this._pathDic[b]).apply(this._boneList,l);if(this._tfArr)for(d=0,p=this._tfArr.length;d<p;d++)this._tfArr[d].apply();for(d=0,p=this._boneList.length;d<p;d++)if(h=this._boneList[d],r=this._bindBoneBoneSlotDic[h.name],h.resultMatrix.copyTo(this._boneMatrixArray[d]),r)for(_=0,f=r.length;_<f;_++)(s=r[_])&&s.setParentMatrix(h.resultMatrix);var N,A,T,C={},u=this._templet.deformAniArr;if(u&&0<u.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,d=0,f=this._boneSlotArray.length;d<f;d++)(s=this._boneSlotArray[d]).deformData=null;var S,w=u[this._aniClipIndex],F=w.default;for(S in this._setDeform(F,C,this._boneSlotArray,i),w)"default"!=S&&S!=this._skinName&&(F=w[S],this._setDeform(F,C,this._boneSlotArray,i));F=w[this._skinName],this._setDeform(F,C,this._boneSlotArray,i)}if(this._drawOrder)for(d=0,f=this._drawOrder.length;d<f;d++)N=y[(s=this._boneSlotArray[this._drawOrder[d]]).name],A=x[s.name],isNaN(A)||(l.save(),l.alpha(A)),isNaN(N)||-2==N||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[N]):s.showDisplayByIndex(N)),C[this._drawOrder[d]]&&(T=C[this._drawOrder[d]],s.currDisplayData)&&T[s.currDisplayData.attachmentName]?s.deformData=T[s.currDisplayData.attachmentName]:s.deformData=null,isNaN(A)?s.draw(l,this._boneMatrixArray,2==this._aniMode):s.draw(l,this._boneMatrixArray,2==this._aniMode,A),isNaN(A)||l.restore();else for(d=0,f=this._boneSlotArray.length;d<f;d++)N=y[(s=this._boneSlotArray[d]).name],A=x[s.name],isNaN(A)||(l.save(),l.alpha(A)),isNaN(N)||-2==N||(this._templet.attachmentNames?s.showDisplayByName(this._templet.attachmentNames[N]):s.showDisplayByIndex(N)),C[d]&&(T=C[d],s.currDisplayData)&&T[s.currDisplayData.attachmentName]?s.deformData=T[s.currDisplayData.attachmentName]:s.deformData=null,isNaN(A)?s.draw(l,this._boneMatrixArray,2==this._aniMode):s.draw(l,this._boneMatrixArray,2==this._aniMode,A),isNaN(A)||l.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,l):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,l)},a._setDeform=function(t,e,i,a){if(t){var s,r,n,h,l=0,o=0;if(t)for(l=0,h=t.deformSlotDataList.length;l<h;l++)for(s=t.deformSlotDataList[l],o=0;o<s.deformSlotDisplayList.length;o++)n=i[(r=s.deformSlotDisplayList[o]).slotIndex],r.apply(a,n),e[r.slotIndex]||(e[r.slotIndex]={}),e[r.slotIndex][r.attachment]=r.deformData}},a.getAnimNum=function(){return this._templet.getAnimationCount()},a.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},a.getSlotByName=function(t){return this._boneSlotDic[t]},a.showSkinByName=function(t,e){void 0===e&&(e=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)},a.showSkinByIndex=function(t,e){void 0===e&&(e=!0);for(var i,a=0;a<this._boneSlotArray.length;a++)this._boneSlotArray[a].showSlotData(null,e);this._templet.showSkinByIndex(this._boneSlotDic,t,e)&&(i=this._templet.skinDataArray[t],this._skinIndex=t,this._skinName=i.name),this._clearCache()},a.showSlotSkinByIndex=function(t,e){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.showDisplayByIndex(e),this._clearCache())},a.showSlotSkinByName=function(t,e){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.showDisplayByName(e),this._clearCache())},a.replaceSlotSkinName=function(t,e,i){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.replaceDisplayByName(e,i),this._clearCache())},a.replaceSlotSkinByIndex=function(t,e,i){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.replaceDisplayByIndex(e,i),this._clearCache())},a.setSlotSkin=function(t,e){0!=this._aniMode&&((t=this.getSlotByName(t))&&t.replaceSkin(e),this._clearCache())},a._clearCache=function(){if(1==this._aniMode)for(var t=0,e=this._graphicsCache.length;t<e;t++){for(var i=0,a=this._graphicsCache[t].length;i<a;i++){var s=this._graphicsCache[t][i];s!=this.graphics&&gt.recycle(s)}this._graphicsCache[t].length=0}},a.play=function(t,e,i,a,s,r,n){void 0===i&&(i=!0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===r&&(r=!0),this._playAudio=n=void 0===n?!0:n,this._indexControl=!1;var h=-1,n=NaN,n=e?2147483647:0;if("string"==typeof t)for(var l=0,o=this._templet.getAnimationCount();l<o;l++){var u=this._templet.getAnimation(l);if(u&&t==u.name){h=l;break}}else h=t;-1<h&&h<this.getAnimNum()&&(this._aniClipIndex=h,i||this._pause||this._currAniIndex!=h)&&(this._currAniIndex=h,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(h)),this._drawOrder=null,this._eventIndex=0,this._player.play(h,this._player.playbackRate,n,a,s),r&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=U.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update())},a.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),0<this._soundChannelArr.length&&this._onAniSoundStoped(!0),this.timer.clear(this,this._update))},a.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},a.paused=function(){if(!this._pause){if(this._pause=!0,this._player&&(this._player.paused=!0),0<this._soundChannelArr.length)for(var t,e=this._soundChannelArr.length,i=0;i<e;i++)(t=this._soundChannelArr[i]).isStopped||t.pause();this.timer.clear(this,this._update)}},a.resume=function(){if(this._indexControl=!1,this._pause){if(this._pause=!1,this._player&&(this._player.paused=!1),0<this._soundChannelArr.length)for(var t,e=this._soundChannelArr.length,i=0;i<e;i++)(t=this._soundChannelArr[i]).audioBuffer&&t.resume();this._lastTime=U.now(),this.timer.frameLoop(1,this,this._update,null,!0)}},a._getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},a._setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},a.destroy=function(t){Nt.prototype.destroy.call(this,t=void 0===t?!0:t),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update),0<this._soundChannelArr.length&&this._onAniSoundStoped(!0)},i(0,a,"url",function(){return this._aniPath},function(t){this.load(t)}),i(0,a,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),i(0,a,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),i(0,a,"templet",function(){return this._templet}),i(0,a,"player",function(){return this._player}),b.useSimpleMeshInCanvas=!1;var Nt,Wt=b;function b(t,e){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,this._playAudio=!0,this._soundChannelArr=[],b.__super.call(this),void 0===e&&(e=0),t&&this.init(t,e)}var Xt;e(N,"laya.ani.swf.MovieClip",Xt=k),(n=N.prototype).destroy=function(t){void 0===t&&(t=!0),this._clear(),Xt.prototype.destroy.call(this,t)},n._setDisplay=function(t){Xt.prototype._setDisplay.call(this,t),this._isRoot&&this._$3__onDisplay(t)},n._$3__onDisplay=function(t){t?this.timer.loop(this.interval,this,this.updates,null,!0):this.timer.clear(this,this.updates)},n.updates=function(){if(!this._parentMovieClip)for(var t=0,e=this._movieClipList.length,t=0;t<e;t++)this._movieClipList[t]&&this._movieClipList[t]._update()},n.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]=t},n.removeLabel=function(t){if(t){if(!this._labels)for(var e in this._labels)if(this._labels[e]===t){delete this._labels[e];break}}else this._labels=null},n._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}var t;this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),-1!=this._endFrame&&this._endFrame==this._playIndex&&(this._endFrame=-1,null!=this._completeHandler&&(t=this._completeHandler,this._completeHandler=null,t.run()),this.stop())}},n.stop=function(){this._playing=!1},n.gotoAndStop=function(t){this.index=t,this.stop()},n._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){this.timer.clear(this,this.updates);for(var t=0,e=this._movieClipList.length,t=0;t<e;t++)this._movieClipList[t]!=this&&this._movieClipList[t]._clear();this._movieClipList.length=0}for(var i in this._atlasPath&&r.clearRes(this._atlasPath),this._loadedImage)this._loadedImage[i]&&(r.clearRes(i),this._loadedImage[i]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},n.play=function(t,e){void 0===t&&(t=0),this.loop=e=void 0===e?!0:e,this._playing=!0,this._data&&this._displayFrame(t)},n._displayFrame=function(t){-1!=(t=void 0===t?-1:t)&&(this._curIndex>t&&this._reset(),this._parse(t))},n._reset=function(t){(t=void 0===t?!0:t)&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},n._parse=function(t){var e,i=!1,a=this._idOfSprite,s=this._data;for(this._ended&&this._reset(),s.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),s.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(s.getUint16()){case 12:var r,n,h=s.getUint16(),l=this._ids[s.getUint16()];this._Pos=s.pos,s.pos=l,0==(e=s.getUint8())?(u=s.getUint16(),(r=a[h])||(r=a[h]=new k,(n=new k).loadImage(this.basePath+u+".png"),this._loadedImage[this.basePath+u+".png"]=!0,r.addChild(n),n.size(s.getFloat32(),s.getFloat32()),u=s._getMatrix(),n.transform=u),r.alpha=1):1==e&&((n=a[h])||(a[h]=n=new N(this),n.interval=this.interval,n._ids=this._ids,n.basePath=this.basePath,n._setData(s,l),n._initState(),n.play(0)),n.alpha=1),s.pos=this._Pos;break;case 3:var o=a[s.getUint16()];o&&(this.addChild(o),o.zOrder=s.getUint16(),i=!0);break;case 4:(o=a[s.getUint16()])&&o.removeSelf();break;case 5:a[s.getUint16()][N._ValueList[s.getUint16()]]=s.getFloat32();break;case 6:a[s.getUint16()].visible=0<s.getUint8();break;case 7:var u=(r=a[s.getUint16()]).transform||Tt.create();u.setTo(s.getFloat32(),s.getFloat32(),s.getFloat32(),s.getFloat32(),s.getFloat32(),s.getFloat32()),r.transform=u;break;case 8:a[s.getUint16()].setPos(s.getFloat32(),s.getFloat32());break;case 9:a[s.getUint16()].setSize(s.getFloat32(),s.getFloat32());break;case 10:a[s.getUint16()].alpha=s.getFloat32();break;case 11:a[s.getUint16()].setScale(s.getFloat32(),s.getFloat32());break;case 98:e=s.getString(),this.event(e),"stop"==e&&this.stop();break;case 99:this._curIndex=s.getUint16(),i&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=s.pos},n._setData=function(t,e){this._data=t,this._start=e+3},n.load=function(t,e,i){void 0===e&&(e=!1),this._url=t,e&&(this._atlasPath=i||t.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this],e=[{url:t,type:"arraybuffer"}],this._atlasPath&&e.push({url:this._atlasPath,type:"atlas"}),F.loader.load(e,l.create(this,this._onLoaded))},n._onLoaded=function(){var t=r.getRes(this._url);t?this._atlasPath&&!r.getAtlas(this._atlasPath)?this.event("error","Atlas not find"):(this.basePath=this._atlasPath?r.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/",this._initData(t)):this.event("error","file not find")},n._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},n._initData=function(t){this._data=new At(t);for(var e=0,i=this._data.getUint16(),e=0;e<i;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||this.timer.loop(this.interval,this,this.updates,null,!0)},n.playTo=function(t,e,i){this._completeHandler=i,this._endFrame=e,this.play(t,!1)},i(0,n,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),i(0,n,"count",function(){return this._count}),i(0,n,"playing",function(){return this._playing}),i(0,n,"url",null,function(t){this.load(t)}),N._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"];function N(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,N.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,(this._parentMovieClip=t)?(this._isRoot=!1,this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0,this._setUpNoticeType(1))}e(C,"laya.ani.bone.Templet",zt=Mt),(A=C.prototype).loadAni=function(t){this._skBufferUrl=t,F.loader.load(t,l.create(this,this.onComplete),null,"arraybuffer")},A.onComplete=function(t){var e;this._isDestroyed?this.destroy():(e=r.getRes(this._skBufferUrl))?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,e)):this.event("error","load failed:"+this._skBufferUrl)},A.parseData=function(t,e,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=t,this._mainTexture&&o.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(e)},A.buildArmature=function(t){return new Wt(this,t=void 0===t?0:t)},A.parse=function(t){zt.prototype.parse.call(this,t),this._endLoaded(),this._aniVersion===C.LAYA_ANIMATION_VISION?this._isParseAudio=!0:this._aniVersion!=C.LAYA_ANIMATION_160_VISION&&(console.log("[Error] IDE"+this._aniVersion+"->"+C.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},A._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{for(var t,e,i,a,s=0,r=(this._loadList=[],new At(this.getPublicExtData())),n=r.getInt32(),h=r.readUTFString().split("\n"),s=0;s<n;s++)a=this._path+h[2*s],h[2*s+1],r.getFloat32(),r.getFloat32(),t=r.getFloat32(),e=r.getFloat32(),i=r.getFloat32(),isNaN(i),i=r.getFloat32(),isNaN(i),i=r.getFloat32(),isNaN(i),i=r.getFloat32(),isNaN(i),-1==this._loadList.indexOf(a)&&this._loadList.push(a);F.loader.load(this._loadList,l.create(this,this._textureComplete))}},A._textureComplete=function(){for(var t,e=0,i=this._loadList.length;e<i;e++)t=this._loadList[e],t=this._textureDic[t]=r.getRes(t),o.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},A._parsePublicExtData=function(){for(var t=0,e=0,i=0,a=0,s=0,t=0,s=this.getAnimationCount();t<s;t++)this._graphicsCache.push([]);var L,r,n,R,O,E,h,l,o,V="Dragon"!=this._aniClassName,u=new At(this.getPublicExtData()),K=u.getInt32(),c=u.readUTFString(),Y=c.split("\n");for(t=0;t<K;t++){if(l=this._mainTexture,o=this._path+Y[2*t],c=Y[2*t+1],!(l=null==this._mainTexture?this._textureDic[o]:l))return this.event("error",this),void(this.isParseFail=!0);o=u.getFloat32(),L=u.getFloat32(),r=u.getFloat32(),n=u.getFloat32(),h=u.getFloat32(),R=isNaN(h)?0:h,h=u.getFloat32(),O=isNaN(h)?0:h,h=u.getFloat32(),E=isNaN(h)?r:h,h=u.getFloat32(),h=isNaN(h)?n:h,this.subTextureDic[c]=Ct.create(l,o,L,r,n,-R,-O,E,h)}this._mainTexture=l;var d,_,p,f,W=u.getUint16();for(t=0;t<W;t++)(d=[]).push(u.getUint16()),d.push(u.getUint16()),d.push(u.getUint16()),d.push(u.getUint16()),this.aniSectionDic[t]=d;var m,y=u.getInt16(),X={};for(t=0;t<y;t++)_=new St,0==t?m=_:_.root=m,_.d=V?-1:1,p=u.readUTFString(),f=u.readUTFString(),_.length=u.getFloat32(),1==u.getByte()&&(_.inheritRotation=!1),1==u.getByte()&&(_.inheritScale=!1),_.name=p,f&&((f=X[f])?f.addChild(_):this.mRootBone=_),X[p]=_,this.mBoneArr.push(_);this.tMatrixDataLen=u.getUint16();var x,g,z=u.getUint16(),q=Math.floor(z/this.tMatrixDataLen),G=this.srcBoneMatrixArr;for(t=0;t<q;t++)(x=new Yt).scX=u.getFloat32(),x.skX=u.getFloat32(),x.skY=u.getFloat32(),x.scY=u.getFloat32(),x.x=u.getFloat32(),x.y=u.getFloat32(),8===this.tMatrixDataLen&&(x.skewX=u.getFloat32(),x.skewY=u.getFloat32()),G.push(x),(_=this.mBoneArr[t]).transform=x;var H,v,Q=u.getUint16();for(t=0;t<Q;t++){for(g=new Lt,H=u.getUint16(),e=0;e<H;e++)g.boneNames.push(u.readUTFString()),g.boneIndexs.push(u.getInt16());g.name=u.readUTFString(),g.targetBoneName=u.readUTFString(),g.targetBoneIndex=u.getInt16(),g.bendDirection=u.getFloat32(),g.mix=u.getFloat32(),g.isSpine=V,this.ikArr.push(g)}var Z,M,j=u.getUint16();for(t=0;t<j;t++){for(v=new Kt,Z=u.getUint16(),e=0;e<Z;e++)v.boneIndexs.push(u.getInt16());v.name=u.getUTFString(),v.targetIndex=u.getInt16(),v.rotateMix=u.getFloat32(),v.translateMix=u.getFloat32(),v.scaleMix=u.getFloat32(),v.shearMix=u.getFloat32(),v.offsetRotation=u.getFloat32(),v.offsetX=u.getFloat32(),v.offsetY=u.getFloat32(),v.offsetScaleX=u.getFloat32(),v.offsetScaleY=u.getFloat32(),v.offsetShearY=u.getFloat32(),this.tfArr.push(v)}var $,J=u.getUint16();for(t=0;t<J;t++){for((M=new Rt).name=u.readUTFString(),$=u.getUint16(),e=0;e<$;e++)M.bones.push(u.getInt16());M.target=u.readUTFString(),M.positionMode=u.readUTFString(),M.spacingMode=u.readUTFString(),M.rotateMode=u.readUTFString(),M.offsetRotation=u.getFloat32(),M.position=u.getFloat32(),M.spacing=u.getFloat32(),M.rotateMix=u.getFloat32(),M.translateMix=u.getFloat32(),this.pathArr.push(M)}var tt,et,it,at,st,D,I,b,rt,N,nt=u.getInt16();for(t=0;t<nt;t++){var ht=u.getUint8(),lt={};this.deformAniArr.push(lt);for(var ot=0;ot<ht;ot++)for((D=new Ft).skinName=u.getUTFString(),lt[D.skinName]=D,tt=u.getInt16(),e=0;e<tt;e++)for(I=new kt,D.deformSlotDataList.push(I),et=u.getInt16(),i=0;i<et;i++)for(b=new Pt,I.deformSlotDisplayList.push(b),b.slotIndex=u.getInt16(),b.attachment=u.getUTFString(),it=u.getInt16(),a=0;a<it;a++)for(1==u.getByte()?b.tweenKeyList.push(!0):b.tweenKeyList.push(!1),at=u.getFloat32(),b.timeList.push(at),b.vectices.push(rt=[]),st=u.getInt16(),s=0;s<st;s++)rt.push(u.getFloat32())}var ut,A,ct,T,dt=u.getInt16();for(t=0;t<dt;t++){for(ut=u.getInt16(),N=[],e=0;e<ut;e++){for((A=new Bt).time=u.getFloat32(),ct=u.getInt16(),i=0;i<ct;i++)A.drawOrder.push(u.getInt16());N.push(A)}this.drawOrderAniArr.push(N)}var _t,C,pt=u.getInt16();for(t=0;t<pt;t++){for(_t=u.getInt16(),T=[],e=0;e<_t;e++)(C=new Ut).name=u.getUTFString(),this._isParseAudio&&(C.audioValue=u.getUTFString()),C.intValue=u.getInt32(),C.floatValue=u.getFloat32(),C.stringValue=u.getUTFString(),C.time=u.getFloat32(),T.push(C);this.eventAniArr.push(T)}var ft=u.getInt16();if(0<ft)for(this.attachmentNames=[],t=0;t<ft;t++)this.attachmentNames.push(u.getUTFString());var S,w,mt=u.getInt16();for(t=0;t<mt;t++)(S=new wt).name=u.readUTFString(),S.parent=u.readUTFString(),S.attachmentName=u.readUTFString(),S.srcDisplayIndex=S.displayIndex=u.getInt16(),(S.templet=this).boneSlotDic[S.name]=S,null==(w=this.bindBoneBoneSlotDic[S.parent])&&(this.bindBoneBoneSlotDic[S.parent]=w=[]),w.push(S),this.boneSlotArray.push(S);var F,k,P,yt,xt,gt,vt,Mt,Dt,It,B=u.readUTFString().split("\n"),U=0,bt=u.getUint8();for(t=0;t<bt;t++){for((F=new Ot).name=B[U++],yt=u.getUint8(),e=0;e<yt;e++){for((k=new Vt).name=B[U++],S=this.boneSlotDic[k.name],xt=u.getUint8(),i=0;i<xt;i++){if(P=new Et,this.skinSlotDisplayDataArr.push(P),P.name=B[U++],P.attachmentName=B[U++],P.transform=new Yt,P.transform.scX=u.getFloat32(),P.transform.skX=u.getFloat32(),P.transform.skY=u.getFloat32(),P.transform.scY=u.getFloat32(),P.transform.x=u.getFloat32(),P.transform.y=u.getFloat32(),k.displayArr.push(P),P.width=u.getFloat32(),P.height=u.getFloat32(),P.type=u.getUint8(),P.verLen=u.getUint16(),0<(y=u.getUint16()))for(P.bones=[],a=0;a<y;a++){var Nt=u.getUint16();P.bones.push(Nt)}if(0<(gt=u.getUint16()))for(P.uvs=[],a=0;a<gt;a++)P.uvs.push(u.getFloat32());if(0<(vt=u.getUint16()))for(P.weights=[],a=0;a<vt;a++)P.weights.push(u.getFloat32());if(0<(Mt=u.getUint16()))for(P.triangles=[],a=0;a<Mt;a++)P.triangles.push(u.getUint16());if(0<(Dt=u.getUint16()))for(P.vertices=[],a=0;a<Dt;a++)P.vertices.push(u.getFloat32());if(0<(It=u.getUint16()))for(P.lengths=[],a=0;a<It;a++)P.lengths.push(u.getFloat32())}F.slotArr.push(k)}this.skinDic[F.name]=F,this.skinDataArray.push(F)}1==u.getUint8()?(this.yReverseMatrix=new Tt(1,0,0,-1,0,0),m&&m.setTempMatrix(this.yReverseMatrix)):m&&m.setTempMatrix(new Tt),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},A.getTexture=function(t){var e=this.subTextureDic[t];return null==(e=e||this.subTextureDic[t.substr(0,t.length-1)])?this._mainTexture:e},A.showSkinByIndex=function(t,e,i){if(void 0===i&&(i=!0),!(e<0&&e>=this.skinDataArray.length)){var a,s,r,n=0,h=this.skinDataArray[e];if(h){for(n=0,a=h.slotArr.length;n<a;n++)(r=h.slotArr[n])&&(s=t[r.name])&&(s.showSlotData(r,i),i&&"undefined"!=s.attachmentName&&"null"!=s.attachmentName?s.showDisplayByName(s.attachmentName):s.showDisplayByIndex(s.displayIndex));return!0}}return!1},A.getSkinIndexByName=function(t){for(var e=0,i=this.skinDataArray.length;e<i;e++)if(this.skinDataArray[e].name==t)return e;return-1},A.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t]&&this._graphicsCache[t][e]?this._graphicsCache[t][e]:null},A.setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},A.destroy=function(){var t,e;for(e in this._isDestroyed=!0,this.subTextureDic)(t=this.subTextureDic[e])&&t.destroy();for(e in this._textureDic)(t=this._textureDic[e])&&t.destroy();for(var i=0,a=this.skinSlotDisplayDataArr.length;i<a;i++)this.skinSlotDisplayDataArr[i].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete C.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},A.getAniNameByIndex=function(t){t=this.getAnimation(t);return t?t.name:null},i(0,A,"rate",function(){return this._rate},function(t){this._rate=t}),C.LAYA_ANIMATION_160_VISION="LAYAANIMATION:1.6.0",C.LAYA_ANIMATION_VISION="LAYAANIMATION:1.7.0",C.TEMPLET_DICTIONARY=null;var zt,A,T=C;function C(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isParseAudio=!1,this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,C.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var a=Laya[i];a&&a.__isclass&&(e[i]=a)}});