!function(i){i.un,i.uns;var t=i.static,e=i.class,n=i.getset,h=(i.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),c=laya.utils.ClassUtils,d=(laya.events.Event,laya.utils.HTMLChar),l=laya.net.Loader,s=(laya.display.Node,laya.maths.Rectangle),r=laya.renders.Render,u=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),a=laya.utils.Stat,R=laya.display.Text,o=laya.resource.Texture,_=laya.net.URL,f=laya.utils.Utils,y=(e(g,"laya.html.utils.HTMLParse"),g.parse=function(t,e,i){e=(e="<root>"+(e=e.replace(/<br>/g,"<br/>"))+"</root>").replace(g.spacePattern,g.char255);e=f.parseXMLFromString(e);g._parseXML(t,e.childNodes[0].childNodes,i)},g._parseXML=function(t,e,i,n){var h,l,s,r=0,a=0;if(e.join||e.item)for(r=0,a=e.length;r<a;++r)g._parseXML(t,e[r],i,n);else if(3==e.nodeType)t instanceof laya.html.dom.HTMLDivElement?(null==e.nodeName&&(e.nodeName="#text"),l=e.nodeName.toLowerCase(),0<(s=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(h=c.getInstance(l))&&(t.addChild(h),h.innerTEXT=s.replace(g.char255AndOneSpacePattern," "))):0<(s=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(t.innerTEXT=s.replace(g.char255AndOneSpacePattern," "));else if("#comment"!=(l=e.nodeName.toLowerCase()))if(h=c.getInstance(l)){(h=t.addChild(h)).URI=i,h.href=n;var o=e.attributes;if(o&&0<o.length)for(r=0,a=o.length;r<a;++r){var d=o[r],u=d.nodeName,d=d.value;h._setAttributes(u,d)}g._parseXML(h,e.childNodes,i,h.href)}else g._parseXML(t,e.childNodes,i,n)},g.char255=String.fromCharCode(255),g.spacePattern=/&nbsp;|&#160;/g,g.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),g);function g(){}e(W,"laya.html.utils.Layout"),W.later=function(t){null==W._will&&(W._will=[],i.stage.frameLoop(1,null,function(){if(!(W._will.length<1)){for(var t=0;t<W._will.length;t++)laya.html.utils.Layout.layout(W._will[t]);W._will.length=0}})),W._will.push(t)},W.layout=function(t){if(!t||!t._style)return null;if(0==(512&t._style._type))return null;t.getStyle()._type&=-513;var e=W._multiLineLayout(t);return r.isConchApp&&t.layaoutCallNative&&t.layaoutCallNative(),e},W._multiLineLayout=function(t){if(R.RightToLeft)return W._multiLineLayout2(t);var e,i,n,h=new Array,l=(t._addChildsToLayout(h),0),s=h.length,r=t._getCSSStyle(),a=r.letterSpacing,o=r.leading,d=r.lineHeight,u=r._widthAuto()||!r.wordWrap,c=u?999999:t.width,_=(t.height,0),f=r.italic?r.fontSize/3:0,y=r._getAlign(),g=r._getValign(),p=0!==g||0!==y||0!=d,m=0,w=0,x=0,v=0,S=new Array,L=S[0]=new U,T=!1,C=!1,E=(L.h=0,r.italic&&(c-=r.fontSize/3),0),M=!0;function H(){L.y=w,w+=L.h+o,0==L.h&&(w+=d),L.mWidth=E,E=0,L=new U,S.push(L),L.h=0,T=!(M=!(m=0))}for(l=0;l<s;l++)if(null==(e=h[l]))M||(m+=W.DIV_ELEMENT_PADDING),L.wordStartIndex=L.elements.length;else if(M=!1,e instanceof laya.html.dom.HTMLBrElement)H(),L.y=w;else{if(e._isChar()){if((n=e).isWord)T=C||"\n"===n.char,L.wordStartIndex=L.elements.length;else{if(0<S.length&&c<m+x&&0<L.wordStartIndex){var I=L.elements.length-L.wordStartIndex+1;L.elements.length=L.wordStartIndex,l-=I,H();continue}T=!1,E+=n.width}x=n.width+a,v=n.height,C=!1,(T=T||c<m+x)&&H(),L.minTextHeight=Math.min(L.minTextHeight,e.height)}else I=e._getCSSStyle(),n=e,i=I.padding,0!==I._getCssFloat()&&(p=!0),T=C||I.lineElement,x=n.width*n._style._tf.scaleX+i[1]+i[3]+a,v=n.height*n._style._tf.scaleY+i[0]+i[2],C=I.lineElement,(T=T||c<m+x&&I.wordWrap)&&H();L.elements.push(e),L.h=Math.max(L.h,v),e.x=m,e.y=w,m+=x,L.w=m-a,L.y=w,_=Math.max(m+f,_)}if(w=L.y+L.h,p){var A=0,N=c;for(u&&0<t.width&&(N=t.width),l=0,s=S.length;l<s;l++)S[l].updatePos(0,N,l,A,y,g,d),A+=Math.max(d,S[l].h+o);w=A}return u&&(t.width=_),w>t.height&&(t.height=w),[_,w]},W._multiLineLayout2=function(t){var e,i,n,h=new Array,l=(t._addChildsToLayout(h),0),s=h.length,r=t._getCSSStyle(),a=r.letterSpacing,o=r.leading,d=r.lineHeight,u=r._widthAuto()||!r.wordWrap,c=u?999999:t.width,_=(t.height,0),f=r.italic?r.fontSize/3:0,y=2-r._getAlign(),g=r._getValign(),p=0!==g||0!=y||0!=d,m=0,w=0,x=0,v=0,S=new Array,L=S[0]=new U,T=!1,C=!1,E=(L.h=0,r.italic&&(c-=r.fontSize/3),0),M=!0;function H(){L.y=w,w+=L.h+o,0==L.h&&(w+=d),L.mWidth=E,E=0,L=new U,S.push(L),L.h=0,T=!(M=!(m=0))}for(l=0;l<s;l++)if(null==(e=h[l]))M||(m+=W.DIV_ELEMENT_PADDING),L.wordStartIndex=L.elements.length;else if(M=!1,e instanceof laya.html.dom.HTMLBrElement)H(),L.y=w;else{if(e._isChar()){if((n=e).isWord)T=C||"\n"===n.char,L.wordStartIndex=L.elements.length;else{if(0<S.length&&c<m+x&&0<L.wordStartIndex){var I=L.elements.length-L.wordStartIndex+1;L.elements.length=L.wordStartIndex,l-=I,H();continue}T=!1,E+=n.width}x=n.width+a,v=n.height,C=!1,(T=T||c<m+x)&&H(),L.minTextHeight=Math.min(L.minTextHeight,e.height)}else I=e._getCSSStyle(),n=e,i=I.padding,0!==I._getCssFloat()&&(p=!0),T=C||I.lineElement,x=n.width*n._style._tf.scaleX+i[1]+i[3]+a,v=n.height*n._style._tf.scaleY+i[0]+i[2],C=I.lineElement,(T=T||c<m+x&&I.wordWrap)&&H();L.elements.push(e),L.h=Math.max(L.h,v),e.x=m,e.y=w,m+=x,L.w=m-a,L.y=w,_=Math.max(m+f,_)}if(w=L.y+L.h,p){for(var A=0,N=c,l=0,s=S.length;l<s;l++)S[l].updatePos(0,N,l,A,y,g,d),A+=Math.max(d,S[l].h+o);w=A}for(u&&(t.width=_),w>t.height&&(t.height=w),l=0,s=S.length;l<s;l++)S[l].revertOrder(c);return[_,w]},W._will=null,W.DIV_ELEMENT_PADDING=0;var p=W;function W(){}e(m,"laya.html.utils.LayoutLine"),(L=m.prototype).updatePos=function(t,e,i,n,h,l,s){var r=0,a=(0<this.elements.length&&(r=(c=this.elements[this.elements.length-1]).x+c.width-this.elements[0].x),0),o=NaN;1===h&&(a=(e-r)/2),2===h&&(a=e-r),0!==s&&0==l&&(l=1);for(var d=0,u=this.elements.length;d<u;d++){var c,_=(c=this.elements[d])._getCSSStyle();switch(0!==a&&(c.x+=a),_._getValign()){case 0:c.y=n;break;case 1:var f=0,f=((f=99999!=this.minTextHeight?this.minTextHeight:f)+s)/2,f=Math.max(f,this.h),o=(0 instanceof laya.html.dom.HTMLImageElement,n+f-c.height);c.y=o;break;case 2:c.y=n+(s-c.height)}}},L.revertOrder=function(t){var e;if(0<this.elements.length)for(var i=0,n=this.elements.length,i=0;i<n;i++)(e=this.elements[i]).x=t-e.x-e.width};var U=m;function m(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}e(v,"laya.html.dom.HTMLElement",w=u),(L=v.prototype).layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i?laya.html.dom.HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color,this.style.underLine,this.style.stroke,this.style.strokeColor):this.graphics.clear()},L.appendChild=function(t){return this.addChild(t)},L._getWords2=function(){var t=this._text.text;if(!t||0===t.length)return null;var e,i,n=0,h=0;if(this._text.drawWords)i=this._text.drawWords;else{for(h=(e=t.split(" ")).length-1,i=[],n=0;n<h;n++)i.push(e[n]," ");0<=h&&i.push(e[h]),this._text.drawWords=i}var l=this._text.words;if(!l||l.length!==i.length){null===l&&(this._text.words=l=[]),l.length=i.length;for(var s=this.style,r=s.font,n=0,h=i.length;n<h;n++){var a,o=f.measureText(i[n],r),o=l[n]=new d(i[n],o.width,o.height||s.fontSize,s);1<o.char.length&&(o.charNum=o.char),this.href&&(a=new u,this.addChild(a),o.setSprite(a))}}return l},L._getWords=function(){if(!R.CharacterCache)return this._getWords2();var t=this._text.text;if(!t||0===t.length)return null;var e=this._text.words;if(!e||e.length!==t.length){null===e&&(this._text.words=e=[]),e.length=t.length;for(var i=this.style,n=i.font,h=0,l=t.length;h<l;h++){var s,r=f.measureText(t.charAt(h),n),r=e[h]=new d(t.charAt(h),r.width,r.height||i.fontSize,i);this.href&&(s=new u,this.addChild(s),r.setSprite(s))}}return e},L.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,n=[],h=0;h<t.length;h++)i=t[h],(e=new u).graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),n.push(e)},L._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&t.block?(p.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},L._setAttributes=function(t,e){switch(t){case"style":return void this.style.cssText(e);case"class":return void(this.className=e)}w.prototype._setAttributes.call(this,t,e)},L.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,n=0;n<t.length;n++)(i=(e=t[n]).getSprite())&&(i.size(e.width,e.height),i.on("click",this,this.onLinkHandler))}},L.onLinkHandler=function(t){if("click"===t.type)for(var e=this;e;)e.event("link",[this.href]),e=e.parent},L.formatURL=function(t){return this.URI?_.formatURL(t,this.URI?this.URI.path:null):t},n(0,L,"href",function(){return this._href},function(t){null!=(this._href=t)&&(this._getCSSStyle().underLine=1,this.updateHref())}),n(0,L,"color",null,function(t){this.style.color=t}),n(0,L,"onClick",null,function(t){i._runScript("fn=function(event){"+t+";}"),this.on("click",this,void 0)}),n(0,L,"id",null,function(t){C.document.setElementById(t,this)}),n(0,L,"innerTEXT",function(){return this._text.text},function(t){this.text=t}),n(0,L,"style",function(){return this._style}),n(0,L,"text",function(){return this._text.text},function(t){this._text==v._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),r.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),n(0,L,"parent",w.prototype._$get_parent,function(t){var e;t instanceof laya.html.dom.HTMLElement&&(e=t,this.URI||(this.URI=e.URI),this.style.inherit(e.style)),i.superSet(u,this,"parent",t)}),n(0,L,"className",null,function(t){this.style.attrs(C.document.styleSheets["."+t])}),v.fillWords=function(t,e,i,n,h,l,s,r,a){t.graphics.clear();for(var o=0,d=e.length;o<d;o++){var u=e[o];0<r?t.graphics.fillBorderText(u.char,u.x+i,u.y+n,h,l,a,r,"left"):t.graphics.fillText(u.char,u.x+i,u.y+n,h,l,"left",s)}},v._EMPTYTEXT={text:null,words:null};var w,x=v;function v(){this.URI=null,this._href=null,v.__super.call(this),this._text=v._EMPTYTEXT,this.setStyle(new h(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}e(S,"laya.html.dom.HTMLBrElement",x);function S(){S.__super.call(this),this.style.lineElement=!0,this.style.block=!0}e(T,"laya.html.dom.HTMLDivElement",L=x),(I=T.prototype).appendHTML=function(t){y.parse(this,t,this.URI),this.layout()},I._addChildsToLayout=function(e){var t=this._getWords();if(null==t&&0==this._childs.length)return!1;t&&t.forEach(function(t){e.push(t)});for(var i=!0,n=0,h=this._childs.length;n<h;n++){var l=this._childs[n];i?i=!1:e.push(null),l._addToLayout(e)}return!0},I._addToLayout=function(t){this.layout()},I.layout=function(){var t,e;this.style&&(this.style._type|=512,t=p.layout(this))&&(this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new s),(e=this._$P.mHtmlBounds).x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e))},n(0,I,"height",function(){return this._height||this.contextHeight},L.prototype._$set_height),n(0,I,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),n(0,I,"width",function(){return this._width||this.contextWidth},function(t){var e=!1,e=0===t?t!=this._width:t!=this.width;i.superSet(x,this,"width",t),e&&this.layout()});var L=T;function T(){this.contextHeight=NaN,this.contextWidth=NaN,T.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}e(E,"laya.html.dom.HTMLDocument",x),(I=E.prototype).getElementById=function(t){return this.all[t]},I.setElementById=function(t,e){this.all[t]=e},t(E,["document",function(){return this.document=new E}]);var C=E;function E(){this.all=new Array,this.styleSheets=h.styleSheets,E.__super.call(this)}e(M,"laya.html.dom.HTMLImageElement",x),(I=M.prototype)._addToLayout=function(t){this._style.absolute||t.push(this)},I.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(a.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},I.layaoutCallNative=function(){var t=0;if(this._childs&&0<(t=this._childs.length))for(var e=0;e<t;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative()},n(0,I,"src",null,function(t){var e,i=this;function n(){var t;i._style&&((t=i._style).widthed(i)||i._tex.width,t.heighted(i)||i._tex.height,t.widthed(i)||i._width==i._tex.width||(i.width=i._tex.width,i.parent&&i.parent._layoutLater()),t.heighted(i)||i._height==i._tex.height||(i.height=i._tex.height,i.parent&&i.parent._layoutLater()),r.isConchApp&&(i._renderArgs[0]=i._tex,i._renderArgs[1]=i.x,i._renderArgs[2]=i.y,i._renderArgs[3]=i.width||i._tex.width,i._renderArgs[4]=i.height||i._tex.height,i.graphics.drawTexture(i._tex,0,0,i._renderArgs[3],i._renderArgs[4])),i.repaint(),i.parentRepaint())}t=this.formatURL(t),this._url!=t&&(this._url=t,(e=this._tex=l.getRes(t))||(this._tex=e=new o,e.load(t),l.cacheRes(t,e)),e.loaded?n():e.on("loaded",null,n))});function M(){this._tex=null,this._url=null,this._renderArgs=[],M.__super.call(this),this.style.block=!0}e(H,"laya.html.dom.HTMLLinkElement",t=x),(I=H.prototype)._onload=function(t){"text/css"===this.type&&h.parseCSS(t,this.URI)},n(0,I,"href",t.prototype._$get_href,function(t){var e=this,i=(t=this.formatURL(t),this.URI=new _(t),new l);i.once("complete",null,function(t){e._onload(t)}),i.load(t,"text")}),H._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g");function H(){this.type=null,H.__super.call(this),this.visible=!1}var I;e(A,"laya.html.dom.HTMLStyleElement",I=x),n(0,A.prototype,"text",I.prototype._$get_text,function(t){h.parseCSS(t,null)});function A(){A.__super.call(this),this.visible=!1}e(N,"laya.html.dom.HTMLIframeElement",t=L),n(0,N.prototype,"href",t.prototype._$get_href,function(i){var n=this,t=(i=this.formatURL(i),new l);t.once("complete",null,function(t){var e=n.URI;n.URI=new _(i),n.innerHTML=t,e&&(n.URI=e)}),t.load(i,"text")});function N(){N.__super.call(this),this._getCSSStyle().valign="middle"}}((window,document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var n=Laya[i];n&&n.__isclass&&(e[i]=n)}});